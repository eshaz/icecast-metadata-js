/*! 
 * Copyright 2021 Ethan Halsall
 * https://github.com/eshaz/icecast-metadata-js
 *
 * This file is part of icecast-metadata-player.
 *
 * icecast-metadata-player free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * icecast-metadata-player distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>
 */
var IcecastMetadataPlayer;IcecastMetadataPlayer=(()=>{var t={609:(t,e,s)=>{"use strict";s.r(e),s.d(e,{IcecastMetadataQueue:()=>n.a,IcecastMetadataReader:()=>a.a,IcecastReadableStream:()=>h.a});var i=s(764),n=s.n(i),r=s(420),a=s.n(r),o=s(705),h=s.n(o)},764:t=>{const e=()=>{};t.exports=class{constructor({icyBr:t,onMetadataUpdate:s=e,onMetadataEnqueue:i=e}){this.t=t,this.i=s,this.h=i,this.l=!0,this.u=[]}get metadataQueue(){return this.u.map((({m:t,...e})=>e))}addMetadata({metadata:t,stats:e},s,i=0){this.g(t,s,i+this.getTimeByBytes(e.currentStreamPosition))}getTimeByBytes(t){return this.t?t/(125*this.t):0}purgeMetadataQueue(){this.u.forEach((t=>clearTimeout(t.m))),this.u=[]}g(t,e,s){const i={metadata:t,timestampOffset:e,timestamp:s};this.u.push(i),this.h(t,e,s),this.l?(this.p(),this.l=!1):i.m=setTimeout((()=>{this.p()}),1e3*(e-s))}p(){const{metadata:t,timestampOffset:e,timestamp:s}=this.u.shift();this.i(t,e,s)}}},420:(t,e,s)=>{const i=s(395),n=s(103),r=s(361),a=s(399);t.exports=class{constructor({metadataTypes:t=["icy"],...e}={}){const s=t.includes("icy"),o=t.includes("ogg");this.S=s&&o?new a(e):o?new r(e):s?new n(e):new i(e)}static parseIcyMetadata(t){return n.parseIcyMetadata(t)}get icyMetaInt(){return this.S.icyMetaInt}*iterator(t){yield*this.S.iterator(t)}readAll(t){this.S.readAll(t)}async*asyncIterator(t){return yield*this.S.asyncIterator(t)}async asyncReadAll(t){return this.S.asyncReadAll(t)}}},705:(t,e,s)=>{const i=s(420),n=()=>{};class r extends ReadableStream{constructor(t,{icyMetaInt:e,onStream:s=n,...a}){const o=r.asyncIterator(t.body);let h;super({async start(n){h=new i({...a,icyMetaInt:parseInt(t.headers.get("Icy-MetaInt"))||e,onStream:async t=>(n.enqueue(t.stream),s(t))});for await(const t of o)await h.asyncReadAll(t);n.close()}}),this.I=h}get icyMetaInt(){return this.I.icyMetaInt}async startReading(){for await(const t of r.asyncIterator(this));}static asyncIterator(t){const e=t.getReader();return{[Symbol.asyncIterator]:()=>({next:()=>e.read()})}}}t.exports=r},399:(t,e,s)=>{const i=s(103),n=s(361);t.exports=class{constructor(t){const{onStream:e,...s}=t;this.M=new n(t),this.B=new i(s)}get icyMetaInt(){return this.B.icyMetaInt}*iterator(t){for(const e of this.B.iterator(t))e.stream?yield*this.M.iterator(e.stream):yield e}readAll(t){for(const e of this.B.iterator(t))e.stream&&this.M.readAll(e.stream)}async*asyncIterator(t){for await(const e of this.B.asyncIterator(t))if(e.stream)for await(const t of this.M.asyncIterator(e.stream))yield t;else yield e}async asyncReadAll(t){for await(const e of this.B.iterator(t))e.stream&&await this.M.asyncReadAll(e.stream)}}},103:(t,e,s)=>{const i=s(395);class n extends i{constructor({icyMetaInt:t,icyDetectionTimeout:e=2e3,...s}){super(s),this.L=t,this.v=e,this.C=this.A(),this.C.next()}*A(){if(yield*this.T())for(;;)this._=this.L,yield*this.R(),yield*this.D(),this._&&(yield*this.F());this._=1/0,yield*this.R()}static parseIcyMetadata(t){const e={};for(let s of t.matchAll(/(?<key>[^\0]+?)='(?<val>[^\0]*?)(;$|';|'$|$)/g))e[s.groups.key]=s.groups.val;return e}get icyMetaInt(){return this.L}*T(){if(this.L>0)return!0;if(!this.v)return!1;console.warn("icecast-metadata-js","\n  Passed in Icy-MetaInt is invalid. Attempting to detect ICY Metadata.","\n  See https://github.com/eshaz/icecast-metadata-js for information on how to properly request ICY Metadata.");const t=[null,83,116,114,101,97,109,84,105,116,108,101,61],e=Date.now();let s=0;for(;e+this.v>Date.now();){this.k=i.P(this.k,yield*this.O());t:for(;s<this.k.length-t.length;){for(let e=1;e<t.length;e++)if(this.k[e+s]!==t[e]){s++;continue t}return console.warn("icecast-metadata-js",`\n  Found ICY Metadata! Setting Icy-MetaInt to ${s}.`),this.L=s,!0}}return console.warn("icecast-metadata-js",`\n  ICY Metadata not detected after searching ${this.k.length} bytes for ${(Date.now()-e)/1e3} seconds.`,"\n  Assuming stream does not contain ICY metadata. Audio errors will occur if there is ICY metadata."),!1}*R(){for(this.U.currentStreamBytesRemaining=this._;this._;)yield*this.V(yield*super.N())}*D(){this._=1;do{this._=16*(yield*this.N())[0]}while(1===this._);this.U.addMetadataLengthBytes(1)}*F(){this.U.currentMetadataBytesRemaining=this._;const t=yield*this.N(this._);this.U.addMetadataBytes(t.length),yield*this.G(n.parseIcyMetadata(this.H.decode(t)))}}t.exports=n},395:(t,e,s)=>{const i=s(758).TextDecoder||TextDecoder,n=s(4),r=()=>{};class a{constructor({onStream:t=r,onMetadata:e=r}){this._=0,this.W=0,this.k=new Uint8Array(0),this.U=new n,this.H=new i("utf-8"),this.j=t,this.K=e,this.$=Promise.resolve(),this.q=Promise.resolve(),this.C=this.Y(),this.C.next()}*Y(){for(this._=1/0;;)yield*this.V(yield*this.N())}static P(t,e){const s=new Uint8Array(t.length+e.length);return s.set(t),s.set(e,t.length),s}*iterator(t){for(let e=this.C.next(t);e.value;e=this.C.next())yield e.value}readAll(t){for(let e=this.C.next(t);e.value;e=this.C.next());}async*asyncIterator(t){for(let e=this.C.next(t);e.value;e=this.C.next())await this.$,await this.q,yield e.value}async asyncReadAll(t){for(let e=this.C.next(t);e.value;e=this.C.next())await this.$,await this.q}*V(t){this.U.addStreamBytes(t.length);const e={stream:t,stats:this.U.stats};this.$=this.j(e),yield e}*G(t){const e={metadata:t,stats:this.U.stats};this.q=this.K(e),yield e}*N(t=0){for(this.W===this.k.length&&(this.k=yield*this.O(),this.W=0);this.k.length-this.W<t;)this.k=a.P(this.k,yield*this.O());const e=this.k.subarray(this.W,(t||this._)+this.W);return this.U.addBytes(e.length),this._-=e.length,this.W+=e.length,e}*O(){let t;do{t=yield}while(!t||0===t.length);return this.U.addCurrentBytesRemaining(t.length),t}}t.exports=a},361:(t,e,s)=>{const i=s(395);t.exports=class extends i{constructor(t){super(t),this.C=this.J(),this.C.next()}*J(){if(yield*this.X()){const t=yield*this.tt();if(t)for(;yield*this.X();)yield*this.F(t),yield*this.R()}this._=1/0,yield*this.R()}et(t,e=0){return new DataView(Uint8Array.from([...t.subarray(e,e+4)]).buffer).getUint32(0,!0)}st(t,e){return String.fromCharCode(...e).match(t)}*X(){const t=yield*this.N(27);if(!this.st(/OggS/,t.subarray(0,4))||248&t[5])return console.warn("icecast-metadata-js","\n  This stream is not an OGG stream. No OGG metadata will be returned.","\n  See https://github.com/eshaz/icecast-metadata-js for information on OGG metadata."),!1;{const e=yield*this.N(t[26]);return this._=e.reduce(((t,e)=>t+e),0),!0}}*tt(){const t=yield*this.N(8);return yield*this.R(),this.st(/\x7fFLAC/,t.subarray(0,5))?{regex:/^[\x84|\x04]/,length:4}:this.st(/OpusHead/,t.subarray(0,8))?{regex:/OpusTags/,length:8}:this.st(/\x01vorbis/,t.subarray(0,7))?{regex:/\x03vorbis/,length:7}:void 0}*F({regex:t,length:e}){this.st(t,yield*this.N(e))&&(yield*this.G(yield*this.it()))}*R(){for(;this._;)yield*this.N()}*N(t){const e=yield*super.N(t);return yield*this.V(e),e}*O(){const t=yield*super.O();return this.U.currentStreamBytesRemaining=t.length,t}*it(){const t=this.et(yield*this.N(4));this.U.addMetadataBytes(4);const e=this.H.decode(yield*this.N(t));this.U.addMetadataBytes(t);const s=this.et(yield*this.N(4));this.U.addMetadataBytes(4);const i=[];for(let t=0;t<s;t++){const t=yield*this.N(4);this.U.addMetadataBytes(4),i.push(yield*this.N(this.et(t))),this.U.addMetadataBytes(i[i.length-1].length)}return this.U.currentMetadataBytesRemaining=0,i.reduce(((t,e)=>{const s=e.indexOf(61),i=String.fromCharCode(...e.subarray(0,s)).toUpperCase(),n=this.H.decode(e.subarray(s+1));return t[i]=t[i]?`${t[i]}; ${n}`:n,t}),{VENDOR_STRING:e})}}},4:t=>{t.exports=class{constructor(){this.nt=0,this.rt=0,this.at=0,this.ot=0,this.ht=0,this.ct=0,this.dt=0}get stats(){return{totalBytesRead:this.nt,streamBytesRead:this.rt,metadataLengthBytesRead:this.at,metadataBytesRead:this.ot,currentBytesRemaining:this.ht,currentStreamBytesRemaining:this.ct,currentMetadataBytesRemaining:this.dt}}set currentStreamBytesRemaining(t){this.ct+=t}set currentMetadataBytesRemaining(t){this.dt=t}addBytes(t){this.nt+=t,this.ht-=t}addStreamBytes(t){this.rt+=t,this.ct-=t}addMetadataLengthBytes(t){this.at+=t}addMetadataBytes(t){this.ot+=t,this.dt-=t}addCurrentBytesRemaining(t){this.ht+=t}}},936:(t,e,s)=>{"use strict";s.d(e,{Z:()=>q});class i{syncFrame(t,e=0){let s=new this.CodecFrame(t.subarray(e));for(;!s.header&&e+this.lt<t.length;)e+=s.length||1,s=new this.CodecFrame(t.subarray(e));return{frame:s,remainingData:e}}fixedLengthFrame(t){let{frame:e,remainingData:s}=this.syncFrame(t),i=[];for(;e.header&&e.length+s+this.lt<t.length;){const n=new this.CodecFrame(t.subarray(e.length+s));if(n.header)i.push(e),s+=e.length,e=n;else{s++;const i=this.syncFrame(t,s);s+=i.remainingData,e=i.frame}}return{frames:i,remainingData:s}}}class n{constructor(t,e,s){this.ut=t,this.ft=e||[],this.yt=s||0}get length(){return this.yt}get header(){return this.ut}get data(){return this.ft}}class r{constructor(t){this.gt=t.channelMode,this.wt=t.channels,this.bt=t.dataByteLength,this.yt=t.length,this.St=t.sampleRate,this.It=t.sampleLength}get channels(){return this.wt}get dataByteLength(){return this.bt}get length(){return this.yt}get sampleRate(){return this.St}set sampleLength(t){this.It=t}get sampleLength(){return this.It}}const a={0:["free","free","free","free","free"],16:[32,32,32,32,8],32:[64,48,40,48,16],48:[96,56,48,56,24],64:[128,64,56,64,32],80:[160,80,64,80,40],96:[192,96,80,96,48],112:[224,112,96,112,56],128:[256,128,112,128,64],144:[288,160,128,144,80],160:[320,192,160,160,96],176:[352,224,192,176,112],192:[384,256,224,192,128],208:[416,320,256,224,144],224:[448,384,320,256,160],240:["bad","bad","bad","bad","bad"]},o={0:"bands 4 to 31",16:"bands 8 to 31",32:"bands 12 to 31",48:"bands 16 to 31"},h={0:{description:"reserved"},2:{description:"Layer III",framePadding:1,modeExtensions:{0:"Intensity stereo off, MS stereo off",16:"Intensity stereo on, MS stereo off",32:"Intensity stereo off, MS stereo on",48:"Intensity stereo on, MS stereo on"},v1:{bitrateIndex:2,sampleLength:1152},v2:{bitrateIndex:4,sampleLength:576}},4:{description:"Layer II",framePadding:1,modeExtensions:o,sampleLength:1152,v1:{bitrateIndex:1},v2:{bitrateIndex:4}},6:{description:"Layer I",framePadding:4,modeExtensions:o,sampleLength:384,v1:{bitrateIndex:0},v2:{bitrateIndex:3}}},c={0:{description:"MPEG Version 2.5 (later extension of MPEG 2)",layers:"v2",sampleRates:{0:11025,4:12e3,8:8e3,12:"reserved"}},8:{description:"reserved"},16:{description:"MPEG Version 2 (ISO/IEC 13818-3)",layers:"v2",sampleRates:{0:22050,4:24e3,8:16e3,12:"reserved"}},24:{description:"MPEG Version 1 (ISO/IEC 11172-3)",layers:"v1",sampleRates:{0:44100,4:48e3,8:32e3,12:"reserved"}}},d={0:"16bit CRC",1:"none"},l={0:"none",1:"50/15 ms",2:"reserved",3:"CCIT J.17"},u={0:{channels:2,description:"Stereo"},64:{channels:2,description:"Joint stereo"},128:{channels:2,description:"Dual channel"},192:{channels:1,description:"Single channel (Mono)"}};class f extends r{static getHeader(t){if(t.length<4)return null;if(255!==t[0]||t[1]<224)return null;const e=24&t[1],s=6&t[1],i=1&t[1],n={length:4},r=c[e];if("reserved"===r.description)return null;if("reserved"===h[s].description)return null;const o={...h[s],...h[s][r.layers]};n.mpegVersion=r.description,n.layer=o.description,n.sampleLength=o.sampleLength,n.protection=d[i];const m=240&t[2],y=12&t[2],g=2&t[2],p=1&t[2];if(n.bitrate=a[m][o.bitrateIndex],"bad"===n.bitrate)return null;if(n.sampleRate=r.sampleRates[y],"reserved"===n.sampleRate)return null;if(n.framePadding=g>>1&&o.framePadding,n.isPrivate=!!p,n.dataByteLength=Math.floor(125*n.bitrate*n.sampleLength/n.sampleRate+n.framePadding),!n.dataByteLength)return null;const w=192&t[3],b=48&t[3],S=8&t[3],I=4&t[3],M=3&t[3];return n.channelMode=u[w].description,n.channels=u[w].channels,n.modeExtension=o.modeExtensions[b],n.isCopyrighted=!!(S>>3),n.isOriginal=!!(I>>2),n.emphasis=l[M],"reserved"===n.emphasis?null:new f(n)}constructor(t){super(t),this.Mt=t.bitrate,this.xt=t.emphasis,this.Bt=t.framePadding,this.Lt=t.isCopyrighted,this.vt=t.isOriginal,this.Ct=t.isPrivate,this.Et=t.layer,this.At=t.modeExtension,this.zt=t.mpegVersion,this.Tt=t.protection}}const m=new Map;class y extends n{constructor(t){const e=String.fromCharCode(...t.subarray(0,4));let s=m.get(e);s||(s=f.getHeader(t),s&&m.set(e,s)),super(s,s&&t.subarray(0,s.dataByteLength),s&&s.dataByteLength)}}class g extends i{constructor(){super(),this.CodecFrame=y,this.lt=4}get codec(){return"mp3"}parseFrames(t){return this.fixedLengthFrame(t)}}const p={0:"MPEG-4",8:"MPEG-2"},w={0:"valid",2:"bad",4:"bad",6:"bad"},b={0:"16bit CRC",1:"none"},S={0:"AAC Main",64:"AAC LC (Low Complexity)",128:"AAC SSR (Scalable Sample Rate)",192:"AAC LTP (Long Term Prediction)"},I={0:"96000",4:"88200",8:"64000",12:"48000",16:"44100",20:"32000",24:"24000",28:"22050",32:"16000",36:"12000",40:"11025",44:"8000",48:"7350",52:"reserved",56:"reserved",60:"frequency is written explicitly"},M={0:{channels:0,description:"Defined in AOT Specific Config"},64:{channels:1,description:"front-center"},128:{channels:2,description:"front-left, front-right"},192:{channels:3,description:"front-center, front-left, front-right"},256:{channels:4,description:"front-center, front-left, front-right, back-center"},320:{channels:5,description:"front-center, front-left, front-right, back-left, back-right"},384:{channels:6,description:"front-center, front-left, front-right, back-left, back-right, LFE-channel"},448:{channels:8,description:"front-center, front-left, front-right, side-left, side-right, back-left, back-right, LFE-channel"}};class x extends r{static getHeader(t){if(t.length<7)return null;if(255!==t[0]||t[1]<240)return null;const e=8&t[1],s=6&t[1],i=1&t[1],n={};if(n.mpegVersion=p[e],n.layer=w[s],"bad"===n.layer)return null;n.protection=b[i],n.length=i?7:9;const r=192&t[2],a=60&t[2],o=2&t[2];if(n.profile=S[r],n.sampleRate=I[a],"reserved"===n.sampleRate)return null;n.isPrivate=!!(o>>1);const h=448&new DataView(Uint8Array.from([t[2],t[3]]).buffer).getUint16();n.channelMode=M[h].description,n.channels=M[h].channels;const c=32&t[3],d=8&t[3],l=8&t[3],u=4&t[3];n.isOriginal=!!(c>>5),n.isHome=!!(d>>4),n.copyrightId=!!(l>>3),n.copyrightIdStart=!!(u>>2);const f=262112&new DataView(Uint8Array.from([0,t[3],t[4],t[5]]).buffer).getUint32();if(n.dataByteLength=f>>5,!n.dataByteLength)return null;const m=8188&new DataView(Uint8Array.from([t[5],t[6]]).buffer).getUint16();return n.bufferFullness=8188===m?"VBR":m>>2,n.numberAACFrames=3&t[6],n.sampleLength=1024,n.bits={profileBits:r,sampleRateBits:a,channelModeBits:h},new x(n)}constructor(t){super(t),this._t=t.bits,this.Rt=t.copyrightId,this.Dt=t.copyrightIdStart,this.Ft=t.bufferFullness,this.kt=t.isHome,this.vt=t.isOriginal,this.Ct=t.isPrivate,this.Et=t.layer,this.zt=t.mpegVersion,this.Pt=t.numberAACFrames,this.Ot=t.profile,this.Tt=t.protection}get audioSpecificConfig(){const t=this._t.profileBits+64<<5|this._t.sampleRateBits<<5|this._t.channelModeBits>>3,e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e}}class B extends n{constructor(t){const e=x.getHeader(t);super(e,e&&t.subarray(e.length,e.dataByteLength),e&&e.dataByteLength)}}class L extends i{constructor(){super(),this.CodecFrame=B,this.lt=9}get codec(){return"mp4a.40.2"}parseFrames(t){return this.fixedLengthFrame(t)}}class v{static getHeader(t){if(t.length<28)return null;let e=[];for(let s=0;s<28;s++)e.push(t[s]);const s=new DataView(Uint8Array.from(e).buffer);if(1332176723!==s.getUint32(0))return null;const i={};i.streamStructureVersion=t[4];const n=248&t[5],r=4&t[5],a=2&t[5],o=1&t[5];if(n)return null;i.isContinuedPacket=!!(r>>2),i.isFirstPage=!!(a>>1),i.isLastPage=!!o,i.absoluteGranulePosition=s.getBigInt64(6,!0),i.streamSerialNumber=s.getInt32(14,!0),i.pageSequenceNumber=s.getInt32(18,!0),i.pageChecksum=s.getInt32(22,!0);const h=t[26];if(i.length=h+27,i.length>t.length)return null;i.dataByteLength=0,i.pageSegmentTable=[];let c=0;for(let e=0;e<h;e++){const s=t[e+27];i.dataByteLength+=s,c+=s,255!==s&&(i.pageSegmentTable.push(c),c=0)}return new v(i)}constructor(t){this.Ut=t.absoluteGranulePosition,this.bt=t.dataByteLength,this.Vt=t.isContinuedPacket,this.Nt=t.isFirstPage,this.Gt=t.isLastPage,this.yt=t.length,this.Ht=t.pageSegmentTable,this.Wt=t.pageSequenceNumber,this.jt=t.pageChecksum,this.Kt=t.streamSerialNumber}get absoluteGranulePosition(){return this.Ut}get dataByteLength(){return this.bt}get pageSegmentTable(){return this.Ht}get length(){return this.yt}}class C extends n{constructor(t){const e=v.getHeader(t);if(super(e,e&&t.subarray(e.length,e.length+e.dataByteLength),e&&e.length+e.dataByteLength),e){let s=e.length;this.$t=e.pageSegmentTable.map((e=>{const i=t.subarray(s,s+e);return s+=e,i}))}}get segments(){return this.$t}}class E extends n{constructor(t,e){super(e,t,t.length)}}const A=new Int32Array([0,7,14,9,28,27,18,21,56,63,54,49,36,35,42,45,112,119,126,121,108,107,98,101,72,79,70,65,84,83,90,93,224,231,238,233,252,251,242,245,216,223,214,209,196,195,202,205,144,151,158,153,140,139,130,133,168,175,166,161,180,179,186,189,199,192,201,206,219,220,213,210,255,248,241,246,227,228,237,234,183,176,185,190,171,172,165,162,143,136,129,134,147,148,157,154,39,32,41,46,59,60,53,50,31,24,17,22,3,4,13,10,87,80,89,94,75,76,69,66,111,104,97,102,115,116,125,122,137,142,135,128,149,146,155,156,177,182,191,184,173,170,163,164,249,254,247,240,229,226,235,236,193,198,207,200,221,218,211,212,105,110,103,96,117,114,123,124,81,86,95,88,77,74,67,68,25,30,23,16,5,2,11,12,33,38,47,40,61,58,51,52,78,73,64,71,82,85,92,91,118,113,120,127,106,109,100,99,62,57,48,55,34,37,44,43,6,1,8,15,26,29,20,19,174,169,160,167,178,181,188,187,150,145,152,159,138,141,132,131,222,217,208,215,194,197,204,203,230,225,232,239,250,253,244,243]),z={0:"Fixed",1:"Variable"},T={0:"reserved",16:192,32:576,48:1152,64:2304,80:4608,96:"8-bit (blocksize-1) end of header",112:"16-bit (blocksize-1) end of header",128:256,144:512,160:1024,176:2048,192:4096,208:8192,224:16384,240:32768},_={0:"invalid",1:88200,2:176400,3:192e3,4:8e3,5:16e3,6:22050,7:24e3,8:32e3,9:44100,10:48e3,11:96e3,12:"get 8 bit sample rate (in kHz) from end of header",13:"get 16 bit sample rate (in Hz) from end of header",14:"get 16 bit sample rate (in tens of Hz) from end of header",15:"invalid"},R={0:{channels:1,description:"mono"},16:{channels:2,description:"left, right"},32:{channels:3,description:"left, right, center"},48:{channels:4,description:"front left, front right, back left, back right"},64:{channels:5,description:"front left, front right, front center, back/surround left, back/surround right"},80:{channels:6,description:"front left, front right, front center, LFE, back/surround left, back/surround right"},96:{channels:7,description:"front left, front right, front center, LFE, back center, side left, side right"},112:{channels:8,description:"front left, front right, front center, LFE, back left, back right, side left, side right"},128:{channels:2,description:"left/side stereo: channel 0 is the left channel, channel 1 is the side(difference) channel"},144:{channels:2,description:"right/side stereo: channel 0 is the side(difference) channel, channel 1 is the right channel"},160:{channels:2,description:"mid/side stereo: channel 0 is the mid(average) channel, channel 1 is the side(difference) channel"},176:"reserved",192:"reserved",208:"reserved",224:"reserved",240:"reserved"},D={0:"get from STREAMINFO metadata block",2:8,4:12,6:"reserved",8:16,10:20,12:24,14:"reserved"};class F extends r{static decodeUTF8Int(t){if(t[0]<128)return{value:t[0],next:1};if(255===t)return null;let e,s=2,i=224;for(;(t[0]&i)!=(i<<1&255)&&s<7;)s++,i|=i>>1;if(t.length<s)return null;if(7===s)return null;const n=6*(s-1);e=t[0]&(255^i)<<n;for(let i=1;i<s;i++)e|=(63&t[i])<<n-6*i;return{value:e,next:s}}static getHeader(t){if(t.length<6)return null;if(255!==t[0]||248!==t[1]&&249!==t[1])return null;const e={length:2},s=1&t[1];e.blockingStrategy=z[s],e.length++;const i=240&t[2],n=15&t[2];if(e.blockSize=T[i],"reserved"===e.blockSize)return null;if(e.sampleRate=_[n],"invalid"===e.sampleRate)return null;if(e.length++,1&t[3])return null;const r=240&t[3],a=14&t[3],o=R[r];if("reserved"===o)return null;if(e.channels=o.channels,e.channelMode=o.description,e.sampleSize=D[a],"reserved"===e.sampleSize)return null;e.length++;const h=F.decodeUTF8Int(t.subarray(4));if(!h)return null;if(s?e.sampleNumber=h.value:e.frameNumber=h.value,e.length+=h.next,"string"==typeof e.blockSize)if(96===i){if(t.length<e.length)return null;e.blockSize=t[e.length-1]-1,e.length+=1}else if(112===i){if(t.length<=e.length)return null;e.blockSize=(t[e.length-1]<<8)+t[e.length]-1,e.length+=2}if("string"==typeof e.sampleRate)if(12===n){if(t.length<e.length)return null;e.sampleRate=t[e.length-1]-1,e.length+=1}else if(13===n){if(t.length<=e.length)return null;e.sampleRate=(t[e.length-1]<<8)+t[e.length]-1,e.length+=2}else if(14===n){if(t.length<=e.length)return null;e.sampleRate=(t[e.length-1]<<8)+t[e.length]-1,e.length+=2}return t.length<e.length?null:(e.crc=t[e.length-1],e.crc!==(t=>{let e;for(const s of t)e=255&A[255&(e^s)];return e})(t.subarray(0,e.length-1))?null:new F(e))}constructor(t){super(t),this.qt=t.blockingStrategy,this.Yt=t.blockSize,this.Qt=t.crc,this.Jt=t.frameNumber,this.Zt=t.sampleSize,this.Xt=t.sampleNumber,this.It=t.blockSize}get blockSize(){return this.Yt}get frameNumber(){return this.Jt}get sampleSize(){return this.Zt}}class k extends i{constructor(){super(),this.CodecFrame=E}get codec(){return"flac"}parseFrames(t){return this.te?{frames:t.segments.filter((t=>255===t[0]&&(248===t[1]||249===t[1]))).map((t=>new E(t,this.te))),remainingData:0}:(this.te=F.getHeader(t.data),{frames:[],remainingData:0})}}const P={0:{mode:"SILK-only",bandwidth:"NB",frameSize:10},8:{mode:"SILK-only",bandwidth:"NB",frameSize:20},16:{mode:"SILK-only",bandwidth:"NB",frameSize:40},24:{mode:"SILK-only",bandwidth:"NB",frameSize:60},32:{mode:"SILK-only",bandwidth:"MB",frameSize:10},40:{mode:"SILK-only",bandwidth:"MB",frameSize:20},48:{mode:"SILK-only",bandwidth:"MB",frameSize:40},56:{mode:"SILK-only",bandwidth:"MB",frameSize:60},64:{mode:"SILK-only",bandwidth:"WB",frameSize:10},72:{mode:"SILK-only",bandwidth:"WB",frameSize:20},80:{mode:"SILK-only",bandwidth:"WB",frameSize:40},88:{mode:"SILK-only",bandwidth:"WB",frameSize:60},96:{mode:"Hybrid",bandwidth:"SWB",frameSize:10},104:{mode:"Hybrid",bandwidth:"SWB",frameSize:20},112:{mode:"Hybrid",bandwidth:"FB",frameSize:10},120:{mode:"Hybrid",bandwidth:"FB",frameSize:20},128:{mode:"CELT-only",bandwidth:"NB",frameSize:2.5},136:{mode:"CELT-only",bandwidth:"NB",frameSize:5},144:{mode:"CELT-only",bandwidth:"NB",frameSize:10},152:{mode:"CELT-only",bandwidth:"NB",frameSize:20},160:{mode:"CELT-only",bandwidth:"WB",frameSize:2.5},168:{mode:"CELT-only",bandwidth:"WB",frameSize:5},176:{mode:"CELT-only",bandwidth:"WB",frameSize:10},184:{mode:"CELT-only",bandwidth:"WB",frameSize:20},192:{mode:"CELT-only",bandwidth:"SWB",frameSize:2.5},200:{mode:"CELT-only",bandwidth:"SWB",frameSize:5},208:{mode:"CELT-only",bandwidth:"SWB",frameSize:10},216:{mode:"CELT-only",bandwidth:"SWB",frameSize:20},224:{mode:"CELT-only",bandwidth:"FB",frameSize:2.5},232:{mode:"CELT-only",bandwidth:"FB",frameSize:5},240:{mode:"CELT-only",bandwidth:"FB",frameSize:10},248:{mode:"CELT-only",bandwidth:"FB",frameSize:20}};class O extends n{static getPacket(t){const e={config:P[248&t[0]],channels:4&t[0]?2:1,code:3&t[0]};switch(e.code){case 0:return e.frameCount=1,e;case 1:case 2:return e.frameCount=2,e;case 3:return e.isVbr=Boolean(128&t[1]),e.hasOpusPadding=Boolean(64&t[1]),e.frameCount=63&t[1],e}}constructor(t,e){super(e,t,t.length);const s=O.getPacket(t);this.ut.sampleLength=s.config.frameSize/1e3*this.ut.sampleRate*s.frameCount}}const U={0:["monophonic (mono)","stereo (left, right)"],1:["monophonic (mono)","stereo (left, right)","linear surround (left, center, right)","quadraphonic (front left, front right, rear left, rear right)","5.0 surround (front left, front center, front right, rear left, rear right)","5.1 surround (front left, front center, front right, rear left, rear right, LFE)","6.1 surround (front left, front center, front right, side left, side right, rear center, LFE)","7.1 surround (front left, front center, front right, side left, side right, rear left, rear right, LFE)"]};class V extends r{static getHeader(t){if(t.length<19)return null;if(79!==t[0]||112!==t[1]||117!==t[2]||115!==t[3]||72!==t[4]||101!==t[5]||97!==t[6]||100!==t[7])return null;if(1!==t[8])return null;const e=new DataView(Uint8Array.from([...t.subarray(0,19)]).buffer),s={length:19};if(s.channels=t[9],s.preSkip=e.getUint16(10,!0),s.inputSampleRate=e.getUint32(12,!0),s.sampleRate=48e3,s.outputGain=e.getInt16(16,!0),s.channelMappingFamily=t[18],!s.channelMappingFamily in U)return null;if(s.channelMode=U[s.channelMappingFamily][s.channels-1],!s.channelMode)return null;if(0!==s.channelMappingFamily){if(s.length+=2+s.channels,t.length<s.length)return null;s.streamCount=t[19],s.coupledStreamCount=t[20],s.channelMappingTable=t.subarray(21,s.channels+21)}return new V(s)}constructor(t){super(t),this.ee=t.channelMappingFamily,this.se=t.channelMappingTable,this.ie=t.coupledStreamCount,this.ne=t.inputSampleRate,this.re=t.outputGain,this.ae=t.preSkip,this.Zt=16,this.oe=t.streamCount}get channelMappingFamily(){return this.ee}get coupledStreamCount(){return this.ie}get preSkip(){return this.ae}get outputGain(){return this.re}get inputSampleRate(){return this.ne}get sampleSize(){return this.Zt}get streamCount(){return this.oe}get channelMappingTable(){return this.se}}class N extends i{constructor(){super(),this.CodecFrame=O,this.te=null,this.lt=26}get codec(){return"opus"}parseFrames(t){return this.te?{frames:t.segments.filter((t=>79!==t[0]&&112!==t[1])).map((t=>new O(t,this.te))),remainingData:0}:(this.te=V.getHeader(t.data),{frames:[],remainingData:0})}}class G extends i{constructor(){super(),this.CodecFrame=C,this.lt=283,this.he=null}get codec(){return this.he||"flac,opus"}st(t,e){return String.fromCharCode(...e).match(t)}setCodec({data:t}){if(this.st(/\x7fFLAC/,t.subarray(0,5)))this.he="flac",this.ce=new k;else if(this.st(/OpusHead/,t.subarray(0,8)))this.he="opus",this.ce=new N;else if(this.st(/\x01vorbis/,t.subarray(0,7)))throw new Error("Vorbis is currently not supported by isobmff-audio")}parseFrames(t){const e=this.fixedLengthFrame(t);return!this.he&&e.frames.length&&this.setCodec(e.frames[0]),{frames:e.frames.flatMap((t=>this.ce.parseFrames(t).frames)),remainingData:e.remainingData}}}class H{constructor(t,e,s){this.de=t,this.le=e,this.ue=s}static getUint32(t){const e=new Uint8Array(4);return new DataView(e.buffer).setUint32(0,t),e}static getUint16(t){const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t),e}static getInt16(t){const e=new Uint8Array(2);return new DataView(e.buffer).setInt16(0,t),e}get contents(){return this.le.concat(this.ue.reduce(((t,e)=>t.concat(e.contents)),[]))}get length(){return this.ue.reduce(((t,e)=>t+e.length),this.LENGTH_SIZE+this.le.length)}insertBytes(t,e){e+=this.LENGTH_SIZE,this.le=this.le.slice(0,e).concat(t).concat(this.le.slice(e))}appendBytes(t){this.le=this.le.concat(t)}addObject(t){this.ue.push(t)}}class W extends H{constructor(t,{contents:e=[],boxes:s=[]}={}){super(t,W.stringToByteArray(t).concat(e),s),this.LENGTH_SIZE=4}static stringToByteArray(t){return[...t].map((t=>t.charCodeAt(0)))}get contents(){const t=super.contents;return[...H.getUint32(this.LENGTH_SIZE+t.length)].concat(t)}addBox(t){if(t.constructor!==W)throw console.error("Only an object of type Box can be appended"),new Error("Not a box");this.addObject(t)}}class j extends H{constructor(t,{contents:e=[],tags:s=[]}={}){super(t,e,s),this.LENGTH_SIZE=1}static getLength(t){let e=H.getUint32(t);return e.every(((t,e,s)=>0===t&&(s[e]=128,!0))),e}get contents(){const t=super.contents;return[this.de,...j.getLength(t.length)].concat(t)}addTag(t){this.addObject(t)}}class K{constructor(t){this.fe=t}static getBoxContents(t){return Uint8Array.from(t.reduce(((t,e)=>t.concat(e.contents)),[]))}getCodecBox(t){switch(this.fe){case'audio/mp4;codecs="mp3"':return this.getMp4a(t,107);case'audio/mp4;codecs="mp4a.40.2"':return this.getMp4a(t,64);case'audio/mp4;codecs="opus"':return this.getOpus(t);case'audio/mp4;codecs="flac"':return this.getFlaC(t)}}getOpus(t){return new W("Opus",{contents:[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channels,0,t.sampleSize,0,0,0,0,...W.getUint16(t.sampleRate),0,0],boxes:[new W("dOps",{contents:[0,t.channels,...W.getUint16(t.preSkip),...W.getUint32(t.inputSampleRate),...W.getInt16(t.outputGain),t.channelMappingFamily,...0!==t.channelMappingFamily?[t.streamCount,t.coupledStreamCount,...t.channelMappingTable]:[]]})]})}getFlaC(t){return new W("fLaC",{contents:[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channels,0,t.sampleSize,0,0,0,0,...W.getUint16(t.sampleRate),0,0],boxes:[new W("dfLa",{contents:[0,0,0,0,128,0,0,34,...W.getUint16(t.blockSize),...W.getUint16(t.blockSize),0,0,0,0,0,0,...W.getUint32(t.sampleRate<<12|t.channels<<8|t.sampleSize-1<<4),0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]})]})}getMp4a(t,e){const s=new j(4,{contents:[e,21,0,0,0,0,0,0,0,0,0,0,0]});return 64===e&&s.addTag(new j(5,{contents:[...t.audioSpecificConfig]})),new W("mp4a",{contents:[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channels,0,16,0,0,0,0,...W.getUint16(t.sampleRate),0,0],boxes:[new W("esds",{contents:[0,0,0,0],boxes:[new j(3,{contents:[0,1,0],tags:[s,new j(6,{contents:[2]})]})]})]})}getMovieBox(t){const e=W.getUint32(t.sampleRate),s=[new W("ftyp",{contents:[...W.stringToByteArray("iso5"),0,0,2,0,...W.stringToByteArray("iso6mp41")]}),new W("moov",{boxes:[new W("mvhd",{contents:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,232,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2]}),new W("trak",{boxes:[new W("tkhd",{contents:[0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0]}),new W("mdia",{boxes:[new W("mdhd",{contents:[0,0,0,0,0,0,0,0,0,0,0,0,...e,0,0,0,0,85,196,0,0]}),new W("hdlr",{contents:[0,0,0,0,...W.stringToByteArray("mhlr"),...W.stringToByteArray("soun"),0,0,0,0,0,0,0,0,0,0,0,0,0]}),new W("minf",{boxes:[new W("stbl",{boxes:[new W("stsd",{contents:[0,0,0,0,0,0,0,1],boxes:[this.getCodecBox(t)]}),new W("stts",{contents:[0,0,0,0,0,0,0,0]}),new W("stsc",{contents:[0,0,0,0,0,0,0,0]}),new W("stsz",{contents:[0,0,0,0,0,0,0,0,0,0,0,0]}),new W("stco",{contents:[0,0,0,0,0,0,0,0]})]})]})]})]}),new W("mvex",{boxes:[new W("trex",{contents:[0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0]})]})]})];return K.getBoxContents(s)}static getMediaDataBox(t){let e=8;const s=t.reduce(((t,{data:e})=>t+e.length),0)+e,i=new Uint8Array(s);i.set([...W.getUint32(s),...W.stringToByteArray("mdat")]);for(const{data:s}of t)i.set(s,e),e+=s.length;return i}wrapFrames(t){const e=new W("trun",{contents:[0,0,2,1,...W.getUint32(t.length),...t.flatMap((({data:t})=>[...W.getUint32(t.length)]))]}),s=[new W("moof",{boxes:[new W("mfhd",{contents:[0,0,0,0,0,0,0,0]}),new W("traf",{boxes:[new W("tfhd",{contents:[0,2,0,8,0,0,0,1,...W.getUint32(t[0].header.sampleLength)]}),new W("tfdt",{contents:[0,0,0,0,0,0,0,0]}),e]})]})];e.insertBytes([...W.getUint32(s[0].length+12)],8);const i=K.getBoxContents(s),n=K.getMediaDataBox(t),r=new Uint8Array(i.length+n.length);return r.set(i),r.set(n,i.length),r}}class ${constructor(t,e={}){this.MIN_FRAMES=e.minFramesPerFragment||4,this.MIN_FRAMES_LENGTH=e.minBytesPerFragment||1022,t.match(/aac/)?this.me=new L:t.match(/mpeg/)?this.me=new g:t.match(/ogg/)&&(this.me=new G),this.ye=[],this.ge=new Uint8Array(0),this.C=this.C(),this.C.next()}get mimeType(){return`audio/mp4;codecs="${this.me.codec}"`}static appendBuffers(t,e){const s=new Uint8Array(t.length+e.length);return s.set(t),s.set(e,t.length),s}*iterator(t){for(let e=this.C.next(t);e.value;e=this.C.next())yield e.value}*C(){let t;for(;!t;)yield*this.pe(),t=this.we();this.be=new K(this.mimeType);let e=$.appendBuffers(this.be.getMovieBox(t[0].header),this.be.wrapFrames(t));for(;;)yield*this.pe(e),t=this.we(),e=t?this.be.wrapFrames(t):null}*pe(t){let e=yield t;for(;!e;)e=yield;this.ge=$.appendBuffers(this.ge,e)}we(){const{frames:t,remainingData:e}=this.me.parseFrames(this.ge);if(this.ye=this.ye.concat(t),this.ge=this.ge.subarray(e),this.ye.length>=this.MIN_FRAMES&&this.ye.reduce(((t,e)=>t+e.data.length),0)>=this.MIN_FRAMES_LENGTH){const t=this.ye;return this.ye=[],t}}}const q=$},187:(t,e,s)=>{const{IcecastReadableStream:i,IcecastMetadataQueue:n}=s(609),r=s(936).Z,a=Symbol(),o=Symbol(),h=()=>{};t.exports=class{constructor(t,e={}){this.Se=t,this.Ie=e.audioElement||new Audio,this.L=e.icyMetaInt,this.v=e.icyDetectionTimeout,this.j=e.onStream||h,this.Me=e.onError||h,this.xe=e.metadataTypes||["icy"],this.Be=this.xe.includes("icy"),this.Le=a,this.ve={},this.Ce=new n({onMetadataUpdate:e.onMetadata||h,onMetadataEnqueue:e.onMetadataEnqueue||h}),this.Ee()}get audioElement(){return this.Ie}get icyMetaInt(){return this.ve.icyMetaInt}get metadataQueue(){return this.Ce.metadataQueue}get playing(){return this.Le===o}play(){this.Le===a&&(this.Le=o,this.Ee(),this.Ie.addEventListener("pause",(()=>{this.stop(),this.Ee()}),{once:!0}),this.Ie.addEventListener("canplay",(()=>{this.Ie.play()}),{once:!0}),this.Ae().then((async t=>{const e=this.ze(t.headers.get("content-type"));this.ve=new i(t,{onMetadata:t=>this.Ce.addMetadata(t,this.Te&&this.Te.timestampOffset||0,this.Ie.currentTime),onStream:e,metadataTypes:this.xe,icyMetaInt:this.L,icyDetectionTimeout:this.v}),await this.ve.startReading()})).catch((async t=>{this.Ce.purgeMetadataQueue(),this.Ie.pause(),this.Te=null,"AbortError"!==t.name&&"Error in body stream"!==t.message&&(console.error(t),this._e(),this.Le=a)})))}stop(){this.Le===o&&(this.Le=a,this.Re.abort())}De(...t){console.warn("icecast-metadata-js",t.reduce(((t,e)=>t+"\n  "+e),"")),this.Me(t[0])}_e(){this.De("Falling back to HTML5 audio with no metadata updates. See the console for details on the error."),this.play=()=>{this.Le===a&&(this.Le=o,this.Ie.src=this.Se,this.Ie.play())},this.stop=()=>{this.Le===o&&(this.Le=a,this.Ie.pause(),this.Ie.removeAttribute("src"),this.Ie.load())},this.Le=a,this.play()}Ee(){this.Te=null,this.Fe=new MediaSource,this.Ie.src=URL.createObjectURL(this.Fe)}async ke(t){"open"===this.Fe.readyState?(this.Te=this.Fe.addSourceBuffer(t),this.Te.mode="sequence"):await new Promise((e=>{this.Fe.addEventListener("sourceopen",(()=>{this.Te=this.Fe.addSourceBuffer(t),this.Te.mode="sequence",e()}),{once:!0})}))}async Pe(){return new Promise((t=>{this.Te.addEventListener("updateend",t,{once:!0})}))}async Oe(t,e){this.Te||await this.ke(e),this.Fe.sourceBuffers.length&&(this.Te.appendBuffer(t),await this.Pe(),this.Ie.currentTime>2&&(this.Te.remove(0,this.Ie.currentTime-2),await this.Pe()))}async Ae(){this.Re=new AbortController;const t=(t={})=>fetch(this.Se,{method:"GET",headers:t,signal:this.Re.signal});return this.Be?t({"Icy-MetaData":1}).catch((e=>{if("AbortError"!==e.name)return this.De("Network request failed, possibly due to a CORS issue. Trying again without ICY Metadata."),t();throw e})):t()}ze(t){if(MediaSource.isTypeSupported(t))return async({stream:e})=>this.Oe(e,t);const e=new r(t);if(MediaSource.isTypeSupported(e.mimeType))return async({stream:t})=>{for await(const s of e.iterator(t))await this.Oe(s,e.mimeType)};throw this.De(`Media Source Extensions API in your browser does not support ${t} ${e.mimeType}`,"See: https://caniuse.com/mediasource and https://developer.mozilla.org/en-US/docs/Web/API/Media_Source_Extensions_API"),new Error("Unsupported Codec")}}},758:()=>{}},e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={exports:{}};return t[i](n,n.exports,s),n.exports}return s.n=t=>{var e=t&&t.Ue?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"Ue",{value:!0})},s(187)})();
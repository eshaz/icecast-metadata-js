/*! For license information please see icecast-metadata-player-1.15.0.main.min.js.LICENSE.txt */

/*! 
 * Copyright 2021-2023 Ethan Halsall
 * https://github.com/eshaz/icecast-metadata-js
 *
 * This file is part of icecast-metadata-player.
 *
 * icecast-metadata-player free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * icecast-metadata-player distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>
 */
var IcecastMetadataPlayer;(()=>{"use strict";var t,e,s={273:(t,e,s)=>{s.d(e,{Z:()=>Qt});const i=(t,e,s)=>{for(let i=0;i<t.length;i++){let n=e(i);for(let t=8;t>0;t--)n=s(n);t[i]=n}return t},n=i(new Uint8Array(256),(t=>t),(t=>128&t?7^t<<1:t<<1)),h=[i(new Uint16Array(256),(t=>t<<8),(t=>t<<1^(32768&t?32773:0)))],r=[i(new Uint32Array(256),(t=>t),(t=>t>>>1^3988292384*(1&t)))];for(let t=0;t<15;t++){h.push(new Uint16Array(256)),r.push(new Uint32Array(256));for(let e=0;e<=255;e++)h[t+1][e]=h[0][h[t][e]>>>8]^h[t][e]<<8,r[t+1][e]=r[t][e]>>>8^r[0][255&r[t][e]]}const a=t=>{const e=t.length,s=e-16;let i=0,n=0;for(;n<=s;)i=r[15][255&(t[n++]^i)]^r[14][255&(t[n++]^i>>>8)]^r[13][255&(t[n++]^i>>>16)]^r[12][t[n++]^i>>>24]^r[11][t[n++]]^r[10][t[n++]]^r[9][t[n++]]^r[8][t[n++]]^r[7][t[n++]]^r[6][t[n++]]^r[5][t[n++]]^r[4][t[n++]]^r[3][t[n++]]^r[2][t[n++]]^r[1][t[n++]]^r[0][t[n++]];for(;n!==e;)i=r[0][255&(i^t[n++])]^i>>>8;return-1^i},o=(...t)=>{const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));return t.reduce(((t,s)=>(e.set(s,t),t+s.length)),0),e},c=t=>String.fromCharCode(...t),d=[0,8,4,12,2,10,6,14,1,9,5,13,3,11,7,15],l=t=>d[15&t]<<4|d[t>>4];class u{constructor(t){this.t=t,this.i=8*t.length}set position(t){this.i=t}get position(){return this.i}read(t){const e=Math.floor(this.i/8),s=this.i%8;this.i-=t;return(l(this.t[e-1])<<8)+l(this.t[e])>>7-s&255}}class m{constructor(t){this.h=t,this.reset()}enable(){this.S=!0}reset(){this.A=new Map,this.q=new WeakMap,this.M=!1,this.v=null,this.S=!1}checkCodecUpdate(t,e){if(this.h){this.v!==t&&(this.v=t,this.M=!0);const s=this.q.get(this.A.get(this._));this.M&&s&&this.h({bitrate:t,...s},e),this.M=!1}}updateCurrentHeader(t){this.h&&t!==this._&&(this.M=!0,this._=t)}getHeader(t){const e=this.A.get(t);return e&&this.updateCurrentHeader(t),e}setHeader(t,e,s){this.S&&(this.updateCurrentHeader(t),this.A.set(t,e),this.q.set(e,s))}}const y=new WeakMap,f=new WeakMap;class w{constructor(t,e){this.T=t,this.A=e}*syncFrame(){let t;for(;;){if(t=yield*this.Frame.getFrame(this.T,this.A,0),t)return t;this.T.incrementRawData(1)}}*fixedLengthFrameSync(t){let e=yield*this.syncFrame();const s=f.get(e).length;if(t||this.T.P||(yield*this.Header.getHeader(this.T,this.A,s)))return this.A.enable(),this.T.incrementRawData(s),this.T.mapFrameStats(e),e;this.T.logWarning(`Missing frame frame at ${s} bytes from current position.`,"Dropping current frame and trying again."),this.A.reset(),this.T.incrementRawData(1)}}class p{constructor(t,e){f.set(this,{header:t}),this.data=e}}class g extends p{static*getFrame(t,e,s,i,n){const h=yield*t.getHeader(s,i,n);if(h){const t=y.get(h).frameLength,i=y.get(h).samples;return new e(h,(yield*s.readRawData(t,n)).subarray(0,t),i)}return null}constructor(t,e,s){super(t,e),this.header=t,this.samples=s,this.duration=s/t.sampleRate*1e3,this.frameNumber=null,this.totalBytesOut=null,this.totalSamples=null,this.totalDuration=null,f.get(this).length=e.length}}const b="reserved",S="bad",A="free",q="none",M="16bit CRC",v="left",E="center",_="right",T=["","front ","side ","rear "].map((t=>[[v,_],[v,_,E],[v,E,_],[E,v,_],[E]].flatMap((e=>e.map((e=>t+e)).join(", "))))),P="LFE",I="monophonic (mono)",C="stereo",R="surround",x=[I,C,`linear ${R}`,"quadraphonic",`5.0 ${R}`,`5.1 ${R}`,`6.1 ${R}`,`7.1 ${R}`],$=(t,...e)=>`${x[t-1]} (${e.join(", ")})`,B=[I,$(2,T[0][0]),$(3,T[0][2]),$(4,T[1][0],T[3][0]),$(5,T[1][2],T[3][0]),$(6,T[1][2],T[3][0],P),$(7,T[1][2],T[2][0],T[3][4],P),$(8,T[1][2],T[2][0],T[3][0],P)],U=48e3,D=44100,O=32e3,k=24e3,F=22050,L=16e3,z=8e3;class N{static*getID3v2Header(t,e,s){const i={headerLength:10};let n=yield*t.readRawData(3,s);return 73!==n[0]||68!==n[1]||51!==n[2]?null:(n=yield*t.readRawData(i.headerLength,s),i.version=`id3v2.${n[3]}.${n[4]}`,15&n[5]?null:(i.unsynchronizationFlag=Boolean(128&n[5]),i.extendedHeaderFlag=Boolean(64&n[5]),i.experimentalFlag=Boolean(32&n[5]),i.footerPresent=Boolean(16&n[5]),128&n[6]||128&n[7]||128&n[8]||128&n[9]?null:(i.dataLength=n[6]<<21|n[7]<<14|n[8]<<7|n[9],i.length=i.headerLength+i.dataLength,new N(i))))}constructor(t){this.version=t.version,this.unsynchronizationFlag=t.unsynchronizationFlag,this.extendedHeaderFlag=t.extendedHeaderFlag,this.experimentalFlag=t.experimentalFlag,this.footerPresent=t.footerPresent,this.length=t.length}}class V{constructor(t){y.set(this,t),this.bitDepth=t.bitDepth,this.bitrate=null,this.channels=t.channels,this.channelMode=t.channelMode,this.sampleRate=t.sampleRate}}const G={0:[A,A,A,A,A],16:[32,32,32,32,8],240:[S,S,S,S,S]},W=(t,e,s)=>8*((t+s)%e+e)*(1<<(t+s)/e)-8*e*(e/8|0);for(let t=2;t<15;t++)G[t<<4]=[32*t,W(t,4,0),W(t,4,-1),W(t,8,4),W(t,8,0)];const H="bands ",j=" to 31",Q={0:H+4+j,16:H+8+j,32:H+12+j,48:H+16+j},Y="Intensity stereo ",K=", MS stereo ",Z="on",J="off",X={0:{description:b},2:{description:"Layer III",framePadding:1,modeExtensions:{0:Y+J+K+J,16:Y+Z+K+J,32:Y+J+K+Z,48:Y+Z+K+Z},v1:{bitrateIndex:2,samples:1152},v2:{bitrateIndex:4,samples:576}},4:{description:"Layer II",framePadding:1,modeExtensions:Q,samples:1152,v1:{bitrateIndex:1},v2:{bitrateIndex:4}},6:{description:"Layer I",framePadding:4,modeExtensions:Q,samples:384,v1:{bitrateIndex:0},v2:{bitrateIndex:3}}},tt="MPEG Version ",et="ISO/IEC ",st={0:{description:`${tt}2.5 (later extension of MPEG 2)`,layers:"v2",sampleRates:{0:11025,4:12e3,8:z,12:b}},8:{description:b},16:{description:`${tt}2 (${et}13818-3)`,layers:"v2",sampleRates:{0:F,4:k,8:L,12:b}},24:{description:`${tt}1 (${et}11172-3)`,layers:"v1",sampleRates:{0:D,4:U,8:O,12:b}}},it={0:M,1:q},nt={0:q,1:"50/15 ms",2:b,3:"CCIT J.17"},ht={0:{channels:2,description:C},64:{channels:2,description:"joint "+C},128:{channels:2,description:"dual channel"},192:{channels:1,description:I}};class rt extends V{static*getHeader(t,e,s){const i={},n=yield*N.getID3v2Header(t,e,s);n&&(yield*t.readRawData(n.length,s),t.incrementRawData(n.length));const h=yield*t.readRawData(4,s),r=c(h.subarray(0,4)),a=e.getHeader(r);if(a)return new rt(a);if(255!==h[0]||h[1]<224)return null;const o=st[24&h[1]];if(o.description===b)return null;const d=6&h[1];if(X[d].description===b)return null;const l={...X[d],...X[d][o.layers]};if(i.mpegVersion=o.description,i.layer=l.description,i.samples=l.samples,i.protection=it[1&h[1]],i.length=4,i.bitrate=G[240&h[2]][l.bitrateIndex],i.bitrate===S)return null;if(i.sampleRate=o.sampleRates[12&h[2]],i.sampleRate===b)return null;if(i.framePadding=2&h[2]&&l.framePadding,i.isPrivate=Boolean(1&h[2]),i.frameLength=Math.floor(125*i.bitrate*i.samples/i.sampleRate+i.framePadding),!i.frameLength)return null;const u=192&h[3];if(i.channelMode=ht[u].description,i.channels=ht[u].channels,i.modeExtension=l.modeExtensions[48&h[3]],i.isCopyrighted=Boolean(8&h[3]),i.isOriginal=Boolean(4&h[3]),i.emphasis=nt[3&h[3]],i.emphasis===b)return null;i.bitDepth=16;const{length:m,frameLength:y,samples:f,...w}=i;return e.setHeader(r,i,w),new rt(i)}constructor(t){super(t),this.bitrate=t.bitrate,this.emphasis=t.emphasis,this.framePadding=t.framePadding,this.isCopyrighted=t.isCopyrighted,this.isOriginal=t.isOriginal,this.isPrivate=t.isPrivate,this.layer=t.layer,this.modeExtension=t.modeExtension,this.mpegVersion=t.mpegVersion,this.protection=t.protection}}class at extends g{static*getFrame(t,e,s){return yield*super.getFrame(rt,at,t,e,s)}constructor(t,e,s){super(t,e,s)}}class ot extends w{constructor(t,e,s){super(t,e),this.Frame=at,this.Header=rt,s(this.codec)}get codec(){return"mpeg"}*parseFrame(){return yield*this.fixedLengthFrameSync()}}const ct={0:"MPEG-4",8:"MPEG-2"},dt={0:"valid",2:S,4:S,6:S},lt={0:M,1:q},ut={0:"AAC Main",64:"AAC LC (Low Complexity)",128:"AAC SSR (Scalable Sample Rate)",192:"AAC LTP (Long Term Prediction)"},mt={0:96e3,4:88200,8:64e3,12:U,16:D,20:O,24:k,28:F,32:L,36:12e3,40:11025,44:z,48:7350,52:b,56:b,60:"frequency is written explicitly"},yt={0:{channels:0,description:"Defined in AOT Specific Config"},64:{channels:1,description:I},128:{channels:2,description:$(2,T[0][0])},192:{channels:3,description:$(3,T[1][3])},256:{channels:4,description:$(4,T[1][3],T[3][4])},320:{channels:5,description:$(5,T[1][3],T[3][0])},384:{channels:6,description:$(6,T[1][3],T[3][0],P)},448:{channels:8,description:$(8,T[1][3],T[2][0],T[3][0],P)}};class ft extends V{static*getHeader(t,e,s){const i={},n=yield*t.readRawData(7,s),h=c([n[0],n[1],n[2],252&n[3]|3&n[6]]),r=e.getHeader(h);if(r)Object.assign(i,r);else{if(255!==n[0]||n[1]<240)return null;if(i.mpegVersion=ct[8&n[1]],i.layer=dt[6&n[1]],i.layer===S)return null;const t=1&n[1];i.protection=lt[t],i.length=t?7:9,i.profileBits=192&n[2],i.sampleRateBits=60&n[2];const s=2&n[2];if(i.profile=ut[i.profileBits],i.sampleRate=mt[i.sampleRateBits],i.sampleRate===b)return null;i.isPrivate=Boolean(s),i.channelModeBits=448&(n[2]<<8|n[3]),i.channelMode=yt[i.channelModeBits].description,i.channels=yt[i.channelModeBits].channels,i.isOriginal=Boolean(32&n[3]),i.isHome=Boolean(8&n[3]),i.copyrightId=Boolean(8&n[3]),i.copyrightIdStart=Boolean(4&n[3]),i.bitDepth=16,i.samples=1024,i.numberAACFrames=3&n[6];const{length:r,channelModeBits:a,profileBits:o,sampleRateBits:c,frameLength:d,samples:l,numberAACFrames:u,...m}=i;e.setHeader(h,i,m)}if(i.frameLength=8191&(n[3]<<11|n[4]<<3|n[5]>>5),!i.frameLength)return null;const a=2047&(n[5]<<6|n[6]>>2);return i.bufferFullness=2047===a?"VBR":a,new ft(i)}constructor(t){super(t),this.copyrightId=t.copyrightId,this.copyrightIdStart=t.copyrightIdStart,this.bufferFullness=t.bufferFullness,this.isHome=t.isHome,this.isOriginal=t.isOriginal,this.isPrivate=t.isPrivate,this.layer=t.layer,this.length=t.length,this.mpegVersion=t.mpegVersion,this.numberAACFrames=t.numberAACFrames,this.profile=t.profile,this.protection=t.protection}get audioSpecificConfig(){const t=y.get(this),e=t.profileBits+64<<5|t.sampleRateBits<<5|t.channelModeBits>>3,s=new Uint8Array(2);return new DataView(s.buffer).setUint16(0,e,!1),s}}class wt extends g{static*getFrame(t,e,s){return yield*super.getFrame(ft,wt,t,e,s)}constructor(t,e,s){super(t,e,s)}}class pt extends w{constructor(t,e,s){super(t,e),this.Frame=wt,this.Header=ft,s(this.codec)}get codec(){return"aac"}*parseFrame(){return yield*this.fixedLengthFrameSync()}}class gt extends g{static getFrameFooterCrc16(t){return(t[t.length-2]<<8)+t[t.length-1]}static checkFrameFooterCrc16(t){return gt.getFrameFooterCrc16(t)===(t=>{const e=t.length,s=e-16;let i=0,n=0;for(;n<=s;)i^=t[n++]<<8|t[n++],i=h[15][i>>8]^h[14][255&i]^h[13][t[n++]]^h[12][t[n++]]^h[11][t[n++]]^h[10][t[n++]]^h[9][t[n++]]^h[8][t[n++]]^h[7][t[n++]]^h[6][t[n++]]^h[5][t[n++]]^h[4][t[n++]]^h[3][t[n++]]^h[2][t[n++]]^h[1][t[n++]]^h[0][t[n++]];for(;n!==e;)i=(255&i)<<8^h[0][i>>8^t[n++]];return i})(t.subarray(0,-2))}constructor(t,e,s){e.streamInfo=s,e.crc16=gt.getFrameFooterCrc16(t),super(e,t,y.get(e).samples)}}const bt="get from STREAMINFO metadata block",St={0:"Fixed",1:"Variable"},At={0:b,16:192};for(let t=2;t<16;t++)At[t<<4]=t<6?576*2**(t-2):2**t;const qt={0:bt,1:88200,2:176400,3:192e3,4:z,5:L,6:F,7:k,8:O,9:D,10:U,11:96e3,15:S},Mt={0:{channels:1,description:I},16:{channels:2,description:$(2,T[0][0])},32:{channels:3,description:$(3,T[0][1])},48:{channels:4,description:$(4,T[1][0],T[3][0])},64:{channels:5,description:$(5,T[1][1],T[3][0])},80:{channels:6,description:$(6,T[1][1],P,T[3][0])},96:{channels:7,description:$(7,T[1][1],P,T[3][4],T[2][0])},112:{channels:8,description:$(8,T[1][1],P,T[3][0],T[2][0])},128:{channels:2,description:`${C} (left, diff)`},144:{channels:2,description:`${C} (diff, right)`},160:{channels:2,description:`${C} (avg, diff)`},176:b,192:b,208:b,224:b,240:b},vt={0:bt,2:8,4:12,6:b,8:16,10:20,12:24,14:b};class Et extends V{static decodeUTF8Int(t){if(t[0]>254)return null;if(t[0]<128)return{value:t[0],length:1};let e=1;for(let s=64;s&t[0];s>>=1)e++;let s=e-1,i=0,n=0;for(;s>0;n+=6,s--){if(128!=(192&t[s]))return null;i|=(63&t[s])<<n}return i|=(t[s]&127>>e)<<n,{value:i,length:e}}static getHeaderFromUint8Array(t,e){const s={readRawData:function*(){return t}};return Et.getHeader(s,e,0).next().value}static*getHeader(t,e,s){let i=yield*t.readRawData(6,s);if(255!==i[0]||248!==i[1]&&249!==i[1])return null;const h={},r=c(i.subarray(0,4)),a=e.getHeader(r);if(a)Object.assign(h,a);else{if(h.blockingStrategyBits=1&i[1],h.blockingStrategy=St[h.blockingStrategyBits],h.blockSizeBits=240&i[2],h.sampleRateBits=15&i[2],h.blockSize=At[h.blockSizeBits],h.blockSize===b)return null;if(h.sampleRate=qt[h.sampleRateBits],h.sampleRate===S)return null;if(1&i[3])return null;const t=Mt[240&i[3]];if(t===b)return null;if(h.channels=t.channels,h.channelMode=t.description,h.bitDepth=vt[14&i[3]],h.bitDepth===b)return null}h.length=5,i=yield*t.readRawData(h.length+8,s);const o=Et.decodeUTF8Int(i.subarray(4));if(!o)return null;if(h.blockingStrategyBits?h.sampleNumber=o.value:h.frameNumber=o.value,h.length+=o.length,96===h.blockSizeBits?(i.length<h.length&&(i=yield*t.readRawData(h.length,s)),h.blockSize=i[h.length-1]+1,h.length+=1):112===h.blockSizeBits&&(i.length<h.length&&(i=yield*t.readRawData(h.length,s)),h.blockSize=(i[h.length-1]<<8)+i[h.length]+1,h.length+=2),h.samples=h.blockSize,12===h.sampleRateBits?(i.length<h.length&&(i=yield*t.readRawData(h.length,s)),h.sampleRate=1e3*i[h.length-1],h.length+=1):13===h.sampleRateBits?(i.length<h.length&&(i=yield*t.readRawData(h.length,s)),h.sampleRate=(i[h.length-1]<<8)+i[h.length],h.length+=2):14===h.sampleRateBits&&(i.length<h.length&&(i=yield*t.readRawData(h.length,s)),h.sampleRate=10*((i[h.length-1]<<8)+i[h.length]),h.length+=2),i.length<h.length&&(i=yield*t.readRawData(h.length,s)),h.crc=i[h.length-1],h.crc!==(t=>{let e=0;const s=t.length;for(let i=0;i!==s;i++)e=n[e^t[i]];return e})(i.subarray(0,h.length-1)))return null;if(!a){const{blockingStrategyBits:t,frameNumber:s,sampleNumber:i,samples:n,sampleRateBits:a,blockSizeBits:o,crc:c,length:d,...l}=h;e.setHeader(r,h,l)}return new Et(h)}constructor(t){super(t),this.crc16=null,this.blockingStrategy=t.blockingStrategy,this.blockSize=t.blockSize,this.frameNumber=t.frameNumber,this.sampleNumber=t.sampleNumber,this.streamInfo=null}}class _t extends w{constructor(t,e){super(t,e),this.Frame=gt,this.Header=Et}get codec(){return"flac"}*I(t){const e=yield*this.T.readRawData(2,0),s=e.length-2;for(;t<s;){if(255===e[t]){const s=e[t+1];if(248===s||249===s)break;255!==s&&t++}t++}return t}*parseFrame(){for(;;){const t=yield*Et.getHeader(this.T,this.A,0);if(t){let e=y.get(t).length+2;for(;e<=524288;){if(this.T.P||(yield*Et.getHeader(this.T,this.A,e))){let s=yield*this.T.readRawData(e);if(this.T.P||(s=s.subarray(0,e)),gt.checkFrameFooterCrc16(s)){const i=new gt(s,t);return this.A.enable(),this.T.incrementRawData(e),this.T.mapFrameStats(i),i}}e=yield*this.I(e+1)}this.T.logWarning(`Unable to sync FLAC frame after searching ${e} bytes.`),this.T.incrementRawData(e)}else this.T.incrementRawData(yield*this.I(1))}}parseOggPage(t){return 0===t.pageSequenceNumber?(this.A.enable(),this.C=t.data.subarray(13)):1===t.pageSequenceNumber||(t.codecFrames=f.get(t).segments.map((t=>{const e=Et.getHeaderFromUint8Array(t,this.A);if(e)return new gt(t,e,this.C);this.T.logWarning("Failed to parse Ogg FLAC frame","Skipping invalid FLAC frame")})).filter((t=>Boolean(t)))),t}}class Tt{static*getHeader(t,e,s){const i={};let n=yield*t.readRawData(28,s);if(79!==n[0]||103!==n[1]||103!==n[2]||83!==n[3])return null;i.streamStructureVersion=n[4];if(248&n[5])return null;i.isLastPage=Boolean(4&n[5]),i.isFirstPage=Boolean(2&n[5]),i.isContinuedPacket=Boolean(1&n[5]);const h=new DataView(Uint8Array.from(n.subarray(0,28)).buffer);try{i.absoluteGranulePosition=h.getBigInt64(6,!0)}catch{}i.streamSerialNumber=h.getInt32(14,!0),i.pageSequenceNumber=h.getInt32(18,!0),i.pageChecksum=h.getInt32(22,!0);const r=n[26];i.length=r+27,n=yield*t.readRawData(i.length,s),i.frameLength=0,i.pageSegmentTable=[],i.pageSegmentBytes=Uint8Array.from(n.subarray(27,i.length));for(let t=0,e=0;t<r;t++){const s=i.pageSegmentBytes[t];i.frameLength+=s,e+=s,255===s&&t!==r-1||(i.pageSegmentTable.push(e),e=0)}return new Tt(i)}constructor(t){y.set(this,t),this.absoluteGranulePosition=t.absoluteGranulePosition,this.isContinuedPacket=t.isContinuedPacket,this.isFirstPage=t.isFirstPage,this.isLastPage=t.isLastPage,this.pageSegmentTable=t.pageSegmentTable,this.pageSequenceNumber=t.pageSequenceNumber,this.pageChecksum=t.pageChecksum,this.streamSerialNumber=t.streamSerialNumber}}class Pt extends p{static*getFrame(t,e,s){const i=yield*Tt.getHeader(t,e,s);if(i){const e=y.get(i).frameLength,s=y.get(i).length,n=s+e,h=(yield*t.readRawData(n,0)).subarray(0,n),r=h.subarray(s,n);return new Pt(i,r,h)}return null}constructor(t,e,s){super(t,e),f.get(this).length=s.length,this.codecFrames=[],this.rawData=s,this.absoluteGranulePosition=t.absoluteGranulePosition,this.crc32=t.pageChecksum,this.duration=0,this.isContinuedPacket=t.isContinuedPacket,this.isFirstPage=t.isFirstPage,this.isLastPage=t.isLastPage,this.pageSequenceNumber=t.pageSequenceNumber,this.samples=0,this.streamSerialNumber=t.streamSerialNumber}}class It extends g{constructor(t,e){super(e,t,e.frameSize*e.frameCount/1e3*e.sampleRate)}}const Ct={0:B.slice(0,2),1:B},Rt="SILK-only",xt="CELT-only",$t="Hybrid",Bt="narrowband",Ut="medium-band",Dt="wideband",Ot="super-wideband",kt="fullband",Ft={0:{mode:Rt,bandwidth:Bt,frameSize:10},8:{mode:Rt,bandwidth:Bt,frameSize:20},16:{mode:Rt,bandwidth:Bt,frameSize:40},24:{mode:Rt,bandwidth:Bt,frameSize:60},32:{mode:Rt,bandwidth:Ut,frameSize:10},40:{mode:Rt,bandwidth:Ut,frameSize:20},48:{mode:Rt,bandwidth:Ut,frameSize:40},56:{mode:Rt,bandwidth:Ut,frameSize:60},64:{mode:Rt,bandwidth:Dt,frameSize:10},72:{mode:Rt,bandwidth:Dt,frameSize:20},80:{mode:Rt,bandwidth:Dt,frameSize:40},88:{mode:Rt,bandwidth:Dt,frameSize:60},96:{mode:$t,bandwidth:Ot,frameSize:10},104:{mode:$t,bandwidth:Ot,frameSize:20},112:{mode:$t,bandwidth:kt,frameSize:10},120:{mode:$t,bandwidth:kt,frameSize:20},128:{mode:xt,bandwidth:Bt,frameSize:2.5},136:{mode:xt,bandwidth:Bt,frameSize:5},144:{mode:xt,bandwidth:Bt,frameSize:10},152:{mode:xt,bandwidth:Bt,frameSize:20},160:{mode:xt,bandwidth:Dt,frameSize:2.5},168:{mode:xt,bandwidth:Dt,frameSize:5},176:{mode:xt,bandwidth:Dt,frameSize:10},184:{mode:xt,bandwidth:Dt,frameSize:20},192:{mode:xt,bandwidth:Ot,frameSize:2.5},200:{mode:xt,bandwidth:Ot,frameSize:5},208:{mode:xt,bandwidth:Ot,frameSize:10},216:{mode:xt,bandwidth:Ot,frameSize:20},224:{mode:xt,bandwidth:kt,frameSize:2.5},232:{mode:xt,bandwidth:kt,frameSize:5},240:{mode:xt,bandwidth:kt,frameSize:10},248:{mode:xt,bandwidth:kt,frameSize:20}};class Lt extends V{static getHeaderFromUint8Array(t,e,s){const i={};if(i.channels=t[9],i.channelMappingFamily=t[18],i.length=0!==i.channelMappingFamily?21+i.channels:19,t.length<i.length)throw new Error("Out of data while inside an Ogg Page");const n=3&e[0],h=3===n?2:1,r=c(t.subarray(0,i.length))+c(e.subarray(0,h)),a=s.getHeader(r);if(a)return new Lt(a);if("OpusHead"!==r.substr(0,8))return null;if(1!==t[8])return null;i.data=Uint8Array.from(t.subarray(0,i.length));const o=new DataView(i.data.buffer);if(i.bitDepth=16,i.preSkip=o.getUint16(10,!0),i.inputSampleRate=o.getUint32(12,!0),i.sampleRate=U,i.outputGain=o.getInt16(16,!0),i.channelMappingFamily in Ct&&(i.channelMode=Ct[i.channelMappingFamily][i.channels-1],!i.channelMode))return null;0!==i.channelMappingFamily&&(i.streamCount=t[19],i.coupledStreamCount=t[20],i.channelMappingTable=[...t.subarray(21,i.channels+21)]);const d=Ft[248&e[0]];switch(i.mode=d.mode,i.bandwidth=d.bandwidth,i.frameSize=d.frameSize,n){case 0:i.frameCount=1;break;case 1:case 2:i.frameCount=2;break;case 3:i.isVbr=Boolean(128&e[1]),i.hasOpusPadding=Boolean(64&e[1]),i.frameCount=63&e[1];break;default:return null}const{length:l,data:u,channelMappingFamily:m,...y}=i;return s.setHeader(r,i,y),new Lt(i)}constructor(t){super(t),this.data=t.data,this.bandwidth=t.bandwidth,this.channelMappingFamily=t.channelMappingFamily,this.channelMappingTable=t.channelMappingTable,this.coupledStreamCount=t.coupledStreamCount,this.frameCount=t.frameCount,this.frameSize=t.frameSize,this.hasOpusPadding=t.hasOpusPadding,this.inputSampleRate=t.inputSampleRate,this.isVbr=t.isVbr,this.mode=t.mode,this.outputGain=t.outputGain,this.preSkip=t.preSkip,this.streamCount=t.streamCount}}class zt extends w{constructor(t,e){super(t,e),this.Frame=It,this.Header=Lt,this.R=null}get codec(){return"opus"}parseOggPage(t){return 0===t.pageSequenceNumber?(this.A.enable(),this.R=t.data):1===t.pageSequenceNumber||(t.codecFrames=f.get(t).segments.map((t=>{const e=Lt.getHeaderFromUint8Array(this.R,t,this.A);if(e)return new It(t,e);this.T.logError("Failed to parse Ogg Opus Header","Not a valid Ogg Opus file")}))),t}}class Nt extends g{constructor(t,e,s){super(e,t,s)}}const Vt={};for(let t=0;t<8;t++)Vt[t+6]=2**(6+t);class Gt extends V{static getHeaderFromUint8Array(t,e){if(t.length<30)throw new Error("Out of data while inside an Ogg Page");const s=c(t.subarray(0,30)),i=e.getHeader(s);if(i)return new Gt(i);const n={length:30};if("vorbis"!==s.substr(0,7))return null;n.data=Uint8Array.from(t.subarray(0,30));const h=new DataView(n.data.buffer);if(n.version=h.getUint32(7,!0),0!==n.version)return null;if(n.channels=t[11],n.channelMode=B[n.channels-1]||"application defined",n.sampleRate=h.getUint32(12,!0),n.bitrateMaximum=h.getInt32(16,!0),n.bitrateNominal=h.getInt32(20,!0),n.bitrateMinimum=h.getInt32(24,!0),n.blocksize1=Vt[(240&t[28])>>4],n.blocksize0=Vt[15&t[28]],n.blocksize0>n.blocksize1)return null;if(1!==t[29])return null;n.bitDepth=32;{const{length:t,data:i,version:h,...r}=n;e.setHeader(s,n,r)}return new Gt(n)}constructor(t){super(t),this.bitrateMaximum=t.bitrateMaximum,this.bitrateMinimum=t.bitrateMinimum,this.bitrateNominal=t.bitrateNominal,this.blocksize0=t.blocksize0,this.blocksize1=t.blocksize1,this.data=t.data,this.vorbisComments=null,this.vorbisSetup=null}}class Wt extends w{constructor(t,e){super(t,e),this.Frame=Nt,this.R=null,this.$={count:0},this.B=0,this.U=0}get codec(){return"vorbis"}parseOggPage(t){const e=f.get(t).segments;return 0===t.pageSequenceNumber?(this.A.enable(),this.R=t.data):1===t.pageSequenceNumber?e[1]&&(this.D=e[0],this.O=e[1],this.$=this.k(e[1])):t.codecFrames=e.map((t=>{const e=Gt.getHeaderFromUint8Array(this.R,this.A);if(e)return e.vorbisComments=this.D,e.vorbisSetup=this.O,new Nt(t,e,this.F(t,e));this.T.logError("Failed to parse Ogg Vorbis Header","Not a valid Ogg Vorbis file")})),t}F(t,e){const s=t[0]>>1,i=this.$[s&this.$.mask];i&&(this.B=s&this.$.prevMask?e.blocksize1:e.blocksize0),this.U=i?e.blocksize1:e.blocksize0;const n=this.B+this.U>>2;return this.B=this.U,n}k(t){const e=new u(t),s="Failed to read Vorbis stream",i=", failed to parse vorbis modes";let n,h={count:0};for(;1!=(1&e.read(1)););for(;h.count<64&&e.position>0;){const t=l(e.read(8));if(t in h&&(1!==h.count||0!==t))throw this.T.logError("received duplicate mode mapping"+i),new Error(s);let r=0;for(;0===e.read(8)&&r++<3;);if(4!==r){if(1+((126&l(n))>>1)!==h.count)throw this.T.logError("mode count did not match actual modes"+i),new Error(s);break}n=e.read(7),h[t]=1&n,e.position+=6,h.count++}return h.mask=(1<<Math.log2(h.count))-1,h.prevMask=1+(1|h.mask),h}}class Ht extends w{constructor(t,e,s){super(t,e),this.L=s,this.Frame=Pt,this.Header=Tt,this.N=null,this.V=new Uint8Array,this.G=0}get codec(){return this.N||""}W(t,e){this.N!==t&&(this.H=new e(this.T,this.A),this.N=t,this.L(t))}Y({data:t}){const e=c(t.subarray(0,8));switch(e){case"fishead\0":case"fisbone\0":case"index\0\0\0":return!1;case"OpusHead":return this.W("opus",zt),!0;case/^\x7fFLAC/.test(e)&&e:return this.W("flac",_t),!0;case/^\x01vorbis/.test(e)&&e:return this.W("vorbis",Wt),!0}}K(t){t.pageSequenceNumber!==this.G+1&&this.G>1&&t.pageSequenceNumber>1&&this.T.logWarning("Unexpected gap in Ogg Page Sequence Number.",`Expected: ${this.G+1}, Got: ${t.pageSequenceNumber}`),this.G=t.pageSequenceNumber}*parseFrame(){const t=yield*this.fixedLengthFrameSync(!0);this.K(t);const e=f.get(t),{pageSegmentBytes:s,pageSegmentTable:i}=y.get(e.header);let n=0;if(e.segments=i.map((e=>t.data.subarray(n,n+=e))),255===s[s.length-1]?this.V=o(this.V,e.segments.pop()):this.V.length&&(e.segments[0]=o(this.V,e.segments[0]),this.V=new Uint8Array),this.N||this.Y(t)){const e=this.H.parseOggPage(t);return this.T.mapFrameStats(e),e}}}const jt=()=>{};const Qt=class{constructor(t,{onCodecUpdate:e,onCodec:s,enableLogging:i=!1,enableFrameCRC32:n=!0}={}){this.J=t,this.L=s||jt,this.h=e,this.X=i,this.tt=n?a:jt,this.et=this.st(),this.et.next()}get codec(){return this.H.codec}*flush(){this.P=!0;for(let t=this.et.next();t.value;t=this.et.next())yield t.value;this.P=!1,this.et=this.st(),this.et.next()}*parseChunk(t){for(let e=this.et.next(t);e.value;e=this.et.next())yield e.value}parseAll(t){return[...this.parseChunk(t),...this.flush()]}*st(){if(this.A=new m(this.h),this.J.match(/aac/))this.H=new pt(this,this.A,this.L);else if(this.J.match(/mpeg/))this.H=new ot(this,this.A,this.L);else if(this.J.match(/flac/))this.H=new _t(this,this.A,this.L);else{if(!this.J.match(/ogg/))throw new Error(`Unsupported Codec ${mimeType}`);this.H=new Ht(this,this.A,this.L)}for(this.it=0,this.nt=0,this.ht=0,this.rt=0,this.ot=0,this.ct=void 0,this.dt=new Uint8Array(0);;){const t=yield*this.H.parseFrame();t&&(yield t)}}*readRawData(t=0,e=0){let s;for(;this.dt.length<=t+e;){if(s=yield,this.P)return this.dt.subarray(e);s&&(this.ht+=s.length,this.dt=o(this.dt,s))}return this.dt.subarray(e)}incrementRawData(t){this.nt+=t,this.dt=this.dt.subarray(t)}mapCodecFrameStats(t){this.ct=t.header.sampleRate,t.header.bitrate=8*Math.round(t.data.length/t.duration),t.frameNumber=this.it++,t.totalBytesOut=this.rt,t.totalSamples=this.ot,t.totalDuration=this.ot/this.ct*1e3,t.crc32=this.tt(t.data),this.A.checkCodecUpdate(t.header.bitrate,t.totalDuration),this.rt+=t.data.length,this.ot+=t.samples}mapFrameStats(t){t.codecFrames?(t.codecFrames.forEach((e=>{t.duration+=e.duration,t.samples+=e.samples,this.mapCodecFrameStats(e)})),t.totalSamples=this.ot,t.totalDuration=this.ot/this.ct*1e3||0,t.totalBytesOut=this.rt):this.mapCodecFrameStats(t)}lt(t,e){if(this.X){const s=[`codec:         ${this.codec}`,`inputMimeType: ${this.J}`,`readPosition:  ${this.nt}`,`totalBytesIn:  ${this.ht}`,`totalBytesOut: ${this.rt}`],i=Math.max(...s.map((t=>t.length)));e.push(`--stats--${"-".repeat(i-9)}`,...s,"-".repeat(i)),t("codec-parser",e.reduce(((t,e)=>t+"\n  "+e),""))}}logWarning(...t){this.lt(console.warn,t)}logError(...t){this.lt(console.error,t)}}}},i={};function n(t){var e=i[t];if(void 0!==e)return e.exports;var h=i[t]={exports:{}};return s[t](h,h.exports,n),h.exports}n.m=s,n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.f={},n.e=t=>Promise.all(Object.keys(n.f).reduce(((e,s)=>(n.f[s](t,e),e)),[])),n.u=t=>"icecast-metadata-player-1.15.0."+t+".min.js",n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t={},e="IcecastMetadataPlayer:",n.l=(s,i,h,r)=>{if(t[s])t[s].push(i);else{var a,o;if(void 0!==h)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var l=c[d];if(l.getAttribute("src")==s||l.getAttribute("data-webpack")==e+h){a=l;break}}a||(o=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",e+h),a.src=s),t[s]=[i];var u=(e,i)=>{a.onerror=a.onload=null,clearTimeout(m);var n=t[s];if(delete t[s],a.parentNode&&a.parentNode.removeChild(a),n&&n.forEach((t=>t(i))),e)return e(i)},m=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),o&&document.head.appendChild(a)}},n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"ut",{value:!0})},(()=>{var t;n.g.importScripts&&(t=n.g.location+"");var e=n.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var s=e.getElementsByTagName("script");s.length&&(t=s[s.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t})(),(()=>{var t={main:0};n.f.j=(e,s)=>{var i=n.o(t,e)?t[e]:void 0;if(0!==i)if(i)s.push(i[2]);else{var h=new Promise(((s,n)=>i=t[e]=[s,n]));s.push(i[2]=h);var r=n.p+n.u(e),a=new Error;n.l(r,(s=>{if(n.o(t,e)&&(0!==(i=t[e])&&(t[e]=void 0),i)){var h=s&&("load"===s.type?"missing":s.type),r=s&&s.target&&s.target.src;a.message="Loading chunk "+e+" failed.\n("+h+": "+r+")",a.name="ChunkLoadError",a.type=h,a.request=r,i[1](a)}}),"chunk-"+e,e)}};var e=(e,s)=>{var i,h,[r,a,o]=s,c=0;if(r.some((e=>0!==t[e]))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(o)o(n)}for(e&&e(s);c<r.length;c++)h=r[c],n.o(t,h)&&t[h]&&t[h][0](),t[h]=0},s=self.webpackChunkIcecastMetadataPlayer=self.webpackChunkIcecastMetadataPlayer||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})();var h={};(()=>{n.d(h,{default:()=>ae});const t=()=>{},e=new WeakMap,s={LOADING:"loading",PLAYING:"playing",STOPPING:"stopping",STOPPED:"stopped",RETRYING:"retrying",SWITCHING:"switching"},i={BUFFER:"buffer",PLAY:"play",PLAY_READY:"playready",LOAD:"load",STREAM_START:"streamstart",STREAM:"stream",STREAM_END:"streamend",METADATA:"metadata",METADATA_ENQUEUE:"metadataenqueue",CODEC_UPDATE:"codecupdate",STOP:"stop",RETRY:"retry",RETRY_TIMEOUT:"retrytimeout",SWITCH:"switch",WARN:"warn",ERROR:"error",PLAYBACK_ERROR:"playbackerror"},r=Symbol(),a=Symbol(),o=Symbol(),c=Symbol(),d=Symbol(),l=Symbol(),u=Symbol(),m=Symbol(),y=Symbol(),f=Symbol(),w=Symbol(),p=Symbol(),g=Symbol(),b=Symbol(),S=Symbol(),A=Symbol(),q=Symbol(),M=Symbol(),v=Symbol(),E=Symbol(),_=Symbol(),T=Symbol(),P=Symbol("synced"),I=Symbol("syncing"),C=Symbol("pcm_synced"),R=Symbol("not_synced"),x=t=>{const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));return t.reduce(((t,s)=>(e.set(s,t),t+s.length)),0),e};class ${constructor(){this.yt=[]}hasEventListener(t,e){return this.yt.some((s=>s.type===t&&s.listener===e))}addEventListener(t,e,s={}){return this.hasEventListener(t,e)||this.yt.push({type:t,listener:e,options:s}),this}removeEventListener(t,e){const s=this.yt.findIndex((s=>s.type===t&&s.listener===e));return s>=0&&this.yt.splice(s,1),this}removeEventListeners(){return this.yt=[],this}dispatchEvent(t){return this.yt.filter((e=>e.type===t.type)).forEach((e=>{const{type:s,listener:i,options:{once:n}}=e;i.call(this,t),!0===n&&this.removeEventListener(s,i)})),this}}class B{constructor(){this.ft=0,this.wt=0,this.gt=0,this.bt=0,this.St=0,this.At=0,this.qt=0}get stats(){return{totalBytesRead:this.ft,streamBytesRead:this.wt,metadataLengthBytesRead:this.gt,metadataBytesRead:this.bt,currentBytesRemaining:this.St,currentStreamBytesRemaining:this.At,currentMetadataBytesRemaining:this.qt}}set currentStreamBytesRemaining(t){this.At+=t}set currentMetadataBytesRemaining(t){this.qt=t}addBytes(t){this.ft+=t,this.St-=t}addStreamBytes(t){this.wt+=t,this.At-=t}addMetadataLengthBytes(t){this.gt+=t}addMetadataBytes(t){this.bt+=t,this.qt-=t}addCurrentBytesRemaining(t){this.St+=t}}const U=()=>{};class D{constructor(t){this.Mt=0,this.vt=0,this.Et=new Uint8Array(0),this._t=[],this.Tt=0,this.Pt=new B,this.It=t.onStream||U,this.Ct=t.onMetadata||U,this.Rt=t.onMetadataFailed||U,this.xt=t.onError||U,this.X=t.enableLogging||!1,this.$t=Promise.resolve(),this.Bt=Promise.resolve(),this.et=this.Ut(),this.et.next()}*Ut(){for(this.Mt=1/0;;)this.Dt(yield*this.Ot()),yield*this.kt()}static Ft(...t){const e=t.reduce(((t,e)=>t+e.length),0);return this.Lt(t,e)}static Lt(t,e){const s=new Uint8Array(e);return t.reduce(((t,e)=>(s.set(e,t),t+e.length)),0),s}*iterator(t){for(let e=this.et.next(t);e.value;e=this.et.next())yield e.value}readAll(t){for(let e=this.et.next(t);e.value;e=this.et.next());}async*asyncIterator(t){for(let e=this.et.next(t);e.value;e=this.et.next())await this.$t,await this.Bt,yield e.value}async asyncReadAll(t){for(let e=this.et.next(t);e.value;e=this.et.next())await this.$t,await this.Bt}zt(...t){this.X&&console.warn("icecast-metadata-js",t.reduce(((t,e)=>t+"\n  "+e),"")),this.xt(...t)}Dt(t){this._t.push(t),this.Tt+=t.length}*kt(){if(this._t.length){const t=D.Lt(this._t,this.Tt);this._t=[],this.Tt=0,this.Pt.addStreamBytes(t.length);const e={stream:t,stats:this.Pt.stats};this.$t=this.It(e),yield e}}*Nt(t){yield*this.kt();const e={metadata:t,stats:this.Pt.stats};this.Bt=this.Ct(e),yield e}*Ot(t=0){for(this.vt===this.Et.length&&(this.Et=yield*this.Vt(),this.vt=0);this.Et.length-this.vt<t;)this.Et=D.Ft(this.Et,yield*this.Vt());const e=this.Et.subarray(this.vt,(t||this.Mt)+this.vt);return this.Pt.addBytes(e.length),this.Mt=e.length<this.Mt?this.Mt-e.length:0,this.vt+=e.length,e}*Vt(){let t;yield*this.kt();do{t=yield}while(!t||0===t.length);return this.Pt.addCurrentBytesRemaining(t.length),t}}class O extends D{constructor({icyMetaInt:t,icyDetectionTimeout:e=2e3,icyCharacterEncoding:s="utf-8",...i}){super(i),this.Gt=new globalThis.TextDecoder(s),this.Wt=t,this.Ht=e,this.et=this.jt(),this.et.next()}*jt(){if(yield*this.Qt())for(;;)this.Mt=this.Wt,yield*this.Yt(),yield*this.Kt(),this.Mt&&(yield*this.Zt());this.Mt=1/0,yield*this.Yt()}static parseIcyMetadata(t){const e=/(?<key>[^\0]+?)='(?<val>[^\0]*?)(;$|';|'$|$)/,s={};for(const i of t.match(new RegExp(e,"g"))||[]){const t=i.match(e);t&&(s[t.groups.key]=t.groups.val)}return s}get icyMetaInt(){return this.Wt}*Qt(){if(this.Wt>0)return!0;if(!this.Ht)return!1;this.zt("Passed in Icy-MetaInt is invalid. Attempting to detect ICY Metadata.","See https://github.com/eshaz/icecast-metadata-js for information on how to properly request ICY Metadata.");const t=[null,83,116,114,101,97,109,84,105,116,108,101,61],e=Date.now();let s=0;for(;e+this.Ht>Date.now();){this.Et=D.Ft(this.Et,yield*this.Vt());t:for(;s<this.Et.length-t.length;){for(let e=1;e<t.length;e++)if(this.Et[e+s]!==t[e]){s++;continue t}return this.zt(`Found ICY Metadata! Setting Icy-MetaInt to ${s}.`),this.Wt=s,!0}}return this.zt("ICY Metadata not detected, but continuing anyway. Audio errors will occur if there is ICY metadata.",`Searched ${this.Et.length} bytes for ${(Date.now()-e)/1e3} seconds.`,"Try increasing the `icyDetectionTimeout` value if ICY metadata is present in the stream."),this.Rt("icy"),!1}*Yt(){for(this.Pt.currentStreamBytesRemaining=this.Mt;this.Mt;)this.Dt(yield*super.Ot())}*Kt(){this.Mt=1;do{this.Mt=16*(yield*this.Ot())[0]}while(1===this.Mt);this.Pt.addMetadataLengthBytes(1)}*Zt(){this.Pt.currentMetadataBytesRemaining=this.Mt;const t=yield*this.Ot(this.Mt);this.Pt.addMetadataBytes(t.length),yield*this.Nt(O.parseIcyMetadata(this.Gt.decode(t)))}}class k extends D{constructor(t){super(t),this.Gt=new globalThis.TextDecoder("utf-8"),this.et=this.Jt(),this.et.next(),this.Xt=!1}*Jt(){if(yield*this.te()){const t=yield*this.ee();if(t)for(;yield*this.te();)this.Xt||(yield*this.Zt(t)),yield*this.Yt()}this.Mt=1/0,yield*this.Yt()}se(t,e=0){return new DataView(Uint8Array.from([...t.subarray(e,e+4)]).buffer).getUint32(0,!0)}ie(t,e){return String.fromCharCode(...e).match(t)}*te(){let t=[];for(;t.length<=65307;){const e=yield*super.Ot(6);if(79===e[0]&&103===e[1]&&103===e[2]&&83===e[3]&&!(248&e[5])){this.Xt=1&e[5],this.vt-=6,this.Mt+=6,this.Pt.ft-=6,this.Pt.St+=6;break}t.push(e[0]),this.vt-=5,this.Pt.ft-=5,this.Pt.St+=5}if(t.length&&this.Dt(Uint8Array.from(t)),t.length>65307)return this.zt("This stream is not an OGG stream. No OGG metadata will be returned.","See https://github.com/eshaz/icecast-metadata-js for information on OGG metadata."),this.Rt("ogg"),!1;const e=yield*this.Ot(27),s=yield*this.Ot(e[26]);return this.Mt=s.reduce(((t,e)=>t+e),0),!0}*ee(){const t=yield*this.Ot(8);return yield*this.Yt(),this.ie(/\x7fFLAC/,t.subarray(0,5))?{regex:/^[\x84|\x04]/,length:4}:this.ie(/OpusHead/,t.subarray(0,8))?{regex:/OpusTags/,length:8}:this.ie(/\x01vorbis/,t.subarray(0,7))?{regex:/\x03vorbis/,length:7}:void 0}*Zt({regex:t,length:e}){this.ie(t,yield*this.Ot(e))&&(yield*this.Nt(yield*this.ne()))}*Yt(){for(;this.Mt;)yield*this.Ot()}*Ot(t){const e=yield*super.Ot(t);return this.Dt(e),e}*Vt(){const t=yield*super.Vt();return this.Pt.currentStreamBytesRemaining=t.length,t}*ne(){const t=this.se(yield*this.Ot(4));this.Pt.addMetadataBytes(4);const e=this.Gt.decode(yield*this.Ot(t));this.Pt.addMetadataBytes(t);const s=this.se(yield*this.Ot(4));this.Pt.addMetadataBytes(4);const i=[];for(let t=0;t<s;t++){const t=yield*this.Ot(4);this.Pt.addMetadataBytes(4),i.push(yield*this.Ot(this.se(t))),this.Pt.addMetadataBytes(i[i.length-1].length)}return this.Pt.currentMetadataBytesRemaining=0,i.reduce(((t,e)=>{const s=e.indexOf(61),i=String.fromCharCode(...e.subarray(0,s)).toUpperCase(),n=this.Gt.decode(e.subarray(s+1));return t[i]=t[i]?`${t[i]}; ${n}`:n,t}),{VENDOR_STRING:e})}}class F{constructor(t){const{onStream:e,...s}=t;this.he=new k(t),this.re=new O(s)}get icyMetaInt(){return this.re.icyMetaInt}*iterator(t){for(const e of this.re.iterator(t))e.stream?yield*this.he.iterator(e.stream):yield e}readAll(t){for(const e of this.re.iterator(t))e.stream&&this.he.readAll(e.stream)}async*asyncIterator(t){for await(const e of this.re.asyncIterator(t))if(e.stream)for await(const t of this.he.asyncIterator(e.stream))yield t;else yield e}async asyncReadAll(t){for await(const e of this.re.iterator(t))e.stream&&await this.he.asyncReadAll(e.stream)}}class L{constructor({metadataTypes:t=["icy"],...e}={}){const s=t.includes("icy"),i=t.includes("ogg");this.ae=s&&i?new F(e):i?new k(e):s?new O(e):new D(e)}static parseIcyMetadata(t){return O.parseIcyMetadata(t)}get icyMetaInt(){return this.ae.icyMetaInt}*iterator(t){yield*this.ae.iterator(t)}readAll(t){this.ae.readAll(t)}async*asyncIterator(t){return yield*this.ae.asyncIterator(t)}async asyncReadAll(t){return this.ae.asyncReadAll(t)}}const z=()=>{};class N{constructor(t,{onStream:e=z,...s}){let i;this.oe=new ReadableStream({async start(n){i=new L({icyMetaInt:parseInt(t.headers.get("Icy-MetaInt")),...s,onStream:async t=>(n.enqueue(t.stream),e(t))});for await(const e of N.asyncIterator(t.body))await i.asyncReadAll(e);n.close()}}),this.ce=i}get icyMetaInt(){return this.ce.icyMetaInt}get readableStream(){return this.oe}async startReading(){try{for await(const t of N.asyncIterator(this.oe));}catch(t){if("AbortError"!==t.name)throw t}}static asyncIterator(t){const e=t.getReader();return{[Symbol.asyncIterator]:()=>({next:()=>e.read()})}}}const V=()=>{};class G{constructor({icyBr:t,onMetadataUpdate:e=V,onMetadataEnqueue:s=V,paused:i=!1}){this.de=t,this.le=e,this.ue=s,this.me=i,this.ye=i,this.fe=!0,this.we=[],this.pe=[]}get metadataQueue(){return this.pe.map((({ge:t,...e})=>e))}addMetadata({metadata:t,stats:e},s,i=0){const n={metadata:t,timestampOffset:s,timestamp:i+=e?this.getTimeByBytes(e.currentStreamPosition):0};this.ye?this.we.push(n):this.be(n)}getTimeByBytes(t){return this.de?t/(125*this.de):0}startQueue(t){this.ye&&(this.we.forEach((e=>{void 0!==t&&(e.timestamp=t),(void 0===t||e.timestampOffset>=e.timestamp)&&this.be(e)})),this.we=[],this.ye=!1)}purgeMetadataQueue(){this.pe.forEach((t=>clearTimeout(t.ge))),this.pe=[],this.we=[],this.ye=this.me,this.fe=!0}be(t){this.pe.push(t),this.ue(t.metadata,t.timestampOffset,t.timestamp),this.fe?(this.Se(),this.fe=!1):t.ge=setTimeout((()=>{this.Se()}),1e3*(t.timestampOffset-t.timestamp))}Se(){if(this.pe.length){const{metadata:t,timestampOffset:e,timestamp:s}=this.pe.shift();this.le(t,e,s)}}}var W=n(273);class H{constructor(t,e){this.CRC_DURATION=3e5,this.PCM_DURATION=6e4,this.ce=t,this.Ae=e,this.initSync(),this.initQueue()}initSync(){clearTimeout(this.qe),this.qe=null,this.Me=null,this.ve=!1,this.Ee=[],this._e=0,this.Te=null,this.Pe=null,this.Ie=null}initQueue(){this.Ce=0,this.Re=0,this.xe=0,this.$e=[],this.Be=0,this.Ue={},this.De=[],this.Oe=0}get buffered(){return this.Re/this.xe-this.Ae.currentTime||0}add(t){const{crc32:e,duration:s,samples:i}=t;this.Re+=i,this.xe=t.header.sampleRate,this.$e.push({crc32:e,duration:s}),this.Be+=s;let n=this.Ue[e];if(n||(n=[],this.Ue[e]=n),n.push(this.Ce++),this.Be>=this.CRC_DURATION){const{crc32:t,duration:e}=this.$e.shift();this.Be-=e;const s=this.Ue[t];s.shift(),s.length||delete this.Ue[t]}this.De.push(t),this.Oe+=s,this.Oe>=this.PCM_DURATION&&(this.Oe-=this.De.shift().duration)}addAll(t){t.forEach((t=>this.add(t)))}ke(t){for(const e of t)this._e+=e.duration,this.Ee.push(e)}async sync(e){if(null===this.qe){const e=this.buffered;this.Fe=t,this.qe=setTimeout((()=>{this.Me=`Buffer underrun after syncing for ${e.toFixed(2)} seconds.`,this.Fe(this.Me)}),1e3*e)}return this.ke(e),new Promise((async(t,e)=>{let s;null!==this.Me?e(this.Me):this.Fe=e,this.ve&&(s=this.Le()),s||(this.ve=!1,s=await this.ze()),s?t(s):e("Old and new request do not match.")})).catch((t=>{this.ce.state!==s.STOPPING&&this.ce.state!==s.STOPPED&&this.ce[A](i.WARN,`Reconnected successfully after ${this.ce.state}.`,"Unable to sync old and new request.",t);const e=this.Ee;return this.initSync(),this.initQueue(),[e,R]})).then((t=>([P,C].includes(t[1])&&this.initSync(),t)))}Le(){if(!this.Ee.length)return[[],I];const t=this.Ee[0].crc32,e=this.Ue[t];let s,n,h;if(e){t:for(const t of e){h=t-(this.Ce-this.$e.length);for(let t=0;t<this.Ee.length&&h+t<this.$e.length;t++)if(this.$e[h+t].crc32!==this.Ee[t].crc32)continue t;n=h+this.Ee.length<=this.$e.length,s=!0;break}if(n)return[[],I];if(s){const t=this.$e.length-h;return this.ce[A](i.WARN,`Reconnected successfully after ${this.ce.state}.`,`Found ${t} frames (${(this.$e.slice(h).reduce(((t,{duration:e})=>t+e),0)/1e3).toFixed(3)} seconds) of overlapping audio data in new request.`,"Synchronized old and new request."),[this.Ee.slice(t),P]}}}async ze(){try{const t=1,e=16,s=(t,e)=>t/e;if(!this.Te){let h;try{h=(await n.e("synaudio").then(n.bind(n,379))).default}catch(t){return void this.ce[A](i.WARN,"Failed to synchronize old and new stream","Missing `synaudio` dependency.")}const[r,a,o]=await this.Ne(),c=o*t;if(a.samplesDecoded<=c)return[[],I];const d=new h({correlationSampleSize:c,initialGranularity:e});this.Te=await d.syncWorkerConcurrent(r,a,Math.max(navigator.hardwareConcurrency-1,1)),this.Te.offsetFromEnd=s(r.samplesDecoded-this.Te.sampleOffset,o)}const{correlation:h,offsetFromEnd:r}=this.Te;let a=1e3*(this.buffered-r);if(-a>this._e)return[[],I];const o=0;if(a<0){let t=0;for(let e=0;t<this.Ee.length-o&&e>a;t++)e-=this.Ee[t].duration;this.Ee=this.Ee.slice(t-o)}else for(let t=0;t<o&&t<this.Ee.length;t++)a-=this.Ee[t].duration;return this.ce[A](i.WARN,`Reconnected successfully after ${this.ce.state}.`,`Synchronized old and new request with ${(Math.round(1e4*h)/100).toFixed(2)}% confidence.`),this.initQueue(),[this.Ee,C,a]}catch{}}async Ne(){const t=(t,e)=>{let s=t.length-1;for(let i=0;i<e&&s>0;s--)i+=t[s].duration;return this.ce[c].decodeAudioData(x(t.slice(s).map((({data:t})=>t))).buffer)};[this.Pe,this.Ie]=await Promise.all([this.Pe?this.Pe:t(this.De,2e3*this.buffered),t(this.Ee,1/0)]);const e=t=>{const e={channelData:[],samplesDecoded:t.length};for(let s=0;s<t.numberOfChannels;s++)e.channelData.push(Float32Array.from(t.getChannelData(s)));return e};return[e(this.Pe),e(this.Ie),this.Pe.sampleRate]}}class j{constructor(t,s,i){this.ce=t,this.J=s,this.N=i;const n=e.get(this.ce);this.Ve=n[d],this.Ge=n[r],this.We=n[l],this.He=0,this.je=0,this.Qe=()=>{this.syncState=R}}static parseMimeType(t){return t.match(/^(?:application\/|audio\/|)(?<mime>[a-zA-Z]+)(?:$|;[ ]*codecs=(?:\'|\")(?<codecs>[a-zA-Z,]+)(?:\'|\"))/)}static canPlayType(t,e,s){const i=j.parseMimeType(e),n=e=>e.reduce(((e,s)=>{if(""===e)return"";const i=t(s);return i?"maybe"===i||"maybe"===e?"maybe":!0===i||"probably"===i?"probably":void 0:""}),null);if(i){const{mime:t,codecs:h}=i.groups,r=s&&s[t];if(!r||Array.isArray(r))return n(r||[e])||n([`audio/${t}`]);if("object"==typeof r){if(h){const t=h.split(",");return t.length>1?"":r[t[0]]?n(r[t[0]]):""}return"maybe"}}return""}enablePlayButton(t){this.Ve.removeAttribute("src"),this.Ve.srcObject=null,t.includes("mediasource")?this.Ve.src=URL.createObjectURL(new MediaSource):t.includes("webaudio")?(this.Ye=new MediaStream,this.Ve.srcObject=this.Ye):t.includes("html5")&&(this.Ve.src="data:audio/mpeg;base64,//sQxAAABFgC/SCEYACCgB9AAAAAppppVCAHBAEIgBByw9WD5+J8ufwxiDEDsMfE+D4fwG/RUGCx6VO4awVxV3qDtQNPiXKnZUNSwKuUDR6IgaeoGg7Fg6pMQU1FMy4xMDCqqqqqqqr/+xLEB4PAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqo=",this.Ve.loop=!0)}get syncStateUpdate(){return this.Ke}get syncState(){return this.Ze}set syncState(t){this.Ze=t,this.Je&&this.Je(t),this.Ke=new Promise((t=>{this.Je=t}))}get isSupported(){return!1}get isAudioPlayer(){return!1}get metadataTimestamp(){return 0}get currentTime(){return 0}get waiting(){return Promise.resolve()}get icecastMetadataQueue(){return this.Xe}set icecastMetadataQueue(t){this.Xe=t}get codecUpdateQueue(){return this.ts}set codecUpdateQueue(t){this.ts=t}get metadataQueue(){return this.Xe?this.Xe.metadataQueue:[]}es(){this.Xe.startQueue(this.ss),this.ts.startQueue(this.ss)}async ns(){this.syncState=P,this.syncFrames=[],this.syncDelay=null,this.hs=new H(this.ce,this)}async start(t){let e;this.ss=t,[i.RETRY,i.SWITCH].forEach((t=>this.ce.addEventListener(t,this.Qe)));const n=new Promise((t=>{e=t,[s.PLAYING,s.STOPPING].forEach((t=>this.ce.addEventListener(t,e,{once:!0})))})).finally((()=>{[s.PLAYING,s.STOPPING].forEach((t=>this.ce.removeEventListener(t,e)))}));await n}async end(){[i.RETRY,i.SWITCH].forEach((t=>this.ce.removeEventListener(t,this.Qe))),this.Xe.purgeMetadataQueue(),this.ts.purgeMetadataQueue()}onStream(t){return t}onMetadata(t){this.Xe.addMetadata(t,this.metadataTimestamp,this.currentTime)}onCodecUpdate(t,e){const s=this.currentTime;e<s&&(this.je+=this.He),this.He=e,this.ts.addMetadata({metadata:t},(e+this.je)/1e3,s)}}class Q extends j{constructor(t){super(t),this.Ve.crossOrigin="anonymous",this.Ve.loop=!1,this.Ve.preload="none",this.ce.addEventListener(i.STREAM_START,(()=>{this.rs||this.end()})),this.ns()}static canPlayType(t){return Q.isSupported?super.canPlayType((t=>(new Audio).canPlayType(t)),t):""}static get isSupported(){return Boolean(window.Audio)}static get name(){return"html5"}get isAudioPlayer(){return!0}get metadataTimestamp(){return this.os?(this.os.totalDuration+this.cs)/1e3:0}get currentTime(){return this.ds&&(performance.now()-this.ds)/1e3}get waiting(){return new Promise((t=>{this.Ve.addEventListener("waiting",t,{once:!0})}))}async ns(){super.ns(),this.os=null,this.ds=0,this.cs=0,this.rs=!1}async start(t){const e=super.start(t);this.ls=performance.now(),this.Ve.src=null,this.Ve.srcObject=null,this.Ve.src=this.Ge,this.ce.state!==s.STOPPING&&this.ce.state!==s.STOPPED&&(this.Ve.addEventListener("playing",(()=>{this.ds=performance.now(),this.cs=performance.now()-this.ls,this.es(),this.ce[A](i.PLAY)}),{once:!0}),this.ce[A](i.PLAY_READY),this.rs=!0),await e}async end(){super.end(),this.Ve.src=null,this.Ve.srcObject=null,this.ns()}onStream(t){this.os=t[t.length-1]||this.os,this.syncState===R&&(this.syncState=R)}}const Y="webm",K="mp3",Z="mp4a.40.2",J="flac",X="vorbis",tt="opus",et="audio/",st=";codecs=",it=et+"mp4"+st,nt=et+Y+st,ht="mse-audio-wrapper";class rt{constructor({name:t,contents:e=[],children:s=[]}){this.us=t,this.ys=e,this.fs=s}static stringToByteArray(t){return[...t].map((t=>t.charCodeAt(0)))}static getFloat64(t){const e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,t),e}static getUint64(t){const e=new Uint8Array(8);return new DataView(e.buffer).setBigUint64(0,BigInt(t)),e}static getUint32(t){const e=new Uint8Array(4);return new DataView(e.buffer).setUint32(0,t),e}static getUint16(t){const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t),e}static getInt16(t){const e=new Uint8Array(2);return new DataView(e.buffer).setInt16(0,t),e}static*flatten(t){for(const e of t)Array.isArray(e)?yield*rt.flatten(e):yield e}get contents(){const t=new Uint8Array(this.length),e=this.ws();let s=0;for(const i of rt.flatten(e))"object"!=typeof i?(t[s]=i,s++):(t.set(i,s),s+=i.length);return t}get length(){return this.ps()}ws(){return[this.ys,...this.fs.map((t=>t.ws()))]}ps(){let t;return t=Array.isArray(this.ys)?this.ys.reduce(((t,e)=>t+(void 0===e.length?1:e.length)),0):void 0===this.ys.length?1:this.ys.length,t+this.fs.reduce(((t,e)=>t+e.length),0)}addChild(t){this.fs.push(t)}}class at extends rt{constructor(t,{contents:e,children:s}={}){super({name:t,contents:e,children:s})}ws(){return[...this.gs,...rt.stringToByteArray(this.us),...super.ws()]}ps(){return this.bs||(this.bs=4+this.us.length+super.ps(),this.gs=rt.getUint32(this.bs)),this.bs}}class ot extends rt{constructor(t,{contents:e,tags:s}={}){super({name:t,contents:e,children:s})}static getLength(t){const e=rt.getUint32(t);return e.every(((t,e,s)=>0===t&&(s[e]=128,!0))),e}ws(){return[this.us,...this.gs,...super.ws()]}ps(){if(!this.bs){const t=super.ps();this.gs=ot.getLength(t),this.bs=1+t+this.gs.length}return this.bs}addTag(t){this.addChild(t)}}class ct{constructor(t){this.N=t}getCodecBox(t){switch(this.N){case K:return this.getMp4a(t,107);case Z:return this.getMp4a(t,64);case tt:return this.getOpus(t);case J:return this.getFlaC(t)}}getOpus(t){return new at("Opus",{contents:[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channels,0,t.bitDepth,0,0,0,0,at.getUint16(t.sampleRate),0,0],children:[new at("dOps",{contents:[0,t.channels,at.getUint16(t.preSkip),at.getUint32(t.inputSampleRate),at.getInt16(t.outputGain),t.channelMappingFamily,0!==t.channelMappingFamily?[t.streamCount,t.coupledStreamCount,t.channelMappingTable]:[]]})]})}getFlaC(t){return new at("fLaC",{contents:[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channels,0,t.bitDepth,0,0,0,0,at.getUint16(t.sampleRate),0,0],children:[new at("dfLa",{contents:[0,0,0,0,...t.streamInfo||[128,0,0,34,at.getUint16(t.blockSize),at.getUint16(t.blockSize),0,0,0,0,0,0,at.getUint32(t.sampleRate<<12|t.channels<<8|t.bitDepth-1<<4),0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]})]})}getMp4a(t,e){const s=new ot(4,{contents:[e,21,0,0,0,0,0,0,0,0,0,0,0]});return 64===e&&s.addTag(new ot(5,{contents:t.audioSpecificConfig})),new at("mp4a",{contents:[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channels,0,16,0,0,0,0,at.getUint16(t.sampleRate),0,0],children:[new at("esds",{contents:[0,0,0,0],children:[new ot(3,{contents:[0,1,0],tags:[s,new ot(6,{contents:2})]})]})]})}getInitializationSegment({header:t,samples:e}){return new rt({children:[new at("ftyp",{contents:[at.stringToByteArray("iso5"),0,0,2,0,at.stringToByteArray("iso6mp41")]}),new at("moov",{children:[new at("mvhd",{contents:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,232,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2]}),new at("trak",{children:[new at("tkhd",{contents:[0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0]}),new at("mdia",{children:[new at("mdhd",{contents:[0,0,0,0,0,0,0,0,0,0,0,0,at.getUint32(t.sampleRate),0,0,0,0,85,196,0,0]}),new at("hdlr",{contents:[0,0,0,0,at.stringToByteArray("mhlr"),at.stringToByteArray("soun"),0,0,0,0,0,0,0,0,0,0,0,0,0]}),new at("minf",{children:[new at("stbl",{children:[new at("stsd",{contents:[0,0,0,0,0,0,0,1],children:[this.getCodecBox(t)]}),new at("stts",{contents:[0,0,0,0,0,0,0,0]}),new at("stsc",{contents:[0,0,0,0,0,0,0,0]}),new at("stsz",{contents:[0,0,0,0,0,0,0,0,0,0,0,0]}),new at("stco",{contents:[0,0,0,0,0,0,0,0]})]})]})]})]}),new at("mvex",{children:[new at("trex",{contents:[0,0,0,0,0,0,0,1,0,0,0,1,at.getUint32(e),0,0,0,0,0,0,0,0]})]})]})]}).contents}getSamplesPerFrame(t){return this.N===Z?t.map((({data:t,header:e})=>at.getUint32(t.length-e.length))):t.map((({data:t})=>at.getUint32(t.length)))}getFrameData(t){return this.N===Z?t.map((({data:t,header:e})=>t.subarray(e.length))):t.map((({data:t})=>t))}getMediaSegment(t){return new rt({children:[new at("moof",{children:[new at("mfhd",{contents:[0,0,0,0,0,0,0,0]}),new at("traf",{children:[new at("tfhd",{contents:[0,2,0,0,0,0,0,1]}),new at("tfdt",{contents:[0,0,0,0,0,0,0,0]}),new at("trun",{contents:[0,0,2,1,at.getUint32(t.length),at.getUint32(92+4*t.length),...this.getSamplesPerFrame(t)]})]})]}),new at("mdat",{contents:this.getFrameData(t)})]}).contents}}const dt=(...t)=>t.flatMap((t=>{const e=[];for(let s=t.length;s>=0;s-=255)e.push(s>=255?255:s);return e}));class lt extends rt{constructor(t,{contents:e,children:s,isUnknownLength:i=!1}={}){super({name:t,contents:e,children:s}),this.Ss=i}static getUintVariable(t){let e;if(t<127)e=[128|t];else if(t<16383)e=rt.getUint16(t),e[0]|=64;else if(t<2097151)e=rt.getUint32(t).subarray(1),e[0]|=32;else if(t<268435455)e=rt.getUint32(t),e[0]|=16;else if(t<34359738367)e=rt.getUint64(t).subarray(3),e[0]|=8;else if(t<4398046511103)e=rt.getUint64(t).subarray(2),e[0]|=4;else if(t<562949953421311)e=rt.getUint64(t).subarray(1),e[0]|=2;else if(t<72057594037927940)e=rt.getUint64(t),e[0]|=1;else if("number"!=typeof t||isNaN(t))throw((...t)=>{console.error(ht,t.reduce(((t,e)=>t+"\n  "+e),""))})(`EBML Variable integer must be a number, instead received ${t}`),new Error(ht+": Unable to encode WEBM");return e}ws(){return[...this.us,...this.gs,...super.ws()]}ps(){return this.bs||(this.As=super.ps(),this.gs=this.Ss?[1,255,255,255,255,255,255,255]:lt.getUintVariable(this.As),this.bs=this.us.length+this.gs.length+this.As),this.bs}}const ut=[225],mt=[98,100],yt=[159],ft=[31,67,182,117],wt=[86,170],pt=[134],gt=[99,162],bt=[66,130],St=[66,133],At=[66,135],qt=[26,69,223,163],Mt=[66,242],vt=[66,243],Et=[66,247],_t=[66,134],Tt=[156],Pt=[21,73,169,102],It=[77,128],Ct=[181],Rt=[86,187],xt=[24,83,128,103],$t=[163],Bt=[231],Ut=[42,215,177],Dt=[174],Ot=[215],kt=[22,84,174,107],Ft=[131],Lt=[115,197],zt=[87,65];class Nt{constructor(t){switch(t){case tt:this.qs="A_OPUS",this.Ms=t=>[new lt(wt,{contents:lt.getUint32(Math.round(t.preSkip*this.vs))}),new lt(Rt,{contents:lt.getUint32(Math.round(3840*this.vs))}),new lt(gt,{contents:t.data})];break;case X:this.qs="A_VORBIS",this.Ms=t=>[new lt(gt,{contents:[2,dt(t.data,t.vorbisComments),t.data,t.vorbisComments,t.vorbisSetup]})]}}getInitializationSegment({header:t}){return this.vs=1e9/t.sampleRate,new rt({children:[new lt(qt,{children:[new lt(_t,{contents:1}),new lt(Et,{contents:1}),new lt(Mt,{contents:4}),new lt(vt,{contents:8}),new lt(bt,{contents:lt.stringToByteArray(Y)}),new lt(At,{contents:4}),new lt(St,{contents:2})]}),new lt(xt,{isUnknownLength:!0,children:[new lt(Pt,{children:[new lt(Ut,{contents:lt.getUint32(Math.floor(this.vs))}),new lt(It,{contents:lt.stringToByteArray(ht)}),new lt(zt,{contents:lt.stringToByteArray(ht)})]}),new lt(kt,{children:[new lt(Dt,{children:[new lt(Ot,{contents:1}),new lt(Lt,{contents:1}),new lt(Tt,{contents:0}),new lt(pt,{contents:lt.stringToByteArray(this.qs)}),new lt(Ft,{contents:2}),new lt(ut,{children:[new lt(yt,{contents:t.channels}),new lt(Ct,{contents:lt.getFloat64(t.sampleRate)}),new lt(mt,{contents:t.bitDepth})]}),...this.Ms(t)]})]})]})]}).contents}getMediaSegment(t){const e=t[0].totalSamples;return new lt(ft,{children:[new lt(Bt,{contents:lt.getUintVariable(e)}),...t.map((({data:t,totalSamples:s})=>new lt($t,{contents:[129,lt.getInt16(s-e),128,t]})))]}).contents}}const Vt=()=>{};class Gt{constructor(t,e={}){this.J=t,this.PREFERRED_CONTAINER=e.preferredContainer||Y,this.MIN_FRAMES=e.minFramesPerSegment||4,this.MAX_FRAMES=e.maxFramesPerSegment||50,this.MIN_FRAMES_LENGTH=e.minBytesPerSegment||1022,this.MAX_SAMPLES_PER_SEGMENT=1/0,this.Es=e.onMimeType||Vt,e.codec&&(this._s=this.Ts(e.codec),this.Es(this.Ps)),this.Is=[],this.T=new W.Z(t,{onCodec:t=>{this._s=this.Ts(t),this.Es(this.Ps)},onCodecUpdate:e.onCodecUpdate,enableLogging:e.enableLogging,enableFrameCRC32:!1})}get mimeType(){return this.Ps}get inputMimeType(){return this.J}*iterator(t){t.constructor===Uint8Array?yield*this.Cs([...this.T.parseChunk(t)].flatMap((t=>t.codecFrames||t))):Array.isArray(t)&&(yield*this.Cs(t))}*Cs(t){if(this.Is.push(...t),this.Is.length){const t=this.Rs();if(t.length){this.xs||(this.xs=!0,yield this._s.getInitializationSegment(t[0][0]));for(const e of t)yield this._s.getMediaSegment(e)}}}Rs(){const t=[[]];let e=t[0],s=0;for(const i of this.Is)(e.length===this.MAX_FRAMES||s>=this.MAX_SAMPLES_PER_SEGMENT)&&(s=0,t.push(e=[])),e.push(i),s+=i.samples;return this.Is=e.length<this.MIN_FRAMES||e.reduce(((t,e)=>t+e.data.length),0)<this.MIN_FRAMES_LENGTH?t.pop():[],t}Ts(t){switch(t){case"mpeg":return this.Ps=`${it}"${K}"`,new ct(K);case"aac":return this.Ps=`${it}"${Z}`,new ct(Z);case"flac":return this.Ps=`${it}"${J}"`,new ct(J);case"vorbis":return this.Ps=`${nt}"${X}"`,this.MAX_SAMPLES_PER_SEGMENT=32767,new Nt(X);case"opus":return this.PREFERRED_CONTAINER===Y?(this.Ps=`${nt}"${tt}"`,this.MAX_SAMPLES_PER_SEGMENT=32767,new Nt(tt)):(this.Ps=`${it}"${tt}"`,new ct(tt))}}}class Wt extends j{constructor(t,e,s){super(t,e,s),this.ns()}static canPlayType(t){return Wt.isSupported?MediaSource.isTypeSupported(t)?"probably":super.canPlayType(MediaSource.isTypeSupported,t,{mpeg:['audio/mp4;codecs="mp3"'],aac:['audio/mp4;codecs="mp4a.40.2"'],aacp:['audio/mp4;codecs="mp4a.40.2"'],flac:['audio/mp4;codecs="flac"'],ogg:{flac:['audio/mp4;codecs="flac"'],opus:['audio/mp4;codecs="opus"','audio/webm;codecs="opus"'],vorbis:['audio/webm;codecs="vorbis"']}}):""}static get isSupported(){return Boolean(window.MediaSource)}static get name(){return"mediasource"}get isAudioPlayer(){return!0}get metadataTimestamp(){return this.$s&&this.$s.sourceBuffers.length&&Math.max(this.$s.sourceBuffers[0].timestampOffset,this.$s.sourceBuffers[0].buffered.length?this.$s.sourceBuffers[0].buffered.end(0):0)||0}get currentTime(){return this.Ve.currentTime}get waiting(){return new Promise((t=>{this.Ve.addEventListener("waiting",t,{once:!0})}))}async ns(){super.ns(),this.Bs=[],this.rs=!1,this.Us=!1,this.Ds=this.Os(this.J,this.N),await this.Ds}async start(t){const e=super.start(t);await this.ks(),await e}async end(){super.end(),await this.ns()}async onStream(t){if((t=t.flatMap((t=>t.codecFrames?t.codecFrames.map((e=>(e.isLastPage=t.isLastPage,e))):t))).length){switch(this.syncState){case R:this.hs.initSync(),this.syncState=I;case I:[this.syncFrames,this.syncState,this.syncDelay]=await this.hs.sync(t),t=this.syncFrames}switch(this.syncState){case C:break;case P:await(await this.Ds)(t),this.hs.addAll(t)}}}async Os(t,e){return MediaSource.isTypeSupported(t)?(await this.Fs(t),async t=>this.Ls(x(t.map((t=>t.data))))):(this.zs(t,e),await this.Fs(this.Ns.mimeType),async s=>{let i=[];for(const n of s)this.Us!==n.isLastPage&&(n.isLastPage?this.Us=!0:(await this.Ls(x(i)),i=[],this.zs(t,e),this.Us=!1)),i.push(...this.Ns.iterator([n]));await this.Ls(x(i))})}async zs(t,e){this.Ns=new Gt(t,{codec:e}),MediaSource.isTypeSupported(this.Ns.mimeType)||this.ce[A](i.PLAYBACK_ERROR,`Media Source Extensions API in your browser does not support ${t} or ${this.Ns.mimeType}.See: https://caniuse.com/mediasource and https://developer.mozilla.org/en-US/docs/Web/API/Media_Source_Extensions_API`)}async Fs(t){await new Promise((async t=>{this.$s=new MediaSource,this.$s.addEventListener("sourceopen",t,{once:!0})})),this.Vs=0,this.$s.addSourceBuffer(t).mode="sequence"}async Gs(){return new Promise((t=>{const e=this.$s.sourceBuffers[0];e.updating?e.addEventListener("updateend",t,{once:!0}):t()}))}async ks(){this.Ve.loop=!1,this.Ve.src=URL.createObjectURL(this.$s),await this.Ds}async Ls(t){if(this.ce[A](i.STREAM,t),this.$s.sourceBuffers.length||this.ce[A](i.WARN,"Attempting to append audio, but MediaSource has not been or is no longer initialized","Please be sure that `detachAudioElement()` was called and awaited before reusing the element with a new IcecastMetadataPlayer instance"),this.ce.state!==s.STOPPING&&this.$s.sourceBuffers.length){this.Bs.push(t);try{for(;this.Bs.length;)this.$s.sourceBuffers[0].appendBuffer(this.Bs.shift()),await this.Gs()}catch(t){if("QuotaExceededError"!==t.name)throw t}this.rs||(this.We<=this.metadataTimestamp?(this.Ve.addEventListener("playing",(()=>{this.es(),this.ce[A](i.PLAY)}),{once:!0}),this.ce[A](i.PLAY_READY),this.rs=!0):this.ce[A](i.BUFFER,this.metadataTimestamp)),this.Ve.currentTime>5+this.We&&this.Vs+5e3<performance.now()&&(this.Vs=performance.now(),this.$s.sourceBuffers[0].remove(0,this.Ve.currentTime-5+this.We),await this.Gs())}}}class Ht extends j{constructor(t,e,s){super(t,e,s),this.Ws=t[c],this.ns()}static canPlayType(t){return Ht.isSupported?super.canPlayType((t=>'audio/ogg;codecs="opus"'===t||'audio/ogg;codecs="flac"'===t||'audio/ogg;codecs="vorbis"'===t||"audio/mpeg"===t||"audio/flac"===t),t,{flac:["audio/flac"],mpeg:["audio/mpeg"],ogg:{flac:['audio/ogg;codecs="flac"'],opus:['audio/ogg;codecs="opus"'],vorbis:['audio/ogg;codecs="vorbis"']}}):""}static get isSupported(){return Boolean(window.WebAssembly&&(window.AudioContext||window.webkitAudioContext)&&window.MediaStream)}static get name(){return"webaudio"}get isAudioPlayer(){return!0}get metadataTimestamp(){return this.Hs/1e3}get currentTime(){return(performance.now()-this.js)/1e3||0}get waiting(){return this.Qs}Ys(t){let e;this.Ks+=t,e=setTimeout((()=>{this.Ks-=t,this.Zs.delete(e),this.Zs.size||this.Js()}),this.Ks),this.Zs.add(e)}Js(){this.Xs&&this.Xs(),this.Qs=new Promise((t=>{this.Xs=t}))}ti(){this.Zs&&this.Zs.forEach((t=>clearTimeout(t))),this.Zs=new Set,this.Ks=0,this.Js()}async ei(){let t;this.si=new Promise((t=>{this.ii=t}));try{switch(this.N){case"mpeg":const{MPEGDecoderWebWorker:e}=await n.e("mpeg").then(n.bind(n,775));t=e;break;case"opus":const{OpusDecoderWebWorker:s}=await n.e("opus").then(n.bind(n,879));t=s;break;case"flac":const{FLACDecoderWebWorker:i}=await n.e("flac").then(n.bind(n,259));t=i;break;case"vorbis":const{OggVorbisDecoderWebWorker:h}=await n.e("vorbis").then(n.bind(n,115));t=h}}catch(t){return void this.ce[A](i.PLAYBACK_ERROR,`Missing \`webaudio-${this.N}\` dependency.`,`Unable to playback playback \`${this.N}\` audio.`)}t?(this.ii(),this.ni=new t):this.ce[A](i.PLAYBACK_ERROR,"Unsupported `webaudio` playback codec: "+this.N)}async ns(){super.ns(),this.Hs=0,this.hi=0,this.ri=0,this.ct=0,this.js=void 0,this.rs=!1,this.ti(),this.ai=new Promise((t=>{this.oi=t}))}async start(t){this.ni||await this.ei();const e=super.start(t);this.oi(),await e}async end(){super.end(),this.ni&&(this.ni.terminate(),this.ni=null),this.Ye&&this.Ye.stream.getTracks().forEach((t=>this.Ye.stream.removeTrack(t))),this.ns()}async onStream(t){if("vorbis"!==this.N)switch(t=t.flatMap((t=>t.codecFrames||t)),this.syncState){case R:this.hs.initSync(),this.syncState=I;case I:[this.syncFrames,this.syncState,this.syncDelay]=await this.hs.sync(t),t=this.syncFrames}switch(this.syncState){case C:break;case P:t.length&&(this.Hs=t[t.length-1].totalDuration,this.ci(t))}}async ci(t){if(await this.si,this.ni){let e;await this.ni.ready,"vorbis"===this.N?e=this.ni.decodeOggPages(t):(e=this.ni.decodeFrames(t.map((t=>t.data))),this.hs.addAll(t)),e.then((t=>this.di(t)))}}async di({channelData:t,samplesDecoded:e,sampleRate:n}){if(await this.ai,this.ce.state!==s.STOPPING&&this.ce.state!==s.STOPPED&&e){this.ce[A](i.STREAM,{channelData:t,samplesDecoded:e,sampleRate:n}),this.ct||(this.ct=n,this.Ye=this.Ws.createMediaStreamDestination(),this.Ve.srcObject=this.Ye.stream);const s=this.Ws.createBuffer(t.length,e,this.ct);t.forEach(((t,e)=>s.getChannelData(e).set(t)));const h=this.Ws.createBufferSource();h.buffer=s,h.connect(this.Ye),this.ri||(this.ri=Math.floor(this.Ws.currentTime*this.ct));const r=(this.hi+this.ri)/this.ct;h.start(r),this.Ys(e/this.ct*1e3),this.rs||(this.We<=this.metadataTimestamp?(this.ce[A](i.PLAY_READY),this.js=performance.now(),this.es(),this.ce[A](i.PLAY),this.rs=!0):this.ce[A](i.BUFFER,this.metadataTimestamp)),this.hi+=e}}}class jt{constructor(s){const i=e.get(s);this.ce=s,this.Ve=i[d],this.X=i[f],this.li=i[S],this.ui="",this.mi(),this.Ae=new j(this.ce),this.Ae.icecastMetadataQueue=this.Xe,this.Ae.codecUpdateQueue=this.ts,this.Ae.enablePlayButton(jt.supportedPlaybackMethods),this.yi=[],this.T=void 0,this.J="",this.N="",this.fi=Promise.resolve(),this.wi=t}static get supportedPlaybackMethods(){return[Wt,Ht,Q].map((t=>t.isSupported?t.name:""))}static canPlayType(t){return{mediasource:Wt.canPlayType(t),html5:Q.canPlayType(t),webaudio:Ht.canPlayType(t)}}get player(){return this.Ae}get playbackMethod(){return this.ui}get icyMetaInt(){return this.pi&&this.pi.icyMetaInt}async playStream(){return this.fetchStream().then((async t=>(this.ce[A](i.STREAM_START),this.readIcecastResponse(t).finally((()=>{this.ce[A](i.STREAM_END)}))))).catch((t=>{if(this.ce.state!==s.SWITCHING)throw t}))}async switchStream(){this.ce.state!==s.PLAYING&&(this.wi(),await this.fi);const t=e.get(this.ce);t[T]=s.SWITCHING,t[_].abort(),t[_]=new AbortController}async fetchStream(){const t=e.get(this.ce);this.Ge=t[r];const s=await fetch(this.Ge,{method:"GET",headers:t[E]?{"Icy-MetaData":1}:{},signal:t[_].signal});if(!s.ok){const t=new Error(`${s.status} received from ${s.url}`);throw t.name="HTTP Response Error",t}return s}async readIcecastResponse(t){const s=t.headers.get("content-type"),n=e.get(this.ce),h=new Promise((t=>{this.T=new W.Z(s,{onCodecUpdate:this.li&&((...t)=>this.Ae.onCodecUpdate(...t)),onCodec:t,enableLogging:this.X})}));this.pi=new N(t,{onMetadata:async t=>{this.Ae.onMetadata(t)},onStream:async({stream:t})=>{this.ce[A](i.STREAM,t);const e=[...this.T.parseChunk(t)];if(this.Ae.isAudioPlayer){const t=[...this.yi,...e];this.yi=[],await this.Ae.onStream(t)}else this.yi.push(...e)},onError:(...t)=>this.ce[A](i.WARN,...t),metadataTypes:n[a],icyCharacterEncoding:n[m],icyDetectionTimeout:n[y],...n[u]?{icyMetaInt:n[u]}:{}});const r=this.pi.startReading(),o=await h;this.Ae.isAudioPlayer||([this.Ae,this.ui]=this.gi(s,o)),this.Ae.syncState===P?this.Ae.start():await this.bi(s,o),await r}async bi(t,e){let i,n,h=!1,r=!1;const a=this.Ae,o=this.Ae.icecastMetadataQueue,c=this.Ae.codecUpdateQueue;this.mi(),a.icecastMetadataQueue=this.Xe,a.codecUpdateQueue=this.ts;const d=()=>{r=!0,this.ce.state===s.STOPPING&&this.ce.state===s.STOPPED||(a.icecastMetadataQueue.purgeMetadataQueue(),a.codecUpdateQueue.purgeMetadataQueue(),this.Ae.start(Math.max(0,a.syncDelay/1e3)).then((()=>a.end())).then(n))};this.wi=()=>{h=!0,this.Xe.purgeMetadataQueue(),this.ts.purgeMetadataQueue(),this.Ae.icecastMetadataQueue=o,this.Ae.codecUpdateQueue=c,void 0===i||r||(clearTimeout(i),d())};const l=()=>this.Ae.syncStateUpdate.then((r=>{if(h)n();else switch(r){case I:return l();case P:this.Xe.purgeMetadataQueue(),this.ts.purgeMetadataQueue(),this.Ae.icecastMetadataQueue=o,this.Ae.codecUpdateQueue=c,this.ce.state===s.STOPPING&&this.ce.state===s.STOPPED||(this.ce[T]=s.PLAYING),n();break;case C:case R:a.icecastMetadataQueue=o,a.codecUpdateQueue=c,[this.Ae,this.ui]=this.gi(t,e),this.yi.push(...a.syncFrames),i=setTimeout(d,Math.max(a.syncDelay,0))}}));let u;this.fi=new Promise((t=>{n=t,u=()=>{this.wi(),n()},this.ce.addEventListener(s.STOPPING,u,{once:!0}),l()})).finally((()=>{this.ce.removeEventListener(s.STOPPING,u)}))}mi(){this.Xe=new G({onMetadataUpdate:(...t)=>this.ce[A](i.METADATA,...t),onMetadataEnqueue:(...t)=>this.ce[A](i.METADATA_ENQUEUE,...t),paused:!0}),this.ts=new G({onMetadataUpdate:(...t)=>this.ce[A](i.CODEC_UPDATE,...t),paused:!0})}gi(t,s){const{[e.get(this.ce)[o]]:i,...n}={mediasource:Wt,webaudio:Ht,html5:Q};let h,r;for(const e of Object.values({firstMethod:i,...n})){const i=e.canPlayType(`${t};codecs="${s}"`);if("probably"===i||"maybe"===i){r=e.name,h=new e(this.ce,t,s),h.icecastMetadataQueue=this.Xe,h.codecUpdateQueue=this.ts;break}}if(!h)throw new Error(`Your browser does not support this audio codec ${t}${s&&`;codecs="${s}"`}`);return[h,r]}}let Qt;try{new window.EventTarget,Qt=window.EventTarget}catch{Qt=$}const Yt=Symbol(),Kt=Symbol(),Zt=Symbol(),Jt=Symbol(),Xt=Symbol(),te=Symbol(),ee=Symbol(),se=Symbol(),ie=Symbol(),ne=Symbol(),he=Symbol(),re=Symbol();class ae extends Qt{static getDefaults(t,e={}){return{[l]:t.bufferLength??e[l]??1,[u]:t.icyMetaInt??e[u],[m]:t.icyCharacterEncoding??e[m],[y]:t.icyDetectionTimeout??e[y],[a]:(t.metadataTypes??e[a])||["icy"],[E]:((t.metadataTypes??e[a])||["icy"]).includes("icy"),[f]:t.enableLogging??e[f]??!1,[S]:Boolean(t.enableCodecUpdate??e[S]??t.onCodecUpdate),[w]:t.retryDelayRate??e[w]??.1,[p]:t.retryDelayMin??e[p]??.5,[g]:t.retryDelayMax??e[g]??2,[b]:t.retryTimeout??e[b]??30,[o]:(t.playbackMethod??e[o])||"mediasource"}}constructor(n,h={}){super(),e.set(this,{[r]:n,[d]:h.audioElement||new Audio,...ae.getDefaults(h),[Zt]:{[i.PLAY]:h.onPlay||t,[i.PLAY_READY]:t,[i.LOAD]:h.onLoad||t,[i.STREAM_START]:h.onStreamStart||t,[i.BUFFER]:h.onBuffer||t,[i.STREAM]:h.onStream||t,[i.STREAM_END]:h.onStreamEnd||t,[i.METADATA]:h.onMetadata||t,[i.METADATA_ENQUEUE]:h.onMetadataEnqueue||t,[i.CODEC_UPDATE]:h.onCodecUpdate||t,[i.STOP]:h.onStop||t,[i.RETRY]:h.onRetry||t,[i.RETRY_TIMEOUT]:h.onRetryTimeout||t,[i.SWITCH]:h.onSwitch||t,[i.WARN]:(...t)=>{this[v](console.warn,h.onWarn,t)},[i.ERROR]:(...t)=>{this[v](console.error,h.onError,t)},[i.PLAYBACK_ERROR]:(...t)=>{this.state!==s.RETRYING?(this[A](i.ERROR,...t),this.stop()):e.get(this)[ne]()}},[ne]:()=>{clearTimeout(e.get(this)[re]),this.removeEventListener(i.STREAM_START,e.get(this)[ne]),e.get(this)[d].removeEventListener("waiting",e.get(this)[se]);try{e.get(this)[d].pause()}catch(t){e.get(this)[ee](t)}try{e.get(this)[Kt]=e.get(this)[Yt].player.end()}catch{}},[Xt]:()=>{this.play()},[Jt]:()=>{this.stop()},[ee]:t=>{const e=t?.target?.error||t;this[A](i.PLAYBACK_ERROR,"The audio element encountered an error."+({1:" MEDIA_ERR_ABORTED The fetching of the associated resource was aborted by the user's request.",2:" MEDIA_ERR_NETWORK Some kind of network error occurred which prevented the media from being successfully fetched, despite having previously been available.",3:" MEDIA_ERR_DECODE Despite having previously been determined to be usable, an error occurred while trying to decode the media resource, resulting in an error.",4:" MEDIA_ERR_SRC_NOT_SUPPORTED The associated resource or media provider object (such as a MediaStream) has been found to be unsuitable.",5:" MEDIA_ERR_ENCRYPTED"}[e?.code]||""))},[te]:()=>{const t=e.get(this)[d];(this.state===s.LOADING||!t.loop&&this.state!==s.STOPPING&&this.state!==s.STOPPED)&&t.play().then((()=>{this[T]=s.PLAYING})).catch((t=>{this[A](i.PLAYBACK_ERROR,t,"Playback failed.")}))},[ie]:t}),this[q](),this[T]=s.STOPPED,e.get(this)[Yt]=new jt(this)}static canPlayType(t){return jt.canPlayType(t)}get audioElement(){return e.get(this)[d]}get[c](){return ae.constructor[c]}get icyMetaInt(){return e.get(this)[Yt].icyMetaInt}get metadataQueue(){return e.get(this)[Yt].player.metadataQueue}get state(){return e.get(this)[T]}get playbackMethod(){return e.get(this)[Yt].playbackMethod}set[T](t){this.dispatchEvent(new CustomEvent(t)),e.get(this)[T]=t}[q](){const t=e.get(this)[d];t.addEventListener("pause",e.get(this)[Jt]),t.addEventListener("play",e.get(this)[Xt]),t.addEventListener("error",e.get(this)[ee]),this.addEventListener(i.PLAY_READY,e.get(this)[te])}async detachAudioElement(){const t=e.get(this)[d];t.removeEventListener("pause",e.get(this)[Jt]),t.removeEventListener("play",e.get(this)[Xt]),t.removeEventListener("error",e.get(this)[ee]),this.removeEventListener(i.PLAY_READY,e.get(this)[te]),await this.stop()}async play(){if(this.state===s.STOPPED){e.get(this)[_]=new AbortController,this[T]=s.LOADING,this[A](i.LOAD);const t=async()=>e.get(this)[Yt].playStream().then((()=>this.state===s.SWITCHING?(this[A](i.SWITCH),t()):this.state!==s.STOPPING&&this.state!==s.STOPPED?e.get(this)[Yt].player.waiting:void 0)).catch((async n=>{if(n&&"AbortError"!==n.name){if(await this[M](n))return this[A](i.RETRY),t();e.get(this)[_].abort(),this.state!==s.STOPPING&&this.state!==s.STOPPED&&this[A](i.ERROR,n.message.match(/network|fetch|offline|codec/i)?n:n.stack,n)}}));new Promise(((s,i)=>{e.get(this)[ie]=i,t().then(s)})).catch((t=>{if(this.state!==s.STOPPING)throw t})).finally((()=>{e.get(this)[ne](),this[A](i.STOP),this[T]=s.STOPPED})),await new Promise((t=>{this.addEventListener(i.PLAY,t,{once:!0})}))}}async stop(){this.state!==s.STOPPED&&this.state!==s.STOPPING&&(this[T]=s.STOPPING,e.get(this)[_].abort(),e.get(this)[ie](),await new Promise((t=>{this.addEventListener(i.STOP,t,{once:!0})})))}async switchEndpoint(t,i){if(this.state!==s.STOPPED&&this.state!==s.STOPPING){const s=e.get(this);return Object.assign(s,{[r]:t,...ae.getDefaults(i,s)}),s[Yt].switchStream()}}async[M](t){if(0===e.get(this)[b])return!1;if(e.get(this)[T]===s.RETRYING)return await new Promise((t=>{this.addEventListener(s.STOPPING,t,{once:!0});const i=Math.min(1e3*e.get(this)[p]*(e.get(this)[w]+1)**e.get(this)[he]++,1e3*e.get(this)[g]);setTimeout((()=>{this.removeEventListener(s.STOPPING,t),t()}),i+.3*i*Math.random())})),e.get(this)[T]===s.RETRYING;if(e.get(this)[T]!==s.STOPPING&&e.get(this)[T]!==s.STOPPED&&(t.message.match(/network|fetch|offline|Error in body stream/i)||"HTTP Response Error"===t.name)){this[A](i.ERROR,t.name,t),this[T]=s.RETRYING,e.get(this)[E]&&this[A](i.WARN,"This stream was requested with ICY metadata.",'If there is a CORS preflight failure, try removing "icy" from the metadataTypes option.',"See https://github.com/eshaz/icecast-metadata-js#cors for more details.");const n=new Promise((t=>{e.get(this)[se]=t,e.get(this)[d].addEventListener("waiting",e.get(this)[se],{once:!0})}));return e.get(this)[re]=setTimeout((()=>{n.then((()=>{e.get(this)[T]===s.RETRYING&&(this[A](i.RETRY_TIMEOUT),this.stop())}))}),1e3*e.get(this)[b]),e.get(this)[he]=0,!0}return!1}[A](t,...s){this.dispatchEvent(new CustomEvent(t,{detail:s})),e.get(this)[Zt][t](...s)}[v](t,s,i){e.get(this)[f]&&t("icecast-metadata-js",i.reduce(((t,e)=>t+"\n  "+e),"")),s&&s(...i)}}const oe=window.AudioContext||window.webkitAudioContext;if(oe&&!ae.constructor[c]){ae.constructor[c]="audio context pending";const t=t=>{console.error("icecast-metadata-js","Failed to start the AudioContext. WebAudio playback will not be possible.",t)},e=["touchstart","touchend","mousedown","keydown"],s=()=>{e.forEach((t=>document.removeEventListener(t,s)));const i=new oe({latencyHint:"interactive"});i.resume().then((()=>{i.createScriptProcessor(16384,2,2).connect(i.destination),i.onstatechange=()=>{"running"!==i.state&&i.resume().catch(t)}})).catch(t),ae.constructor[c]=i};e.forEach((t=>document.addEventListener(t,s)))}})(),IcecastMetadataPlayer=h.default})();
//# sourceMappingURL=icecast-metadata-player-1.15.0.main.min.js.map
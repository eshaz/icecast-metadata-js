/*! For license information please see icecast-metadata-player-1.15.4.main.min.js.LICENSE.txt */

/*! 
 * Copyright 2021-2023 Ethan Halsall
 * https://github.com/eshaz/icecast-metadata-js
 *
 * This file is part of icecast-metadata-player.
 *
 * icecast-metadata-player free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * icecast-metadata-player distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>
 */
var IcecastMetadataPlayer;(()=>{"use strict";var t,s,i,e={273:(t,s,i)=>{i.d(s,{Z:()=>se});const e=Symbol,h=(()=>{const t="left",s="center",i="right";return["","front ","side ","rear "].map((e=>[[t,i],[t,i,s],[t,s,i],[s,t,i],[s]].flatMap((t=>t.map((t=>e+t)).join(", ")))))})(),r="LFE",n="monophonic (mono)",a="stereo",o="surround",c=(t,...s)=>`${[n,a,`linear ${o}`,"quadraphonic",`5.0 ${o}`,`5.1 ${o}`,`6.1 ${o}`,`7.1 ${o}`][t-1]} (${s.join(", ")})`,u=[n,c(2,h[0][0]),c(3,h[0][2]),c(4,h[1][0],h[3][0]),c(5,h[1][2],h[3][0]),c(6,h[1][2],h[3][0],r),c(7,h[1][2],h[2][0],h[3][4],r),c(8,h[1][2],h[2][0],h[3][0],r)],l=48e3,d=44100,y=32e3,f=24e3,m=22050,p=16e3,w=8e3,g="absoluteGranulePosition",b="bandwidth",S="bitDepth",q="bitrate",M=q+"Maximum",A=q+"Minimum",v=q+"Nominal",P="buffer",E=P+"Fullness",T="codec",_=T+"Frames",C="coupledStreamCount",I="crc",R=I+"16",x=I+"32",$="data",O="description",k="duration",D="emphasis",B="hasOpusPadding",F="header",L="isContinuedPacket",U="isCopyrighted",N="isFirstPage",G="isHome",j="isLastPage",W="isOriginal",H="isPrivate",Q="isVbr",V="layer",z="length",Y="mode",K=Y+"Extension",Z="mpeg",J=Z+"Version",X="numberAACFrames",tt="outputGain",st="preSkip",it="profile",et=it+"Bits",ht="protection",rt="segments",nt="subarray",at="version",ot="vorbis",ct=ot+"Comments",ut=ot+"Setup",lt="block",dt=lt+"ingStrategy",yt=lt+"ingStrategyBits",ft=lt+"Size",mt=lt+"size0",pt=lt+"size1",wt=lt+"SizeBits",gt="channel",bt=gt+"MappingFamily",St=gt+"MappingTable",qt=gt+"Mode",Mt=gt+"ModeBits",At=gt+"s",vt="copyright",Pt=vt+"Id",Et=vt+"IdStart",Tt="frame",_t=Tt+"Count",Ct=Tt+"Length",It="Number",Rt=Tt+It,xt=Tt+"Padding",$t=Tt+"Size",Ot="Rate",kt="inputSample"+Ot,Dt="page",Bt=Dt+"Checksum",Ft=Dt+"SegmentBytes",Lt=Dt+"SegmentTable",Ut=Dt+"Sequence"+It,Nt="sample",Gt=Nt+It,jt=Nt+Ot,Wt=Nt+Ot+"Bits",Ht=Nt+"s",Qt="stream",Vt=Qt+"Count",zt=Qt+"Info",Yt=Qt+"Serial"+It,Kt=Qt+"StructureVersion",Zt="total",Jt=Zt+"BytesOut",Xt=Zt+"Duration",ts=Zt+"Samples",ss=e(),is=e(),es=e(),hs=e(),rs=e(),ns=e(),as=e(),os=e(),cs=e(),us=e(),ls=e(),ds=e(),ys=e(),fs=e(),ms=e(),ps=e(),ws=e(),gs=e(),bs=Uint8Array,Ss=DataView,qs="reserved",Ms="bad",As="free",vs="none",Ps="16bit CRC",Es=(t,s,i)=>{for(let e=0;e<t[z];e++){let h=s(e);for(let t=8;t>0;t--)h=i(h);t[e]=h}return t},Ts=Es(new bs(256),(t=>t),(t=>128&t?7^t<<1:t<<1)),_s=[Es(new Uint16Array(256),(t=>t<<8),(t=>t<<1^(32768&t?32773:0)))],Cs=[Es(new Uint32Array(256),(t=>t),(t=>t>>>1^3988292384*(1&t)))];for(let t=0;t<15;t++){_s.push(new Uint16Array(256)),Cs.push(new Uint32Array(256));for(let s=0;s<=255;s++)_s[t+1][s]=_s[0][_s[t][s]>>>8]^_s[t][s]<<8,Cs[t+1][s]=Cs[t][s]>>>8^Cs[0][255&Cs[t][s]]}const Is=t=>{const s=t[z],i=s-16;let e=0,h=0;for(;h<=i;)e=Cs[15][255&(t[h++]^e)]^Cs[14][255&(t[h++]^e>>>8)]^Cs[13][255&(t[h++]^e>>>16)]^Cs[12][t[h++]^e>>>24]^Cs[11][t[h++]]^Cs[10][t[h++]]^Cs[9][t[h++]]^Cs[8][t[h++]]^Cs[7][t[h++]]^Cs[6][t[h++]]^Cs[5][t[h++]]^Cs[4][t[h++]]^Cs[3][t[h++]]^Cs[2][t[h++]]^Cs[1][t[h++]]^Cs[0][t[h++]];for(;h!==s;)e=Cs[0][255&(e^t[h++])]^e>>>8;return-1^e},Rs=(...t)=>{const s=new bs(t.reduce(((t,s)=>t+s[z]),0));return t.reduce(((t,i)=>(s.set(i,t),t+i[z])),0),s},xs=t=>String.fromCharCode(...t),$s=[0,8,4,12,2,10,6,14,1,9,5,13,3,11,7,15],Os=t=>$s[15&t]<<4|$s[t>>4];class ks{constructor(t){this.t=t,this.i=8*t[z]}set position(t){this.i=t}get position(){return this.i}read(t){const s=Math.floor(this.i/8),i=this.i%8;this.i-=t;return(Os(this.t[s-1])<<8)+Os(this.t[s])>>7-i&255}}class Ds{constructor(t,s){this.h=t,this.S=s,this[ms]()}[ps](){this.q=!0}[ms](){this.M=new Map,this.A=new WeakMap,this.v=!1,this.P=!1,this.T=null,this.q=!1}[fs](t,s){if(this.S){this.T!==t&&(this.T=t,this.P=!0);const i=this.A.get(this.M.get(this._));this.P&&i&&this.S({bitrate:t,...i},s),this.P=!1}}[cs](t){const s=this.M.get(t);return s&&this.C(t),s}[us](t,s,i){this.q&&(this.v||(this.h({...s}),this.v=!0),this.C(t),this.M.set(t,s),this.A.set(s,i))}C(t){this.S&&t!==this._&&(this.P=!0,this._=t)}}const Bs=new WeakMap,Fs=new WeakMap;class Ls{constructor(t,s){this.I=t,this.M=s}*[as](){let t;for(;;){if(t=yield*this.Frame[ls](this.I,this.M,0),t)return t;this.I[is](1)}}*[os](t){let s=yield*this[as]();const i=Fs.get(s)[z];if(t||this.I.R||(yield*this.Header[cs](this.I,this.M,i)))return this.M[ps](),this.I[is](i),this.I[hs](s),s;this.I[rs](`Missing ${Tt} at ${i} bytes from current position.`,`Dropping current ${Tt} and trying again.`),this.M[ms](),this.I[is](1)}}class Us{constructor(t,s){Fs.set(this,{[F]:t}),this[$]=s}}class Ns extends Us{static*[ls](t,s,i,e,h){const r=yield*t[cs](i,e,h);if(r){const t=Bs.get(r)[Ct],e=Bs.get(r)[Ht];return new s(r,(yield*i[ss](t,h))[nt](0,t),e)}return null}constructor(t,s,i){super(t,s),this[F]=t,this[Ht]=i,this[k]=i/t[jt]*1e3,this[Rt]=null,this[Jt]=null,this[ts]=null,this[Xt]=null,Fs.get(this)[z]=s[z]}}const Gs="unsynchronizationFlag",js="extendedHeaderFlag",Ws="experimentalFlag",Hs="footerPresent";class Qs{static*getID3v2Header(t,s,i){const e={};let h=yield*t[ss](3,i);if(73!==h[0]||68!==h[1]||51!==h[2])return null;if(h=yield*t[ss](10,i),e[at]=`id3v2.${h[3]}.${h[4]}`,15&h[5])return null;if(e[Gs]=!!(128&h[5]),e[js]=!!(64&h[5]),e[Ws]=!!(32&h[5]),e[Hs]=!!(16&h[5]),128&h[6]||128&h[7]||128&h[8]||128&h[9])return null;const r=h[6]<<21|h[7]<<14|h[8]<<7|h[9];return e[z]=10+r,new Qs(e)}constructor(t){this[at]=t[at],this[Gs]=t[Gs],this[js]=t[js],this[Ws]=t[Ws],this[Hs]=t[Hs],this[z]=t[z]}}class Vs{constructor(t){Bs.set(this,t),this[S]=t[S],this[q]=null,this[At]=t[At],this[qt]=t[qt],this[jt]=t[jt]}}const zs={0:[As,As,As,As,As],16:[32,32,32,32,8],240:[Ms,Ms,Ms,Ms,Ms]},Ys=(t,s,i)=>8*((t+i)%s+s)*(1<<(t+i)/s)-8*s*(s/8|0);for(let t=2;t<15;t++)zs[t<<4]=[32*t,Ys(t,4,0),Ys(t,4,-1),Ys(t,8,4),Ys(t,8,0)];const Ks="bands ",Zs=" to 31",Js={0:Ks+4+Zs,16:Ks+8+Zs,32:Ks+12+Zs,48:Ks+16+Zs},Xs="bitrateIndex",ti="v2",si="v1",ii="Intensity stereo ",ei=", MS stereo ",hi="on",ri="off",ni={0:{[O]:qs},2:{[O]:"Layer III",[xt]:1,[K]:{0:ii+ri+ei+ri,16:ii+hi+ei+ri,32:ii+ri+ei+hi,48:ii+hi+ei+hi},[si]:{[Xs]:2,[Ht]:1152},[ti]:{[Xs]:4,[Ht]:576}},4:{[O]:"Layer II",[xt]:1,[K]:Js,[Ht]:1152,[si]:{[Xs]:1},[ti]:{[Xs]:4}},6:{[O]:"Layer I",[xt]:4,[K]:Js,[Ht]:384,[si]:{[Xs]:0},[ti]:{[Xs]:3}}},ai="MPEG Version ",oi="ISO/IEC ",ci={0:{[O]:`${ai}2.5 (later extension of MPEG 2)`,[V]:ti,[jt]:{0:11025,4:12e3,8:w,12:qs}},8:{[O]:qs},16:{[O]:`${ai}2 (${oi}13818-3)`,[V]:ti,[jt]:{0:m,4:f,8:p,12:qs}},24:{[O]:`${ai}1 (${oi}11172-3)`,[V]:si,[jt]:{0:d,4:l,8:y,12:qs}},length:z},ui={0:Ps,1:vs},li={0:vs,1:"50/15 ms",2:qs,3:"CCIT J.17"},di={0:{[At]:2,[O]:a},64:{[At]:2,[O]:"joint "+a},128:{[At]:2,[O]:"dual channel"},192:{[At]:1,[O]:n}};class yi extends Vs{static*[cs](t,s,i){const e={},h=yield*Qs.getID3v2Header(t,s,i);h&&(yield*t[ss](h[z],i),t[is](h[z]));const r=yield*t[ss](4,i),n=xs(r[nt](0,4)),a=s[cs](n);if(a)return new yi(a);if(255!==r[0]||r[1]<224)return null;const o=ci[24&r[1]];if(o[O]===qs)return null;const c=6&r[1];if(ni[c][O]===qs)return null;const u={...ni[c],...ni[c][o[V]]};if(e[J]=o[O],e[V]=u[O],e[Ht]=u[Ht],e[ht]=ui[1&r[1]],e[z]=4,e[q]=zs[240&r[2]][u[Xs]],e[q]===Ms)return null;if(e[jt]=o[jt][12&r[2]],e[jt]===qs)return null;if(e[xt]=2&r[2]&&u[xt],e[H]=!!(1&r[2]),e[Ct]=Math.floor(125*e[q]*e[Ht]/e[jt]+e[xt]),!e[Ct])return null;const l=192&r[3];if(e[qt]=di[l][O],e[At]=di[l][At],e[K]=u[K][48&r[3]],e[U]=!!(8&r[3]),e[W]=!!(4&r[3]),e[D]=li[3&r[3]],e[D]===qs)return null;e[S]=16;{const{length:t,frameLength:i,samples:h,...r}=e;s[us](n,e,r)}return new yi(e)}constructor(t){super(t),this[q]=t[q],this[D]=t[D],this[xt]=t[xt],this[U]=t[U],this[W]=t[W],this[H]=t[H],this[V]=t[V],this[K]=t[K],this[J]=t[J],this[ht]=t[ht]}}class fi extends Ns{static*[ls](t,s,i){return yield*super[ls](yi,fi,t,s,i)}constructor(t,s,i){super(t,s,i)}}class mi extends Ls{constructor(t,s,i){super(t,s),this.Frame=fi,this.Header=yi,i(this[T])}get codec(){return Z}*[ds](){return yield*this[os]()}}const pi={0:"MPEG-4",8:"MPEG-2"},wi={0:"valid",2:Ms,4:Ms,6:Ms},gi={0:Ps,1:vs},bi={0:"AAC Main",64:"AAC LC (Low Complexity)",128:"AAC SSR (Scalable Sample Rate)",192:"AAC LTP (Long Term Prediction)"},Si={0:96e3,4:88200,8:64e3,12:l,16:d,20:y,24:f,28:m,32:p,36:12e3,40:11025,44:w,48:7350,52:qs,56:qs,60:"frequency is written explicitly"},qi={0:{[At]:0,[O]:"Defined in AOT Specific Config"},64:{[At]:1,[O]:n},128:{[At]:2,[O]:c(2,h[0][0])},192:{[At]:3,[O]:c(3,h[1][3])},256:{[At]:4,[O]:c(4,h[1][3],h[3][4])},320:{[At]:5,[O]:c(5,h[1][3],h[3][0])},384:{[At]:6,[O]:c(6,h[1][3],h[3][0],r)},448:{[At]:8,[O]:c(8,h[1][3],h[2][0],h[3][0],r)}};class Mi extends Vs{static*[cs](t,s,i){const e={},h=yield*t[ss](7,i),r=xs([h[0],h[1],h[2],252&h[3]|3&h[6]]),n=s[cs](r);if(n)Object.assign(e,n);else{if(255!==h[0]||h[1]<240)return null;if(e[J]=pi[8&h[1]],e[V]=wi[6&h[1]],e[V]===Ms)return null;const t=1&h[1];e[ht]=gi[t],e[z]=t?7:9,e[et]=192&h[2],e[Wt]=60&h[2];const i=2&h[2];if(e[it]=bi[e[et]],e[jt]=Si[e[Wt]],e[jt]===qs)return null;e[H]=!!i,e[Mt]=448&(h[2]<<8|h[3]),e[qt]=qi[e[Mt]][O],e[At]=qi[e[Mt]][At],e[W]=!!(32&h[3]),e[G]=!!(8&h[3]),e[Pt]=!!(8&h[3]),e[Et]=!!(4&h[3]),e[S]=16,e[Ht]=1024,e[X]=3&h[6];{const{length:t,channelModeBits:i,profileBits:h,sampleRateBits:n,frameLength:a,samples:o,numberAACFrames:c,...u}=e;s[us](r,e,u)}}if(e[Ct]=8191&(h[3]<<11|h[4]<<3|h[5]>>5),!e[Ct])return null;const a=2047&(h[5]<<6|h[6]>>2);return e[E]=2047===a?"VBR":a,new Mi(e)}constructor(t){super(t),this[Pt]=t[Pt],this[Et]=t[Et],this[E]=t[E],this[G]=t[G],this[W]=t[W],this[H]=t[H],this[V]=t[V],this[z]=t[z],this[J]=t[J],this[X]=t[X],this[it]=t[it],this[ht]=t[ht]}get audioSpecificConfig(){const t=Bs.get(this),s=t[et]+64<<5|t[Wt]<<5|t[Mt]>>3,i=new bs(2);return new Ss(i[P]).setUint16(0,s,!1),i}}class Ai extends Ns{static*[ls](t,s,i){return yield*super[ls](Mi,Ai,t,s,i)}constructor(t,s,i){super(t,s,i)}}class vi extends Ls{constructor(t,s,i){super(t,s),this.Frame=Ai,this.Header=Mi,i(this[T])}get codec(){return"aac"}*[ds](){return yield*this[os]()}}class Pi extends Ns{static $(t){return(t[t[z]-2]<<8)+t[t[z]-1]}static[gs](t){const s=Pi.$(t),i=(t=>{const s=t[z],i=s-16;let e=0,h=0;for(;h<=i;)e^=t[h++]<<8|t[h++],e=_s[15][e>>8]^_s[14][255&e]^_s[13][t[h++]]^_s[12][t[h++]]^_s[11][t[h++]]^_s[10][t[h++]]^_s[9][t[h++]]^_s[8][t[h++]]^_s[7][t[h++]]^_s[6][t[h++]]^_s[5][t[h++]]^_s[4][t[h++]]^_s[3][t[h++]]^_s[2][t[h++]]^_s[1][t[h++]]^_s[0][t[h++]];for(;h!==s;)e=(255&e)<<8^_s[0][e>>8^t[h++]];return e})(t[nt](0,-2));return s===i}constructor(t,s,i){s[zt]=i,s[R]=Pi.$(t),super(s,t,Bs.get(s)[Ht])}}const Ei="get from STREAMINFO metadata block",Ti={0:"Fixed",1:"Variable"},_i={0:qs,16:192};for(let t=2;t<16;t++)_i[t<<4]=t<6?576*2**(t-2):2**t;const Ci={0:Ei,1:88200,2:176400,3:192e3,4:w,5:p,6:m,7:f,8:y,9:d,10:l,11:96e3,15:Ms},Ii={0:{[At]:1,[O]:n},16:{[At]:2,[O]:c(2,h[0][0])},32:{[At]:3,[O]:c(3,h[0][1])},48:{[At]:4,[O]:c(4,h[1][0],h[3][0])},64:{[At]:5,[O]:c(5,h[1][1],h[3][0])},80:{[At]:6,[O]:c(6,h[1][1],r,h[3][0])},96:{[At]:7,[O]:c(7,h[1][1],r,h[3][4],h[2][0])},112:{[At]:8,[O]:c(8,h[1][1],r,h[3][0],h[2][0])},128:{[At]:2,[O]:`${a} (left, diff)`},144:{[At]:2,[O]:`${a} (diff, right)`},160:{[At]:2,[O]:`${a} (avg, diff)`},176:qs,192:qs,208:qs,224:qs,240:qs},Ri={0:Ei,2:8,4:12,6:qs,8:16,10:20,12:24,14:qs};class xi extends Vs{static k(t){if(t[0]>254)return null;if(t[0]<128)return{value:t[0],length:1};let s=1;for(let i=64;i&t[0];i>>=1)s++;let i=s-1,e=0,h=0;for(;i>0;h+=6,i--){if(128!=(192&t[i]))return null;e|=(63&t[i])<<h}return e|=(t[i]&127>>s)<<h,{value:e,length:s}}static[ws](t,s){const i={[ss]:function*(){return t}};return xi[cs](i,s,0).next().value}static*[cs](t,s,i){let e=yield*t[ss](6,i);if(255!==e[0]||248!==e[1]&&249!==e[1])return null;const h={},r=xs(e[nt](0,4)),n=s[cs](r);if(n)Object.assign(h,n);else{if(h[yt]=1&e[1],h[dt]=Ti[h[yt]],h[wt]=240&e[2],h[Wt]=15&e[2],h[ft]=_i[h[wt]],h[ft]===qs)return null;if(h[jt]=Ci[h[Wt]],h[jt]===Ms)return null;if(1&e[3])return null;const t=Ii[240&e[3]];if(t===qs)return null;if(h[At]=t[At],h[qt]=t[O],h[S]=Ri[14&e[3]],h[S]===qs)return null}h[z]=5,e=yield*t[ss](h[z]+8,i);const a=xi.k(e[nt](4));if(!a)return null;if(h[yt]?h[Gt]=a.value:h[Rt]=a.value,h[z]+=a[z],96===h[wt]?(e[z]<h[z]&&(e=yield*t[ss](h[z],i)),h[ft]=e[h[z]-1]+1,h[z]+=1):112===h[wt]&&(e[z]<h[z]&&(e=yield*t[ss](h[z],i)),h[ft]=(e[h[z]-1]<<8)+e[h[z]]+1,h[z]+=2),h[Ht]=h[ft],12===h[Wt]?(e[z]<h[z]&&(e=yield*t[ss](h[z],i)),h[jt]=1e3*e[h[z]-1],h[z]+=1):13===h[Wt]?(e[z]<h[z]&&(e=yield*t[ss](h[z],i)),h[jt]=(e[h[z]-1]<<8)+e[h[z]],h[z]+=2):14===h[Wt]&&(e[z]<h[z]&&(e=yield*t[ss](h[z],i)),h[jt]=10*((e[h[z]-1]<<8)+e[h[z]]),h[z]+=2),e[z]<h[z]&&(e=yield*t[ss](h[z],i)),h[I]=e[h[z]-1],h[I]!==(t=>{let s=0;const i=t[z];for(let e=0;e!==i;e++)s=Ts[s^t[e]];return s})(e[nt](0,h[z]-1)))return null;if(!n){const{blockingStrategyBits:t,frameNumber:i,sampleNumber:e,samples:n,sampleRateBits:a,blockSizeBits:o,crc:c,length:u,...l}=h;s[us](r,h,l)}return new xi(h)}constructor(t){super(t),this[R]=null,this[dt]=t[dt],this[ft]=t[ft],this[Rt]=t[Rt],this[Gt]=t[Gt],this[zt]=null}}class $i extends Ls{constructor(t,s,i){super(t,s),this.Frame=Pi,this.Header=xi,i(this[T])}get codec(){return"flac"}*D(t){const s=yield*this.I[ss](2,0),i=s[z]-2;for(;t<i;){if(255===s[t]){const i=s[t+1];if(248===i||249===i)break;255!==i&&t++}t++}return t}*[ds](){for(;;){const t=yield*xi[cs](this.I,this.M,0);if(t){let s=Bs.get(t)[z]+2;for(;s<=524288;){if(this.I.R||(yield*xi[cs](this.I,this.M,s))){let i=yield*this.I[ss](s);if(this.I.R||(i=i[nt](0,s)),Pi[gs](i)){const e=new Pi(i,t);return this.M[ps](),this.I[is](s),this.I[hs](e),e}}s=yield*this.D(s+1)}this.I[rs](`Unable to sync FLAC frame after searching ${s} bytes.`),this.I[is](s)}else this.I[is](yield*this.D(1))}}[ys](t){return 0===t[Ut]?(this.M[ps](),this.B=t[$][nt](13)):1===t[Ut]||(t[_]=Fs.get(t)[rt].map((t=>{const s=xi[ws](t,this.M);if(s)return new Pi(t,s,this.B);this.I[rs]("Failed to parse Ogg FLAC frame","Skipping invalid FLAC frame")})).filter((t=>!!t))),t}}class Oi{static*[cs](t,s,i){const e={};let h=yield*t[ss](28,i);if(79!==h[0]||103!==h[1]||103!==h[2]||83!==h[3])return null;e[Kt]=h[4];if(248&h[5])return null;e[j]=!!(4&h[5]),e[N]=!!(2&h[5]),e[L]=!!(1&h[5]);const r=new Ss(bs.from(h[nt](0,28))[P]);try{e[g]=r.getBigInt64(6,!0)}catch{}e[Yt]=r.getInt32(14,!0),e[Ut]=r.getInt32(18,!0),e[Bt]=r.getInt32(22,!0);const n=h[26];e[z]=n+27,h=yield*t[ss](e[z],i),e[Ct]=0,e[Lt]=[],e[Ft]=bs.from(h[nt](27,e[z]));for(let t=0,s=0;t<n;t++){const i=e[Ft][t];e[Ct]+=i,s+=i,255===i&&t!==n-1||(e[Lt].push(s),s=0)}return new Oi(e)}constructor(t){Bs.set(this,t),this[g]=t[g],this[L]=t[L],this[N]=t[N],this[j]=t[j],this[Lt]=t[Lt],this[Ut]=t[Ut],this[Bt]=t[Bt],this[Yt]=t[Yt]}}class ki extends Us{static*[ls](t,s,i){const e=yield*Oi[cs](t,s,i);if(e){const s=Bs.get(e)[Ct],i=Bs.get(e)[z],h=i+s,r=(yield*t[ss](h,0))[nt](0,h),n=r[nt](i,h);return new ki(e,n,r)}return null}constructor(t,s,i){super(t,s),Fs.get(this)[z]=i[z],this[_]=[],this.rawData=i,this[g]=t[g],this[x]=t[Bt],this[k]=0,this[L]=t[L],this[N]=t[N],this[j]=t[j],this[Ut]=t[Ut],this[Ht]=0,this[Yt]=t[Yt]}}class Di extends Ns{constructor(t,s){super(s,t,s[$t]*s[_t]/1e3*s[jt])}}const Bi={0:u.slice(0,2),1:u},Fi="SILK-only",Li="CELT-only",Ui="Hybrid",Ni="narrowband",Gi="medium-band",ji="wideband",Wi="super-wideband",Hi="fullband",Qi={0:{[Y]:Fi,[b]:Ni,[$t]:10},8:{[Y]:Fi,[b]:Ni,[$t]:20},16:{[Y]:Fi,[b]:Ni,[$t]:40},24:{[Y]:Fi,[b]:Ni,[$t]:60},32:{[Y]:Fi,[b]:Gi,[$t]:10},40:{[Y]:Fi,[b]:Gi,[$t]:20},48:{[Y]:Fi,[b]:Gi,[$t]:40},56:{[Y]:Fi,[b]:Gi,[$t]:60},64:{[Y]:Fi,[b]:ji,[$t]:10},72:{[Y]:Fi,[b]:ji,[$t]:20},80:{[Y]:Fi,[b]:ji,[$t]:40},88:{[Y]:Fi,[b]:ji,[$t]:60},96:{[Y]:Ui,[b]:Wi,[$t]:10},104:{[Y]:Ui,[b]:Wi,[$t]:20},112:{[Y]:Ui,[b]:Hi,[$t]:10},120:{[Y]:Ui,[b]:Hi,[$t]:20},128:{[Y]:Li,[b]:Ni,[$t]:2.5},136:{[Y]:Li,[b]:Ni,[$t]:5},144:{[Y]:Li,[b]:Ni,[$t]:10},152:{[Y]:Li,[b]:Ni,[$t]:20},160:{[Y]:Li,[b]:ji,[$t]:2.5},168:{[Y]:Li,[b]:ji,[$t]:5},176:{[Y]:Li,[b]:ji,[$t]:10},184:{[Y]:Li,[b]:ji,[$t]:20},192:{[Y]:Li,[b]:Wi,[$t]:2.5},200:{[Y]:Li,[b]:Wi,[$t]:5},208:{[Y]:Li,[b]:Wi,[$t]:10},216:{[Y]:Li,[b]:Wi,[$t]:20},224:{[Y]:Li,[b]:Hi,[$t]:2.5},232:{[Y]:Li,[b]:Hi,[$t]:5},240:{[Y]:Li,[b]:Hi,[$t]:10},248:{[Y]:Li,[b]:Hi,[$t]:20}};class Vi extends Vs{static[ws](t,s,i){const e={};if(e[At]=t[9],e[bt]=t[18],e[z]=0!==e[bt]?21+e[At]:19,t[z]<e[z])throw new Error("Out of data while inside an Ogg Page");const h=3&s[0],r=3===h?2:1,n=xs(t[nt](0,e[z]))+xs(s[nt](0,r)),a=i[cs](n);if(a)return new Vi(a);if("OpusHead"!==n.substr(0,8))return null;if(1!==t[8])return null;e[$]=bs.from(t[nt](0,e[z]));const o=new Ss(e[$][P]);if(e[S]=16,e[st]=o.getUint16(10,!0),e[kt]=o.getUint32(12,!0),e[jt]=l,e[tt]=o.getInt16(16,!0),e[bt]in Bi&&(e[qt]=Bi[e[bt]][e[At]-1],!e[qt]))return null;0!==e[bt]&&(e[Vt]=t[19],e[C]=t[20],e[St]=[...t[nt](21,e[At]+21)]);const c=Qi[248&s[0]];switch(e[Y]=c[Y],e[b]=c[b],e[$t]=c[$t],h){case 0:e[_t]=1;break;case 1:case 2:e[_t]=2;break;case 3:e[Q]=!!(128&s[1]),e[B]=!!(64&s[1]),e[_t]=63&s[1];break;default:return null}{const{length:t,data:s,channelMappingFamily:h,...r}=e;i[us](n,e,r)}return new Vi(e)}constructor(t){super(t),this[$]=t[$],this[b]=t[b],this[bt]=t[bt],this[St]=t[St],this[C]=t[C],this[_t]=t[_t],this[$t]=t[$t],this[B]=t[B],this[kt]=t[kt],this[Q]=t[Q],this[Y]=t[Y],this[tt]=t[tt],this[st]=t[st],this[Vt]=t[Vt]}}class zi extends Ls{constructor(t,s,i){super(t,s),this.Frame=Di,this.Header=Vi,i(this[T]),this.L=null}get codec(){return"opus"}[ys](t){return 0===t[Ut]?(this.M[ps](),this.L=t[$]):1===t[Ut]||(t[_]=Fs.get(t)[rt].map((t=>{const s=Vi[ws](this.L,t,this.M);if(s)return new Di(t,s);this.I[ns]("Failed to parse Ogg Opus Header","Not a valid Ogg Opus file")}))),t}}class Yi extends Ns{constructor(t,s,i){super(s,t,i)}}const Ki={};for(let t=0;t<8;t++)Ki[t+6]=2**(6+t);class Zi extends Vs{static[ws](t,s,i,e){if(t[z]<30)throw new Error("Out of data while inside an Ogg Page");const h=xs(t[nt](0,30)),r=s[cs](h);if(r)return new Zi(r);const n={[z]:30};if("vorbis"!==h.substr(0,7))return null;n[$]=bs.from(t[nt](0,30));const a=new Ss(n[$][P]);if(n[at]=a.getUint32(7,!0),0!==n[at])return null;if(n[At]=t[11],n[qt]=u[n[At]-1]||"application defined",n[jt]=a.getUint32(12,!0),n[M]=a.getInt32(16,!0),n[v]=a.getInt32(20,!0),n[A]=a.getInt32(24,!0),n[pt]=Ki[(240&t[28])>>4],n[mt]=Ki[15&t[28]],n[mt]>n[pt])return null;if(1!==t[29])return null;n[S]=32,n[ut]=e,n[ct]=i;{const{length:t,data:i,version:e,vorbisSetup:r,vorbisComments:a,...o}=n;s[us](h,n,o)}return new Zi(n)}constructor(t){super(t),this[M]=t[M],this[A]=t[A],this[v]=t[v],this[mt]=t[mt],this[pt]=t[pt],this[$]=t[$],this[ct]=t[ct],this[ut]=t[ut]}}class Ji extends Ls{constructor(t,s,i){super(t,s),this.Frame=Yi,i(this[T]),this.L=null,this.U={count:0},this.N=0,this.G=0}get codec(){return ot}[ys](t){const s=Fs.get(t)[rt];return 0===t[Ut]?(this.M[ps](),this.L=t[$]):1===t[Ut]?s[1]&&(this.W=s[0],this.H=s[1],this.U=this.V(s[1])):t[_]=s.map((t=>{const s=Zi[ws](this.L,this.M,this.W,this.H);if(s)return new Yi(t,s,this.Y(t,s));this.I[ns]("Failed to parse Ogg Vorbis Header","Not a valid Ogg Vorbis file")})),t}Y(t,s){const i=t[0]>>1,e=this.U[i&this.U.mask];e&&(this.N=i&this.U.prevMask?s[pt]:s[mt]),this.G=e?s[pt]:s[mt];const h=this.N+this.G>>2;return this.N=this.G,h}V(t){const s=new ks(t),i="Failed to read "+ot+" stream",e=", failed to parse "+ot+" modes";let h,r={count:0};for(;1!=(1&s.read(1)););for(;r.count<64&&s.position>0;){const t=Os(s.read(8));if(t in r&&(1!==r.count||0!==t))throw this.I[ns]("received duplicate mode mapping"+e),new Error(i);let n=0;for(;0===s.read(8)&&n++<3;);if(4!==n){if(1+((126&Os(h))>>1)!==r.count)throw this.I[ns]("mode count did not match actual modes"+e),new Error(i);break}h=s.read(7),r[t]=1&h,s.position+=6,r.count++}return r.mask=(1<<Math.log2(r.count))-1,r.prevMask=1+(1|r.mask),r}}class Xi extends Ls{constructor(t,s,i){super(t,s),this.K=i,this.Frame=ki,this.Header=Oi,this.J=null,this.X=new bs,this.tt=0}get codec(){return this.J||""}st(t,s){this.J!==t&&(this.M[ms](),this.it=new s(this.I,this.M,this.K),this.J=t)}et({data:t}){const s=xs(t[nt](0,8));switch(s){case"fishead\0":case"fisbone\0":case"index\0\0\0":return!1;case"OpusHead":return this.st("opus",zi),!0;case/^\x7fFLAC/.test(s)&&s:return this.st("flac",$i),!0;case/^\x01vorbis/.test(s)&&s:return this.st(ot,Ji),!0}}ht(t){t[Ut]!==this.tt+1&&this.tt>1&&t[Ut]>1&&this.I[rs]("Unexpected gap in Ogg Page Sequence Number.",`Expected: ${this.tt+1}, Got: ${t[Ut]}`),this.tt=t[Ut]}*[ds](){const t=yield*this[os](!0);this.ht(t);const s=Fs.get(t),{pageSegmentBytes:i,pageSegmentTable:e}=Bs.get(s[F]);let h=0;if(s[rt]=e.map((s=>t[$][nt](h,h+=s))),255===i[i[z]-1]?this.X=Rs(this.X,s[rt].pop()):this.X[z]&&(s[rt][0]=Rs(this.X,s[rt][0]),this.X=new bs),this.J||this.et(t)){const s=this.it[ys](t);return this.I[hs](s),s}}}const te=()=>{};const se=class{constructor(t,{onCodec:s,onCodecHeader:i,onCodecUpdate:e,enableLogging:h=!1,enableFrameCRC32:r=!0}={}){this.rt=t,this.K=s||te,this.h=i||te,this.S=e,this.nt=h,this.ot=r?Is:te,this.ct=this.ut(),this.ct.next()}get codec(){return this.it[T]}*flush(){this.R=!0;for(let t=this.ct.next();t.value;t=this.ct.next())yield t.value;this.R=!1,this.ct=this.ut(),this.ct.next()}*parseChunk(t){for(let s=this.ct.next(t);s.value;s=this.ct.next())yield s.value}parseAll(t){return[...this.parseChunk(t),...this.flush()]}*ut(){if(this.M=new Ds(this.h,this.S),this.rt.match(/aac/))this.it=new vi(this,this.M,this.K);else if(this.rt.match(/mpeg/))this.it=new mi(this,this.M,this.K);else if(this.rt.match(/flac/))this.it=new $i(this,this.M,this.K);else{if(!this.rt.match(/ogg/))throw new Error(`Unsupported Codec ${mimeType}`);this.it=new Xi(this,this.M,this.K)}for(this.lt=0,this.dt=0,this.yt=0,this.ft=0,this.wt=0,this.gt=void 0,this.bt=new Uint8Array(0);;){const t=yield*this.it[ds]();t&&(yield t)}}*[ss](t=0,s=0){let i;for(;this.bt[z]<=t+s;){if(i=yield,this.R)return this.bt[nt](s);i&&(this.yt+=i[z],this.bt=Rs(this.bt,i))}return this.bt[nt](s)}[is](t){this.dt+=t,this.bt=this.bt[nt](t)}[es](t){this.gt=t[F][jt],t[F][q]=8*Math.round(t[$][z]/t[k]),t[Rt]=this.lt++,t[Jt]=this.ft,t[ts]=this.wt,t[Xt]=this.wt/this.gt*1e3,t[x]=this.ot(t[$]),this.M[fs](t[F][q],t[Xt]),this.ft+=t[$][z],this.wt+=t[Ht]}[hs](t){t[_]?(t[_].forEach((s=>{t[k]+=s[k],t[Ht]+=s[Ht],this[es](s)})),t[ts]=this.wt,t[Xt]=this.wt/this.gt*1e3||0,t[Jt]=this.ft):this[es](t)}St(t,s){if(this.nt){const i=[`${T}:         ${this[T]}`,`inputMimeType: ${this.rt}`,`readPosition:  ${this.dt}`,`totalBytesIn:  ${this.yt}`,`${Jt}: ${this.ft}`],e=Math.max(...i.map((t=>t[z])));s.push(`--stats--${"-".repeat(e-9)}`,...i,"-".repeat(e)),t("codec-parser",s.reduce(((t,s)=>t+"\n  "+s),""))}}[rs](...t){this.St(console.warn,t)}[ns](...t){this.St(console.error,t)}}}},h={};function r(t){var s=h[t];if(void 0!==s)return s.exports;var i=h[t]={exports:{}};return e[t](i,i.exports,r),i.exports}r.m=e,t=[],r.O=(s,i,e,h)=>{if(!i){var n=1/0;for(u=0;u<t.length;u++){for(var[i,e,h]=t[u],a=!0,o=0;o<i.length;o++)(!1&h||n>=h)&&Object.keys(r.O).every((t=>r.O[t](i[o])))?i.splice(o--,1):(a=!1,h<n&&(n=h));if(a){t.splice(u--,1);var c=e();void 0!==c&&(s=c)}}return s}h=h||0;for(var u=t.length;u>0&&t[u-1][2]>h;u--)t[u]=t[u-1];t[u]=[i,e,h]},r.F={},r.E=t=>{Object.keys(r.F).map((s=>{r.F[s](t)}))},r.d=(t,s)=>{for(var i in s)r.o(s,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},r.f={},r.e=t=>Promise.all(Object.keys(r.f).reduce(((s,i)=>(r.f[i](t,s),s)),[])),r.u=t=>968===t?"icecast-metadata-player-1.15.4.common.min.js":"icecast-metadata-player-1.15.4."+{122:"vorbis",388:"mpeg",390:"opus",496:"synaudio",756:"mediasource",983:"flac"}[t]+".min.js",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,s)=>Object.prototype.hasOwnProperty.call(t,s),s={},i="IcecastMetadataPlayer:",r.l=(t,e,h,n)=>{if(s[t])s[t].push(e);else{var a,o;if(void 0!==h)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var l=c[u];if(l.getAttribute("src")==t||l.getAttribute("data-webpack")==i+h){a=l;break}}a||(o=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.setAttribute("data-webpack",i+h),a.src=t),s[t]=[e];var d=(i,e)=>{a.onerror=a.onload=null,clearTimeout(y);var h=s[t];if(delete s[t],a.parentNode&&a.parentNode.removeChild(a),h&&h.forEach((t=>t(e))),i)return i(e)},y=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),o&&document.head.appendChild(a)}},r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"qt",{value:!0})},(()=>{var t;r.g.importScripts&&(t=r.g.location+"");var s=r.g.document;if(!t&&s&&(s.currentScript&&(t=s.currentScript.src),!t)){var i=s.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=t})(),(()=>{var t={179:0};r.f.j=(s,i)=>{var e=r.o(t,s)?t[s]:void 0;if(0!==e)if(e)i.push(e[2]);else{var h=new Promise(((i,h)=>e=t[s]=[i,h]));i.push(e[2]=h);var n=r.p+r.u(s),a=new Error;r.l(n,(i=>{if(r.o(t,s)&&(0!==(e=t[s])&&(t[s]=void 0),e)){var h=i&&("load"===i.type?"missing":i.type),n=i&&i.target&&i.target.src;a.message="Loading chunk "+s+" failed.\n("+h+": "+n+")",a.name="ChunkLoadError",a.type=h,a.request=n,e[1](a)}}),"chunk-"+s,s)}},r.F.j=s=>{if(!r.o(t,s)||void 0===t[s]){t[s]=null;var i=document.createElement("link");r.nc&&i.setAttribute("nonce",r.nc),i.rel="prefetch",i.as="script",i.href=r.p+r.u(s),document.head.appendChild(i)}},r.O.j=s=>0===t[s];var s=(s,i)=>{var e,h,[n,a,o]=i,c=0;if(n.some((s=>0!==t[s]))){for(e in a)r.o(a,e)&&(r.m[e]=a[e]);if(o)var u=o(r)}for(s&&s(i);c<n.length;c++)h=n[c],r.o(t,h)&&t[h]&&t[h][0](),t[h]=0;return r.O(u)},i=self.webpackChunkIcecastMetadataPlayer=self.webpackChunkIcecastMetadataPlayer||[];i.forEach(s.bind(null,0)),i.push=s.bind(null,i.push.bind(i))})(),r.O(0,[179],(()=>{r.E(496),r.E(756)}),5);var n={};(()=>{r.d(n,{default:()=>yt});const t=()=>{},s=new WeakMap,i={LOADING:"loading",PLAYING:"playing",STOPPING:"stopping",STOPPED:"stopped",RETRYING:"retrying",SWITCHING:"switching"},e={BUFFER:"buffer",PLAY:"play",PLAY_READY:"playready",LOAD:"load",STREAM_START:"streamstart",STREAM:"stream",STREAM_END:"streamend",METADATA:"metadata",METADATA_ENQUEUE:"metadataenqueue",CODEC_UPDATE:"codecupdate",STOP:"stop",RETRY:"retry",RETRY_TIMEOUT:"retrytimeout",SWITCH:"switch",WARN:"warn",ERROR:"error",PLAYBACK_ERROR:"playbackerror"},h=Symbol(),a=Symbol(),o=Symbol(),c=Symbol(),u=Symbol(),l=Symbol(),d=Symbol(),y=Symbol(),f=Symbol(),m=Symbol(),p=Symbol(),w=Symbol(),g=Symbol(),b=Symbol(),S=Symbol(),q=Symbol(),M=Symbol(),A=Symbol(),v=Symbol(),P=Symbol(),E=Symbol(),T=Symbol(),_=Symbol("synced"),C=Symbol("syncing"),I=Symbol("pcm_synced"),R=Symbol("not_synced"),x=t=>{const s=new Uint8Array(t.reduce(((t,s)=>t+s.length),0));return t.reduce(((t,i)=>(s.set(i,t),t+i.length)),0),s};class ${constructor(){this.Mt=[]}hasEventListener(t,s){return this.Mt.some((i=>i.type===t&&i.listener===s))}addEventListener(t,s,i={}){return this.hasEventListener(t,s)||this.Mt.push({type:t,listener:s,options:i}),this}removeEventListener(t,s){const i=this.Mt.findIndex((i=>i.type===t&&i.listener===s));return i>=0&&this.Mt.splice(i,1),this}removeEventListeners(){return this.Mt=[],this}dispatchEvent(t){return this.Mt.filter((s=>s.type===t.type)).forEach((s=>{const{type:i,listener:e,options:{once:h}}=s;e.call(this,t),!0===h&&this.removeEventListener(i,e)})),this}}class O{constructor(){this.At=0,this.vt=0,this.Pt=0,this.Et=0,this.Tt=0,this._t=0,this.Ct=0}get stats(){return{totalBytesRead:this.At,streamBytesRead:this.vt,metadataLengthBytesRead:this.Pt,metadataBytesRead:this.Et,currentBytesRemaining:this.Tt,currentStreamBytesRemaining:this._t,currentMetadataBytesRemaining:this.Ct}}set currentStreamBytesRemaining(t){this._t+=t}set currentMetadataBytesRemaining(t){this.Ct=t}addBytes(t){this.At+=t,this.Tt-=t}addStreamBytes(t){this.vt+=t,this._t-=t}addMetadataLengthBytes(t){this.Pt+=t}addMetadataBytes(t){this.Et+=t,this.Ct-=t}addCurrentBytesRemaining(t){this.Tt+=t}}const k=()=>{};class D{constructor(t){this.It=0,this.Rt=0,this.xt=new Uint8Array(0),this.$t=[],this.Ot=0,this.kt=new O,this.Dt=t.onStream||k,this.Bt=t.onMetadata||k,this.Ft=t.onMetadataFailed||k,this.Lt=t.onError||k,this.nt=t.enableLogging||!1,this.Ut=Promise.resolve(),this.Nt=Promise.resolve(),this.ct=this.Gt(),this.ct.next()}*Gt(){for(this.It=1/0;;)this.jt(yield*this.Wt()),yield*this.Ht()}static Qt(...t){const s=t.reduce(((t,s)=>t+s.length),0);return this.Vt(t,s)}static Vt(t,s){const i=new Uint8Array(s);return t.reduce(((t,s)=>(i.set(s,t),t+s.length)),0),i}*iterator(t){for(let s=this.ct.next(t);s.value;s=this.ct.next())yield s.value}readAll(t){for(let s=this.ct.next(t);s.value;s=this.ct.next());}async*asyncIterator(t){for(let s=this.ct.next(t);s.value;s=this.ct.next())await this.Ut,await this.Nt,yield s.value}async asyncReadAll(t){for(let s=this.ct.next(t);s.value;s=this.ct.next())await this.Ut,await this.Nt}zt(...t){this.nt&&console.warn("icecast-metadata-js",t.reduce(((t,s)=>t+"\n  "+s),"")),this.Lt(...t)}jt(t){this.$t.push(t),this.Ot+=t.length}*Ht(){if(this.$t.length){const t=D.Vt(this.$t,this.Ot);this.$t=[],this.Ot=0,this.kt.addStreamBytes(t.length);const s={stream:t,stats:this.kt.stats};this.Ut=this.Dt(s),yield s}}*Yt(t){yield*this.Ht();const s={metadata:t,stats:this.kt.stats};this.Nt=this.Bt(s),yield s}*Wt(t=0){for(this.Rt===this.xt.length&&(this.xt=yield*this.Kt(),this.Rt=0);this.xt.length-this.Rt<t;)this.xt=D.Qt(this.xt,yield*this.Kt());const s=this.xt.subarray(this.Rt,(t||this.It)+this.Rt);return this.kt.addBytes(s.length),this.It=s.length<this.It?this.It-s.length:0,this.Rt+=s.length,s}*Kt(){let t;yield*this.Ht();do{t=yield}while(!t||0===t.length);return this.kt.addCurrentBytesRemaining(t.length),t}}class B extends D{constructor({icyMetaInt:t,icyDetectionTimeout:s=2e3,icyCharacterEncoding:i="utf-8",...e}){super(e),this.Zt=new globalThis.TextDecoder(i),this.Jt=t,this.Xt=s,this.ct=this.ts(),this.ct.next()}*ts(){if(yield*this.ss())for(;;)this.It=this.Jt,yield*this.es(),yield*this.hs(),this.It&&(yield*this.rs());this.It=1/0,yield*this.es()}static parseIcyMetadata(t){const s=/(?<key>[^\0]+?)='(?<val>[^\0]*?)(;$|';|'$|$)/,i={};for(const e of t.match(new RegExp(s,"g"))||[]){const t=e.match(s);t&&(i[t.groups.key]=t.groups.val)}return i}get icyMetaInt(){return this.Jt}*ss(){if(this.Jt>0)return!0;if(!this.Xt)return!1;this.zt("Passed in Icy-MetaInt is invalid. Attempting to detect ICY Metadata.","See https://github.com/eshaz/icecast-metadata-js for information on how to properly request ICY Metadata.");const t=[null,83,116,114,101,97,109,84,105,116,108,101,61],s=Date.now();let i=0;for(;s+this.Xt>Date.now();){this.xt=D.Qt(this.xt,yield*this.Kt());t:for(;i<this.xt.length-t.length;){for(let s=1;s<t.length;s++)if(this.xt[s+i]!==t[s]){i++;continue t}return this.zt(`Found ICY Metadata! Setting Icy-MetaInt to ${i}.`),this.Jt=i,!0}}return this.zt("ICY Metadata not detected, but continuing anyway. Audio errors will occur if there is ICY metadata.",`Searched ${this.xt.length} bytes for ${(Date.now()-s)/1e3} seconds.`,"Try increasing the `icyDetectionTimeout` value if ICY metadata is present in the stream."),this.Ft("icy"),!1}*es(){for(this.kt.currentStreamBytesRemaining=this.It;this.It;)this.jt(yield*super.Wt())}*hs(){this.It=1;do{this.It=16*(yield*this.Wt())[0]}while(1===this.It);this.kt.addMetadataLengthBytes(1)}*rs(){this.kt.currentMetadataBytesRemaining=this.It;const t=yield*this.Wt(this.It);this.kt.addMetadataBytes(t.length),yield*this.Yt(B.parseIcyMetadata(this.Zt.decode(t)))}}class F extends D{constructor(t){super(t),this.Zt=new globalThis.TextDecoder("utf-8"),this.ct=this.ns(),this.ct.next(),this.os=!1}*ns(){if(yield*this.cs()){const t=yield*this.us();if(t)for(;yield*this.cs();)this.os||(yield*this.rs(t)),yield*this.es()}this.It=1/0,yield*this.es()}ls(t,s=0){return new DataView(Uint8Array.from([...t.subarray(s,s+4)]).buffer).getUint32(0,!0)}ds(t,s){return String.fromCharCode(...s).match(t)}*cs(){let t=[];for(;t.length<=65307;){const s=yield*super.Wt(6);if(79===s[0]&&103===s[1]&&103===s[2]&&83===s[3]&&!(248&s[5])){this.os=1&s[5],this.Rt-=6,this.It+=6,this.kt.At-=6,this.kt.Tt+=6;break}t.push(s[0]),this.Rt-=5,this.kt.At-=5,this.kt.Tt+=5}if(t.length&&this.jt(Uint8Array.from(t)),t.length>65307)return this.zt("This stream is not an OGG stream. No OGG metadata will be returned.","See https://github.com/eshaz/icecast-metadata-js for information on OGG metadata."),this.Ft("ogg"),!1;const s=yield*this.Wt(27),i=yield*this.Wt(s[26]);return this.It=i.reduce(((t,s)=>t+s),0),!0}*us(){const t=yield*this.Wt(8);return yield*this.es(),this.ds(/\x7fFLAC/,t.subarray(0,5))?{regex:/^[\x84|\x04]/,length:4}:this.ds(/OpusHead/,t.subarray(0,8))?{regex:/OpusTags/,length:8}:this.ds(/\x01vorbis/,t.subarray(0,7))?{regex:/\x03vorbis/,length:7}:void 0}*rs({regex:t,length:s}){this.ds(t,yield*this.Wt(s))&&(yield*this.Yt(yield*this.ys()))}*es(){for(;this.It;)yield*this.Wt()}*Wt(t){const s=yield*super.Wt(t);return this.jt(s),s}*Kt(){const t=yield*super.Kt();return this.kt.currentStreamBytesRemaining=t.length,t}*ys(){const t=this.ls(yield*this.Wt(4));this.kt.addMetadataBytes(4);const s=this.Zt.decode(yield*this.Wt(t));this.kt.addMetadataBytes(t);const i=this.ls(yield*this.Wt(4));this.kt.addMetadataBytes(4);const e=[];for(let t=0;t<i;t++){const t=yield*this.Wt(4);this.kt.addMetadataBytes(4),e.push(yield*this.Wt(this.ls(t))),this.kt.addMetadataBytes(e[e.length-1].length)}return this.kt.currentMetadataBytesRemaining=0,e.reduce(((t,s)=>{const i=s.indexOf(61),e=String.fromCharCode(...s.subarray(0,i)).toUpperCase(),h=this.Zt.decode(s.subarray(i+1));return t[e]=t[e]?`${t[e]}; ${h}`:h,t}),{VENDOR_STRING:s})}}class L{constructor(t){const{onStream:s,...i}=t;this.fs=new F(t),this.ps=new B(i)}get icyMetaInt(){return this.ps.icyMetaInt}*iterator(t){for(const s of this.ps.iterator(t))s.stream?yield*this.fs.iterator(s.stream):yield s}readAll(t){for(const s of this.ps.iterator(t))s.stream&&this.fs.readAll(s.stream)}async*asyncIterator(t){for await(const s of this.ps.asyncIterator(t))if(s.stream)for await(const t of this.fs.asyncIterator(s.stream))yield t;else yield s}async asyncReadAll(t){for await(const s of this.ps.iterator(t))s.stream&&await this.fs.asyncReadAll(s.stream)}}class U{constructor({metadataTypes:t=["icy"],...s}={}){const i=t.includes("icy"),e=t.includes("ogg");this.ws=i&&e?new L(s):e?new F(s):i?new B(s):new D(s)}static parseIcyMetadata(t){return B.parseIcyMetadata(t)}get icyMetaInt(){return this.ws.icyMetaInt}*iterator(t){yield*this.ws.iterator(t)}readAll(t){this.ws.readAll(t)}async*asyncIterator(t){return yield*this.ws.asyncIterator(t)}async asyncReadAll(t){return this.ws.asyncReadAll(t)}}const N=()=>{};class G{constructor(t,{onStream:s=N,...i}){let e;this.gs=new ReadableStream({async start(h){e=new U({icyMetaInt:parseInt(t.headers.get("Icy-MetaInt")),...i,onStream:async t=>(h.enqueue(t.stream),s(t))});for await(const s of G.asyncIterator(t.body))await e.asyncReadAll(s);h.close()}}),this.bs=e}get icyMetaInt(){return this.bs.icyMetaInt}get readableStream(){return this.gs}async startReading(){try{for await(const t of G.asyncIterator(this.gs));}catch(t){if("AbortError"!==t.name)throw t}}static asyncIterator(t){const s=t.getReader();return{[Symbol.asyncIterator]:()=>({next:()=>s.read()})}}}const j=()=>{};class W{constructor({icyBr:t,onMetadataUpdate:s=j,onMetadataEnqueue:i=j,paused:e=!1}){this.Ss=t,this.qs=s,this.Ms=i,this.As=e,this.vs=e,this.Ps=!0,this.Es=[],this.Ts=[]}get metadataQueue(){return this.Ts.map((({_s:t,...s})=>s))}addMetadata({metadata:t,stats:s},i,e=0){const h={metadata:t,timestampOffset:i,timestamp:e+=s?this.getTimeByBytes(s.currentStreamPosition):0};this.vs?this.Es.push(h):this.Cs(h)}getTimeByBytes(t){return this.Ss?t/(125*this.Ss):0}startQueue(t){this.vs&&(this.Es.forEach((s=>{void 0!==t&&(s.timestamp=t),(void 0===t||s.timestampOffset>=s.timestamp)&&this.Cs(s)})),this.Es=[],this.vs=!1)}purgeMetadataQueue(){this.Ts.forEach((t=>clearTimeout(t._s))),this.Ts=[],this.Es=[],this.vs=this.As,this.Ps=!0}Cs(t){this.Ts.push(t),this.Ms(t.metadata,t.timestampOffset,t.timestamp),this.Ps?(this.Is(),this.Ps=!1):t._s=setTimeout((()=>{this.Is()}),1e3*(t.timestampOffset-t.timestamp))}Is(){if(this.Ts.length){const{metadata:t,timestampOffset:s,timestamp:i}=this.Ts.shift();this.qs(t,s,i)}}}var H=r(273);let Q;const V=new Worker(URL.createObjectURL(new Blob(["self.onmessage = () => self.postMessage(!!self.Worker)"],{type:"text/javascript"})));V.onmessage=t=>{Q=t.data,V.terminate()},V.postMessage(null);class z{constructor(t,s){this.CRC_DURATION=3e5,this.PCM_DURATION=6e4,this.bs=t,this.Rs=s,this.initSync(),this.initQueue()}initSync(){clearTimeout(this.xs),this.xs=null,this.$s=null,this.Os=!1,this.ks=[],this.Ds=0,this.Bs=null,this.Fs=null,this.Ls=null}initQueue(){this.Us=0,this.Ns=0,this.Gs=0,this.js=[],this.Ws=0,this.Hs={},this.Qs=[],this.Vs=0}get buffered(){return this.Ns/this.Gs-this.Rs.currentTime||0}add(t){const{crc32:s,duration:i,samples:e}=t;this.Ns+=e,this.Gs=t.header.sampleRate,this.js.push({crc32:s,duration:i}),this.Ws+=i;let h=this.Hs[s];if(h||(h=[],this.Hs[s]=h),h.push(this.Us++),this.Ws>=this.CRC_DURATION){const{crc32:t,duration:s}=this.js.shift();this.Ws-=s;const i=this.Hs[t];i.shift(),i.length||delete this.Hs[t]}this.Qs.push(t),this.Vs+=i,this.Vs>=this.PCM_DURATION&&(this.Vs-=this.Qs.shift().duration)}addAll(t){t.forEach((t=>this.add(t)))}zs(t){for(const s of t)this.Ds+=s.duration,this.ks.push(s)}async sync(s){if(null===this.xs){const s=this.buffered;this.Ys=t,this.xs=setTimeout((()=>{this.$s=`Buffer underrun after syncing for ${s.toFixed(2)} seconds.`,this.Ys(this.$s)}),1e3*s)}return this.zs(s),new Promise((async(t,s)=>{let i;null!==this.$s?s(this.$s):this.Ys=s,this.Os&&(i=this.Ks()),i||(this.Os=!1,i=await this.Zs()),i?t(i):s("Old and new request do not match.")})).catch((t=>{this.bs.state!==i.STOPPING&&this.bs.state!==i.STOPPED&&this.bs[q](e.WARN,`Reconnected successfully after ${this.bs.state}.`,"Unable to sync old and new request.",t);const s=this.ks;return this.initSync(),this.initQueue(),[s,R]})).then((t=>([_,I].includes(t[1])&&this.initSync(),t)))}Ks(){if(!this.ks.length)return[[],C];const t=this.ks[0].crc32,s=this.Hs[t];let i,h,r;if(s){t:for(const t of s){r=t-(this.Us-this.js.length);for(let t=0;t<this.ks.length&&r+t<this.js.length;t++)if(this.js[r+t].crc32!==this.ks[t].crc32)continue t;h=r+this.ks.length<=this.js.length,i=!0;break}if(h)return[[],C];if(i){const t=this.js.length-r;return this.bs[q](e.WARN,`Reconnected successfully after ${this.bs.state}.`,`Found ${t} frames (${(this.js.slice(r).reduce(((t,{duration:s})=>t+s),0)/1e3).toFixed(3)} seconds) of overlapping audio data in new request.`,"Synchronized old and new request."),[this.ks.slice(t),_]}}}async Zs(){try{const t=1,s=16,i=(t,s)=>t/s;if(!this.Bs){let h;try{h=(await r.e(496).then(r.bind(r,420))).default}catch(t){return void this.bs[q](e.WARN,"Failed to synchronize old and new stream","Missing `synaudio` dependency.")}const[n,a,o]=await this.Js(),c=o*t;if(a.samplesDecoded<=c)return[[],C];const u=new h({correlationSampleSize:c,initialGranularity:s});this.Bs=await(Q?u.syncWorkerConcurrent(n,a,Math.max(navigator.hardwareConcurrency-1,1)):u.syncWorker(n,a)),this.Bs.offsetFromEnd=i(n.samplesDecoded-this.Bs.sampleOffset,o)}const{correlation:h,offsetFromEnd:n}=this.Bs;let a=1e3*(this.buffered-n);if(-a>this.Ds)return[[],C];const o=0;if(a<0){let t=0;for(let s=0;t<this.ks.length-o&&s>a;t++)s-=this.ks[t].duration;this.ks=this.ks.slice(t-o)}else for(let t=0;t<o&&t<this.ks.length;t++)a-=this.ks[t].duration;return this.bs[q](e.WARN,`Reconnected successfully after ${this.bs.state}.`,`Synchronized old and new request with ${(Math.round(1e4*h)/100).toFixed(2)}% confidence.`),this.initQueue(),[this.ks,I,a]}catch{}}async Js(){const t=(t,s)=>{let i=t.length-1;for(let e=0;e<s&&i>0;i--)e+=t[i].duration;return this.bs[c].decodeAudioData(x(t.slice(i).map((({data:t})=>t))).buffer)};[this.Fs,this.Ls]=await Promise.all([this.Fs?this.Fs:t(this.Qs,2e3*this.buffered),t(this.ks,1/0)]);const s=t=>{const s={channelData:[],samplesDecoded:t.length};for(let i=0;i<t.numberOfChannels;i++)s.channelData.push(Float32Array.from(t.getChannelData(i)));return s};return[s(this.Fs),s(this.Ls),this.Fs.sampleRate]}}class Y{constructor(t,i,e,r){this.bs=t,this.rt=i,this.J=e,this.Xs=r;const n=s.get(this.bs);this.ti=n[u],this.si=n[h],this.ii=n[l],this.ei=0,this.hi=0,this.ri=()=>{this.syncState=R}}static parseMimeType(t){return t.match(/^(?:application\/|audio\/|)(?<mime>[a-zA-Z]+)(?:$|;[ ]*codecs=(?:\'|\")(?<codecs>[a-zA-Z,]+)(?:\'|\"))/)}static canPlayType(t,s,i){const e=Y.parseMimeType(s),h=s=>s.reduce(((s,i)=>{if(""===s)return"";const e=t(i);return e?"maybe"===e||"maybe"===s?"maybe":!0===e||"probably"===e?"probably":void 0:""}),null);if(e){const{mime:t,codecs:r}=e.groups,n=i&&i[t];if(!n||Array.isArray(n))return h(n||[s])||h([`audio/${t}`]);if("object"==typeof n){if(r){const t=r.split(",");return t.length>1?"":n[t[0]]?h(n[t[0]]):""}return"maybe"}}return""}enablePlayButton(t){this.ti.removeAttribute("src"),this.ti.srcObject=null,t.includes("mediasource")?this.ti.src=URL.createObjectURL(new MediaSource):t.includes("webaudio")?(this.ni=new MediaStream,this.ti.srcObject=this.ni):t.includes("html5")&&(this.ti.src="data:audio/mpeg;base64,//sQxAAABFgC/SCEYACCgB9AAAAAppppVCAHBAEIgBByw9WD5+J8ufwxiDEDsMfE+D4fwG/RUGCx6VO4awVxV3qDtQNPiXKnZUNSwKuUDR6IgaeoGg7Fg6pMQU1FMy4xMDCqqqqqqqr/+xLEB4PAAAGkAAAAIAAANIAAAASqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqo=",this.ti.loop=!0)}get syncStateUpdate(){return this.ai}get syncState(){return this.oi}set syncState(t){this.oi=t,this.ci&&this.ci(t),this.ai=new Promise((t=>{this.ci=t}))}get isSupported(){return!1}get isAudioPlayer(){return!1}get metadataTimestamp(){return 0}get currentTime(){return 0}get waiting(){return Promise.resolve()}get icecastMetadataQueue(){return this.ui}set icecastMetadataQueue(t){this.ui=t}get codecUpdateQueue(){return this.li}set codecUpdateQueue(t){this.li=t}get metadataQueue(){return this.ui?this.ui.metadataQueue:[]}di(){this.ui.startQueue(this.yi),this.li.startQueue(this.yi)}async fi(){this.syncState=_,this.syncFrames=[],this.syncDelay=null,this.mi=new z(this.bs,this)}async start(t){let s;this.yi=t,[e.RETRY,e.SWITCH].forEach((t=>this.bs.addEventListener(t,this.ri)));const h=new Promise((t=>{s=t,[i.PLAYING,i.STOPPING].forEach((t=>this.bs.addEventListener(t,s,{once:!0})))})).finally((()=>{[i.PLAYING,i.STOPPING].forEach((t=>this.bs.removeEventListener(t,s)))}));await h}async end(){[e.RETRY,e.SWITCH].forEach((t=>this.bs.removeEventListener(t,this.ri))),this.ui.purgeMetadataQueue(),this.li.purgeMetadataQueue()}onStream(t){return t}onMetadata(t){this.ui.addMetadata(t,this.metadataTimestamp,this.currentTime)}onCodecUpdate(t,s){const i=this.currentTime;s<i&&(this.hi+=this.ei),this.ei=s,this.li.addMetadata({metadata:t},(s+this.hi)/1e3,i)}}class K extends Y{constructor(t){super(t),this.ti.crossOrigin="anonymous",this.ti.loop=!1,this.ti.preload="none",this.bs.addEventListener(e.STREAM_START,(()=>{this.pi||this.end()})),this.fi()}static canPlayType(t){return K.isSupported?super.canPlayType((t=>(new Audio).canPlayType(t)),t):""}static get isSupported(){return Boolean(window.Audio)}static get name(){return"html5"}get isAudioPlayer(){return!0}get metadataTimestamp(){return this.wi?(this.wi.totalDuration+this.gi)/1e3:0}get currentTime(){return this.bi&&(performance.now()-this.bi)/1e3}get waiting(){return new Promise((t=>{this.ti.addEventListener("waiting",t,{once:!0})}))}async fi(){super.fi(),this.wi=null,this.bi=0,this.gi=0,this.pi=!1}async start(t){const s=super.start(t);this.Si=performance.now(),this.ti.src=null,this.ti.srcObject=null,this.ti.src=this.si,this.bs.state!==i.STOPPING&&this.bs.state!==i.STOPPED&&(this.ti.addEventListener("playing",(()=>{this.bi=performance.now(),this.gi=performance.now()-this.Si,this.di(),this.bs[q](e.PLAY)}),{once:!0}),this.bs[q](e.PLAY_READY),this.pi=!0),await s}async end(){super.end(),this.ti.src=null,this.ti.srcObject=null,this.fi()}onStream(t){this.wi=t[t.length-1]||this.wi,this.syncState===R&&(this.syncState=R)}}class Z extends Y{constructor(t,s,i,e){super(t,s,i,e),this.qi=r.e(756).then(r.bind(r,910)),this.fi()}static canPlayType(t){return Z.isSupported?MediaSource.isTypeSupported(t)?"probably":super.canPlayType(MediaSource.isTypeSupported,t,{mpeg:['audio/mp4;codecs="mp3"'],aac:['audio/mp4;codecs="mp4a.40.2"'],aacp:['audio/mp4;codecs="mp4a.40.2"'],flac:['audio/mp4;codecs="flac"'],ogg:{flac:['audio/mp4;codecs="flac"'],opus:['audio/mp4;codecs="opus"','audio/webm;codecs="opus"'],vorbis:['audio/webm;codecs="vorbis"']}}):""}static get isSupported(){return Boolean(window.MediaSource)}static get name(){return"mediasource"}get isAudioPlayer(){return!0}get metadataTimestamp(){return this.Mi&&this.Mi.sourceBuffers.length&&Math.max(this.Mi.sourceBuffers[0].timestampOffset,this.Mi.sourceBuffers[0].buffered.length?this.Mi.sourceBuffers[0].buffered.end(0):0)||0}get currentTime(){return this.ti.currentTime}get waiting(){return new Promise((t=>{this.ti.addEventListener("waiting",t,{once:!0})}))}async fi(){super.fi(),this.Ai=[],this.pi=!1,this.vi=!1,this.Pi=new Promise((t=>{this.Ei=t})),this.Ti=new Promise((t=>{this._i=t})),this.Ci=this.Ii(this.rt,this.J),await this.Ti}async start(t){const s=super.start(t);await this.Pi,await this.Ri(),await s}async end(){super.end(),await this.fi()}async onStream(t){if((t=t.flatMap((t=>t.codecFrames?t.codecFrames.map((s=>(s.isLastPage=t.isLastPage,s))):t))).length){switch(this.syncState){case R:this.mi.initSync(),this.syncState=C;case C:[this.syncFrames,this.syncState,this.syncDelay]=await this.mi.sync(t),t=this.syncFrames}switch(this.syncState){case I:break;case _:await this.Ti,await this.Ci(t),this.mi.addAll(t)}}}Ii(t,s){return MediaSource.isTypeSupported(t)?(this.xi(t),async t=>this.$i(x(t.map((t=>t.data))))):(this.Xs.then((i=>this.Oi(t,s,i.channels))).then((()=>{this.xi(this.ki.mimeType)})),t.match(/ogg/)?async i=>{let e=[];for await(const h of i){if(this.vi!==h.isLastPage)if(h.isLastPage)this.vi=!0;else{await this.$i(x(e)),e=[];const i=await this.Xs;await this.Oi(t,s,i.channels),this.vi=!1}e.push(...this.ki.iterator([h]))}await this.$i(x(e))}:async t=>this.$i(x([...this.ki.iterator(t)])))}async Oi(t,s,i){this.ki=new(await this.qi).default(t,{codec:s,preferredContainer:i>2?"webm":"fmp4"}),MediaSource.isTypeSupported(this.ki.mimeType)||this.bs[q](e.PLAYBACK_ERROR,`Media Source Extensions API in your browser does not support ${t} or ${this.ki.mimeType}.See: https://caniuse.com/mediasource and https://developer.mozilla.org/en-US/docs/Web/API/Media_Source_Extensions_API`)}xi(t){this.Mi=new MediaSource,this.Ei(),this.Mi.addEventListener("sourceopen",(()=>{this.bs.state!==i.STOPPED&&this.bs.state!==i.STOPPING&&(this.Mi.addSourceBuffer(t).mode="sequence"),this.Di=0,this._i()}),{once:!0})}async Ri(){this.ti.loop=!1,this.ti.src=URL.createObjectURL(this.Mi),await this.Ti}async Bi(){return new Promise((t=>{const s=this.Mi.sourceBuffers[0];s.updating?s.addEventListener("updateend",t,{once:!0}):t()}))}async $i(t){if(this.bs[q](e.STREAM,t),this.Mi.sourceBuffers.length||this.bs[q](e.WARN,"Attempting to append audio, but MediaSource has not been or is no longer initialized","Please be sure that `detachAudioElement()` was called and awaited before reusing the element with a new IcecastMetadataPlayer instance"),this.bs.state!==i.STOPPING&&this.Mi.sourceBuffers.length){this.Ai.push(t);try{for(;this.Ai.length;)this.Mi.sourceBuffers[0].appendBuffer(this.Ai.shift()),await this.Bi()}catch(t){if("QuotaExceededError"!==t.name)throw t}this.pi||(this.ii<=this.metadataTimestamp?(this.ti.addEventListener("playing",(()=>{this.di(),this.bs[q](e.PLAY)}),{once:!0}),this.bs[q](e.PLAY_READY),this.pi=!0):this.bs[q](e.BUFFER,this.metadataTimestamp)),this.ti.currentTime>5+this.ii&&this.Di+5e3<performance.now()&&(this.Di=performance.now(),this.Mi.sourceBuffers[0].remove(0,this.ti.currentTime-5+this.ii),await this.Bi())}}}class J extends Y{constructor(t,s,i,e){super(t,s,i,e),this.Fi=t[c],this.fi()}static canPlayType(t){return J.isSupported?super.canPlayType((t=>'audio/ogg;codecs="opus"'===t||'audio/ogg;codecs="flac"'===t||'audio/ogg;codecs="vorbis"'===t||"audio/mpeg"===t||"audio/flac"===t),t,{flac:["audio/flac"],mpeg:["audio/mpeg"],ogg:{flac:['audio/ogg;codecs="flac"'],opus:['audio/ogg;codecs="opus"'],vorbis:['audio/ogg;codecs="vorbis"']}}):""}static get isSupported(){return Boolean(window.WebAssembly&&(window.AudioContext||window.webkitAudioContext)&&window.MediaStream)}static get name(){return"webaudio"}get isAudioPlayer(){return!0}get metadataTimestamp(){return this.Li/1e3}get currentTime(){return(performance.now()-this.Ui)/1e3||0}get waiting(){return this.Ni}Gi(t){let s;this.ji+=t,s=setTimeout((()=>{this.ji-=t,this.Wi.delete(s),this.Wi.size||this.Hi()}),this.ji),this.Wi.add(s)}Hi(){this.Qi&&this.Qi(),this.Ni=new Promise((t=>{this.Qi=t}))}Vi(){this.Wi&&this.Wi.forEach((t=>clearTimeout(t))),this.Wi=new Set,this.ji=0,this.Hi()}async zi(){let t;this.Yi=new Promise((t=>{this.Ki=t}));try{switch(this.J){case"mpeg":const{MPEGDecoderWebWorker:s}=await Promise.all([r.e(968),r.e(388)]).then(r.bind(r,775));t=s;break;case"opus":const{OpusDecoderWebWorker:i}=await Promise.all([r.e(968),r.e(390)]).then(r.bind(r,879));t=i;break;case"flac":const{FLACDecoderWebWorker:e}=await Promise.all([r.e(968),r.e(983)]).then(r.bind(r,259));t=e;break;case"vorbis":const{OggVorbisDecoderWebWorker:h}=await Promise.all([r.e(968),r.e(122)]).then(r.bind(r,115));t=h}}catch(t){return void this.bs[q](e.PLAYBACK_ERROR,`Missing \`webaudio-${this.J}\` dependency.`,`Unable to playback playback \`${this.J}\` audio.`)}if(t){const s=await this.Xs;this.Ki(),this.Zi=new t(s)}else this.bs[q](e.PLAYBACK_ERROR,"Unsupported `webaudio` playback codec: "+this.J)}async fi(){super.fi(),this.Li=0,this.Ji=0,this.Xi=0,this.gt=0,this.Ui=void 0,this.pi=!1,this.Vi(),this.te=new Promise((t=>{this.se=t}))}async start(t){this.Zi||await this.zi();const s=super.start(t);this.se(),await s}async end(){super.end(),this.Zi&&(this.Zi.terminate(),this.Zi=null),this.ni&&this.ni.stream.getTracks().forEach((t=>this.ni.stream.removeTrack(t))),this.fi()}async onStream(t){if("vorbis"!==this.J)switch(t=t.flatMap((t=>t.codecFrames||t)),this.syncState){case R:this.mi.initSync(),this.syncState=C;case C:[this.syncFrames,this.syncState,this.syncDelay]=await this.mi.sync(t),t=this.syncFrames}switch(this.syncState){case I:break;case _:t.length&&(this.Li=t[t.length-1].totalDuration,this.ie(t))}}async ie(t){if(await this.Yi,this.Zi){let s;await this.Zi.ready,"vorbis"===this.J?s=this.Zi.decodeOggPages(t):(s=this.Zi.decodeFrames(t.map((t=>t.data))),this.mi.addAll(t)),s.then((t=>this.ee(t)))}}async ee({channelData:t,samplesDecoded:s,sampleRate:h}){if(await this.te,this.bs.state!==i.STOPPING&&this.bs.state!==i.STOPPED&&s){this.bs[q](e.STREAM,{channelData:t,samplesDecoded:s,sampleRate:h}),this.gt||(this.gt=h,this.ni=this.Fi.createMediaStreamDestination(),this.ni.channelCount=this.Fi.destination.maxChannelCount,this.ti.srcObject=this.ni.stream);const i=this.Fi.createBuffer(t.length,s,this.gt);t.forEach(((t,s)=>i.getChannelData(s).set(t)));const r=this.Fi.createBufferSource();r.buffer=i,r.connect(this.ni);const n=100,a=this.Ji*n+this.Xi,o=Math.round(this.Fi.currentTime*this.gt*n);a<o&&(this.Xi+=o-a),r.start(a/this.gt/n),this.Gi(s/this.gt*1e3),this.pi||(this.ii<=this.metadataTimestamp?(this.bs[q](e.PLAY_READY),this.Ui=performance.now(),this.di(),this.bs[q](e.PLAY),this.pi=!0):this.bs[q](e.BUFFER,this.metadataTimestamp)),this.Ji+=s}}}class X{constructor(i){const e=s.get(i);this.bs=i,this.ti=e[u],this.nt=e[m],this.he=e[S],this.re="",this.ne(),this.Rs=new Y(this.bs),this.Rs.icecastMetadataQueue=this.ui,this.Rs.codecUpdateQueue=this.li,this.Rs.enablePlayButton(X.supportedPlaybackMethods),this.ae=[],this.I=void 0,this.rt="",this.J="",this.oe=Promise.resolve(),this.ce=t}static get supportedPlaybackMethods(){return[Z,J,K].map((t=>t.isSupported?t.name:""))}static canPlayType(t){return{mediasource:Z.canPlayType(t),html5:K.canPlayType(t),webaudio:J.canPlayType(t)}}get player(){return this.Rs}get playbackMethod(){return this.re}get icyMetaInt(){return this.ue&&this.ue.icyMetaInt}async playStream(){return this.fetchStream().then((async t=>(this.bs[q](e.STREAM_START),this.readIcecastResponse(t).finally((()=>{this.bs[q](e.STREAM_END)}))))).catch((t=>{if(this.bs.state!==i.SWITCHING)throw t}))}async switchStream(){this.bs.state!==i.PLAYING&&(this.ce(),await this.oe);const t=s.get(this.bs);t[T]=i.SWITCHING,t[E].abort(),t[E]=new AbortController}async fetchStream(){const t=s.get(this.bs);this.si=t[h];const i=await fetch(this.si,{method:"GET",headers:t[P]?{"Icy-MetaData":1}:{},signal:t[E].signal});if(!i.ok){const t=new Error(`${i.status} received from ${i.url}`);throw t.name="HTTP Response Error",t}return i}async readIcecastResponse(t){const i=t.headers.get("content-type"),h=s.get(this.bs);let r;const n=new Promise((t=>{r=t})),o=new Promise((t=>{this.I=new H.Z(i,{onCodec:t,onCodecHeader:r,onCodecUpdate:this.he&&((...t)=>this.Rs.onCodecUpdate(...t)),enableLogging:this.nt})}));this.ue=new G(t,{onMetadata:async t=>{this.Rs.onMetadata(t)},onStream:async({stream:t})=>{this.bs[q](e.STREAM,t);const s=[...this.I.parseChunk(t)];if(this.Rs.isAudioPlayer){const t=[...this.ae,...s];this.ae=[],await this.Rs.onStream(t)}else this.ae.push(...s)},onError:(...t)=>this.bs[q](e.WARN,...t),metadataTypes:h[a],icyCharacterEncoding:h[y],icyDetectionTimeout:h[f],...h[d]?{icyMetaInt:h[d]}:{}});const c=this.ue.startReading(),u=await o;this.Rs.isAudioPlayer||([this.Rs,this.re]=this.le(i,u,n)),this.Rs.syncState===_?this.Rs.start():await this.de(i,u),await c}async de(t,s){let e,h,r=!1,n=!1;const a=this.Rs,o=this.Rs.icecastMetadataQueue,c=this.Rs.codecUpdateQueue;this.ne(),a.icecastMetadataQueue=this.ui,a.codecUpdateQueue=this.li;const u=()=>{n=!0,this.bs.state===i.STOPPING&&this.bs.state===i.STOPPED||(a.icecastMetadataQueue.purgeMetadataQueue(),a.codecUpdateQueue.purgeMetadataQueue(),this.Rs.start(Math.max(0,a.syncDelay/1e3)).then((()=>a.end())).then(h))};this.ce=()=>{r=!0,this.ui.purgeMetadataQueue(),this.li.purgeMetadataQueue(),this.Rs.icecastMetadataQueue=o,this.Rs.codecUpdateQueue=c,void 0===e||n||(clearTimeout(e),u())};const l=()=>this.Rs.syncStateUpdate.then((n=>{if(r)h();else switch(n){case C:return l();case _:this.ui.purgeMetadataQueue(),this.li.purgeMetadataQueue(),this.Rs.icecastMetadataQueue=o,this.Rs.codecUpdateQueue=c,this.bs.state===i.STOPPING&&this.bs.state===i.STOPPED||(this.bs[T]=i.PLAYING),h();break;case I:case R:a.icecastMetadataQueue=o,a.codecUpdateQueue=c,[this.Rs,this.re]=this.le(t,s),this.ae.push(...a.syncFrames),e=setTimeout(u,Math.max(a.syncDelay,0))}}));let d;this.oe=new Promise((t=>{h=t,d=()=>{this.ce(),h()},this.bs.addEventListener(i.STOPPING,d,{once:!0}),l()})).finally((()=>{this.bs.removeEventListener(i.STOPPING,d)}))}ne(){this.ui=new W({onMetadataUpdate:(...t)=>this.bs[q](e.METADATA,...t),onMetadataEnqueue:(...t)=>this.bs[q](e.METADATA_ENQUEUE,...t),paused:!0}),this.li=new W({onMetadataUpdate:(...t)=>this.bs[q](e.CODEC_UPDATE,...t),paused:!0})}le(t,i,e){const{[s.get(this.bs)[o]]:h,...r}={mediasource:Z,webaudio:J,html5:K};let n,a;for(const s of Object.values({firstMethod:h,...r})){const h=s.canPlayType(`${t};codecs="${i}"`);if("probably"===h||"maybe"===h){a=s.name,n=new s(this.bs,t,i,e),n.icecastMetadataQueue=this.ui,n.codecUpdateQueue=this.li;break}}if(!n)throw new Error(`Your browser does not support this audio codec ${t}${i&&`;codecs="${i}"`}`);return[n,a]}}let tt;try{new window.EventTarget,tt=window.EventTarget}catch{tt=$}const st=Symbol(),it=Symbol(),et=Symbol(),ht=Symbol(),rt=Symbol(),nt=Symbol(),at=Symbol(),ot=Symbol(),ct=Symbol(),ut=Symbol(),lt=Symbol(),dt=Symbol();class yt extends tt{static getDefaults(t,s={}){return{[l]:t.bufferLength??s[l]??1,[d]:t.icyMetaInt??s[d],[y]:t.icyCharacterEncoding??s[y],[f]:t.icyDetectionTimeout??s[f],[a]:(t.metadataTypes??s[a])||["icy"],[P]:((t.metadataTypes??s[a])||["icy"]).includes("icy"),[m]:t.enableLogging??s[m]??!1,[S]:Boolean(t.enableCodecUpdate??s[S]??t.onCodecUpdate),[p]:t.retryDelayRate??s[p]??.1,[w]:t.retryDelayMin??s[w]??.5,[g]:t.retryDelayMax??s[g]??2,[b]:t.retryTimeout??s[b]??30,[o]:(t.playbackMethod??s[o])||"mediasource"}}constructor(r,n={}){super(),s.set(this,{[h]:r,[u]:n.audioElement||new Audio,...yt.getDefaults(n),[et]:{[e.PLAY]:n.onPlay||t,[e.PLAY_READY]:t,[e.LOAD]:n.onLoad||t,[e.STREAM_START]:n.onStreamStart||t,[e.BUFFER]:n.onBuffer||t,[e.STREAM]:n.onStream||t,[e.STREAM_END]:n.onStreamEnd||t,[e.METADATA]:n.onMetadata||t,[e.METADATA_ENQUEUE]:n.onMetadataEnqueue||t,[e.CODEC_UPDATE]:n.onCodecUpdate||t,[e.STOP]:n.onStop||t,[e.RETRY]:n.onRetry||t,[e.RETRY_TIMEOUT]:n.onRetryTimeout||t,[e.SWITCH]:n.onSwitch||t,[e.WARN]:(...t)=>{this[v](console.warn,n.onWarn,t)},[e.ERROR]:(...t)=>{this[v](console.error,n.onError,t)},[e.PLAYBACK_ERROR]:(...t)=>{this.state!==i.RETRYING?(this[q](e.ERROR,...t),this.stop()):s.get(this)[ut]()}},[ut]:()=>{clearTimeout(s.get(this)[dt]),this.removeEventListener(e.STREAM_START,s.get(this)[ut]),s.get(this)[u].removeEventListener("waiting",s.get(this)[ot]);try{s.get(this)[u].pause()}catch(t){s.get(this)[at](t)}try{s.get(this)[it]=s.get(this)[st].player.end()}catch{}},[rt]:()=>{this.play()},[ht]:()=>{this.stop()},[at]:t=>{const s=t?.target?.error||t;this[q](e.PLAYBACK_ERROR,"The audio element encountered an error."+({1:" MEDIA_ERR_ABORTED The fetching of the associated resource was aborted by the user's request.",2:" MEDIA_ERR_NETWORK Some kind of network error occurred which prevented the media from being successfully fetched, despite having previously been available.",3:" MEDIA_ERR_DECODE Despite having previously been determined to be usable, an error occurred while trying to decode the media resource, resulting in an error.",4:" MEDIA_ERR_SRC_NOT_SUPPORTED The associated resource or media provider object (such as a MediaStream) has been found to be unsuitable.",5:" MEDIA_ERR_ENCRYPTED"}[s?.code]||""))},[nt]:()=>{const t=s.get(this)[u];(this.state===i.LOADING||!t.loop&&this.state!==i.STOPPING&&this.state!==i.STOPPED)&&t.play().then((()=>{this[T]=i.PLAYING})).catch((t=>{this[q](e.PLAYBACK_ERROR,t,"Playback failed.")}))},[ct]:t}),this[M](),this[T]=i.STOPPED,s.get(this)[st]=new X(this)}static canPlayType(t){return X.canPlayType(t)}get audioElement(){return s.get(this)[u]}get[c](){return yt.constructor[c]}get icyMetaInt(){return s.get(this)[st].icyMetaInt}get metadataQueue(){return s.get(this)[st].player.metadataQueue}get state(){return s.get(this)[T]}get playbackMethod(){return s.get(this)[st].playbackMethod}set[T](t){this.dispatchEvent(new CustomEvent(t)),s.get(this)[T]=t}[M](){const t=s.get(this)[u];t.addEventListener("pause",s.get(this)[ht]),t.addEventListener("play",s.get(this)[rt]),t.addEventListener("error",s.get(this)[at]),this.addEventListener(e.PLAY_READY,s.get(this)[nt])}async detachAudioElement(){const t=s.get(this)[u];t.removeEventListener("pause",s.get(this)[ht]),t.removeEventListener("play",s.get(this)[rt]),t.removeEventListener("error",s.get(this)[at]),this.removeEventListener(e.PLAY_READY,s.get(this)[nt]),await this.stop()}async play(){if(this.state===i.STOPPED){const t=new Promise((t=>{this.addEventListener(e.PLAY,t,{once:!0})})),h=new Promise((t=>{this.addEventListener(e.STREAM_END,t,{once:!0})}));s.get(this)[E]=new AbortController,this[T]=i.LOADING,this[q](e.LOAD);const r=async()=>s.get(this)[st].playStream().then((async()=>{if(this.state===i.SWITCHING)return this[q](e.SWITCH),r();this.state!==i.STOPPING&&this.state!==i.STOPPED&&(await t,await h,await s.get(this)[st].player.waiting)})).catch((async t=>{if(t&&"AbortError"!==t.name){if(await this[A](t))return this[q](e.RETRY),r();s.get(this)[E].abort(),this.state!==i.STOPPING&&this.state!==i.STOPPED&&this[q](e.ERROR,t.message.match(/network|fetch|offline|codec/i)?t:t.stack,t)}}));new Promise(((t,i)=>{s.get(this)[ct]=i,r().then(t)})).catch((t=>{if(this.state!==i.STOPPING)throw t})).finally((()=>{s.get(this)[ut](),this[q](e.STOP),this[T]=i.STOPPED})),await t}}async stop(){this.state!==i.STOPPED&&this.state!==i.STOPPING&&(this[T]=i.STOPPING,s.get(this)[E].abort(),s.get(this)[ct](),await new Promise((t=>{this.addEventListener(e.STOP,t,{once:!0})})))}async switchEndpoint(t,e){if(this.state!==i.STOPPED&&this.state!==i.STOPPING){const i=s.get(this);return Object.assign(i,{[h]:t,...yt.getDefaults(e,i)}),i[st].switchStream()}}async[A](t){if(0===s.get(this)[b])return!1;if(s.get(this)[T]===i.RETRYING)return await new Promise((t=>{this.addEventListener(i.STOPPING,t,{once:!0});const e=Math.min(1e3*s.get(this)[w]*(s.get(this)[p]+1)**s.get(this)[lt]++,1e3*s.get(this)[g]);setTimeout((()=>{this.removeEventListener(i.STOPPING,t),t()}),e+.3*e*Math.random())})),s.get(this)[T]===i.RETRYING;if(s.get(this)[T]!==i.STOPPING&&s.get(this)[T]!==i.STOPPED&&(t.message.match(/network|fetch|offline|Error in body stream/i)||"HTTP Response Error"===t.name)){this[q](e.ERROR,t.name,t),this[T]=i.RETRYING,s.get(this)[P]&&this[q](e.WARN,"This stream was requested with ICY metadata.",'If there is a CORS preflight failure, try removing "icy" from the metadataTypes option.',"See https://github.com/eshaz/icecast-metadata-js#cors for more details.");const h=new Promise((t=>{s.get(this)[ot]=t,s.get(this)[u].addEventListener("waiting",s.get(this)[ot],{once:!0})}));return s.get(this)[dt]=setTimeout((()=>{h.then((()=>{s.get(this)[T]===i.RETRYING&&(this[q](e.RETRY_TIMEOUT),this.stop())}))}),1e3*s.get(this)[b]),s.get(this)[lt]=0,!0}return!1}[q](t,...i){this.dispatchEvent(new CustomEvent(t,{detail:i})),s.get(this)[et][t](...i)}[v](t,i,e){s.get(this)[m]&&t("icecast-metadata-js",e.reduce(((t,s)=>t+"\n  "+s),"")),i&&i(...e)}}const ft=window.AudioContext||window.webkitAudioContext;if(ft&&!yt.constructor[c]){yt.constructor[c]="audio context pending";const t=t=>{console.error("icecast-metadata-js","Failed to start the AudioContext. WebAudio playback will not be possible.",t)},s=["touchstart","touchend","mousedown","keydown"],i=()=>{s.forEach((t=>document.removeEventListener(t,i)));const e=new ft({latencyHint:"interactive"});e.destination.channelCount=e.destination.maxChannelCount,e.resume().then((()=>{e.createScriptProcessor(16384,2,2).connect(e.destination),e.onstatechange=()=>{"running"!==e.state&&e.resume().catch(t)}})).catch(t),yt.constructor[c]=e};s.forEach((t=>document.addEventListener(t,i)))}})(),n=r.O(n),IcecastMetadataPlayer=n.default})();
//# sourceMappingURL=icecast-metadata-player-1.15.4.main.min.js.map
{"version":3,"file":"icecast-metadata-player-1.15.0.synaudio.min.js","mappings":"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","sources":["webpack://IcecastMetadataPlayer/./node_modules/@eshaz/web-worker/cjs/browser.js","webpack://IcecastMetadataPlayer/./node_modules/simple-yenc/src/simple-yenc.js","webpack://IcecastMetadataPlayer/./node_modules/synaudio/src/SynAudio.js","webpack://IcecastMetadataPlayer/./node_modules/synaudio/index.js"],"sourcesContent":["/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nmodule.exports = Worker;","const encode = (byteArray) => {\n  const charArray = [];\n\n  for (const byte of byteArray) {\n    let encoded = (byte + 42) % 256;\n\n    if (\n      encoded === 0 || //  NULL\n      encoded === 10 || // LF\n      encoded === 13 || // CR\n      encoded === 61 //    =\n    ) {\n      charArray.push(\"=\" + String.fromCharCode((encoded + 64) % 256));\n    } else {\n      charArray.push(String.fromCharCode(encoded));\n    }\n  }\n\n  return charArray.join(\"\");\n};\n\nconst decode = (string) => {\n  const htmlCodeOverrides = new Map();\n  [\n    ,\n    8364,\n    ,\n    8218,\n    402,\n    8222,\n    8230,\n    8224,\n    8225,\n    710,\n    8240,\n    352,\n    8249,\n    338,\n    ,\n    381,\n    ,\n    ,\n    8216,\n    8217,\n    8220,\n    8221,\n    8226,\n    8211,\n    8212,\n    732,\n    8482,\n    353,\n    8250,\n    339,\n    ,\n    382,\n    376,\n  ].forEach((k, v) => htmlCodeOverrides.set(k, v));\n\n  const output = new Uint8Array(string.length);\n\n  let escaped = false,\n    byteIndex = 0,\n    byte,\n    offset = 42, // default yEnc offset\n    startIdx = 0;\n\n  if (string.length > 13 && string.substring(0, 9) === \"dynEncode\") {\n    const version = parseInt(string.substring(9, 11), 16);\n    if (version === 0) {\n      offset = parseInt(string.substring(11, 13), 16);\n      startIdx = 13;\n    }\n  }\n\n  const offsetReverse = 256 - offset;\n\n  for (let i = startIdx; i < string.length; i++) {\n    byte = string.charCodeAt(i);\n\n    if (byte === 61 && !escaped) {\n      escaped = true;\n      continue;\n    }\n\n    if (byte > 255) {\n      const htmlOverride = htmlCodeOverrides.get(byte);\n      if (htmlOverride) byte = htmlOverride + 127;\n    }\n\n    if (escaped) {\n      escaped = false;\n      byte -= 64;\n    }\n\n    output[byteIndex++] =\n      byte < offset && byte > 0 ? byte + offsetReverse : byte - offset;\n  }\n\n  return output.subarray(0, byteIndex);\n};\n\nconst dynamicEncode = (byteArray, stringWrapper = '\"') => {\n  let shouldEscape,\n    offsetLength = Infinity,\n    offset = 0;\n\n  if (stringWrapper === '\"')\n    shouldEscape = (byte1) =>\n      byte1 === 0 || //  NULL\n      byte1 === 8 || //  BS\n      byte1 === 9 || //  TAB\n      byte1 === 10 || // LF\n      byte1 === 11 || // VT\n      byte1 === 12 || // FF\n      byte1 === 13 || // CR\n      byte1 === 34 || // \"\n      byte1 === 92 || // \\\n      byte1 === 61; //   =;\n\n  if (stringWrapper === \"'\")\n    shouldEscape = (byte1) =>\n      byte1 === 0 || //  NULL\n      byte1 === 8 || //  BS\n      byte1 === 9 || //  TAB\n      byte1 === 10 || // LF\n      byte1 === 11 || // VT\n      byte1 === 12 || // FF\n      byte1 === 13 || // CR\n      byte1 === 39 || // '\n      byte1 === 92 || // \\\n      byte1 === 61; //   =;\n\n  if (stringWrapper === \"`\")\n    shouldEscape = (byte1, byte2) =>\n      byte1 === 61 || // =\n      byte1 === 13 || // CR\n      byte1 === 96 || // `\n      (byte1 === 92 && (byte2 === 85 || byte2 === 117)) || // \\u or \\U\n      (byte1 === 36 && byte2 === 123); // ${\n\n  // search for the byte offset with the least amount of escape characters\n  for (let o = 0; o < 256; o++) {\n    let length = 0;\n\n    for (let i = 0; i < byteArray.length; i++) {\n      const byte1 = (byteArray[i] + o) % 256 | 0;\n      const byte2 = (byteArray[i + 1] + o) % 256 | 0;\n\n      if (shouldEscape(byte1, byte2)) length++;\n      length++;\n    }\n\n    if (length < offsetLength) {\n      offsetLength = length;\n      offset = o;\n    }\n  }\n\n  const escapeCharacter = (byte1, charArray) =>\n    charArray.push(\"=\", String.fromCharCode((byte1 + 64) % 256));\n\n  const charArray = [\n    \"dynEncode\", // magic signature\n    \"00\", // version 0x00 - 0xfe (0xff reserved)\n    offset.toString(16).padStart(2, \"0\"), // best offset in bytes 0x00 - 0xff\n  ];\n\n  for (let i = 0; i < byteArray.length; i++) {\n    const byte1 = (byteArray[i] + offset) % 256;\n    const byte2 = (byteArray[i + 1] + offset) % 256;\n\n    if (shouldEscape(byte1, byte2)) {\n      escapeCharacter(byte1, charArray);\n    } else {\n      charArray.push(String.fromCharCode(byte1));\n    }\n  }\n\n  // correct edge case where escape character is at end of string\n  if (charArray[charArray.length - 1] === \"\\\\\") {\n    charArray.pop();\n    escapeCharacter(\"\\\\\", charArray);\n  }\n\n  return charArray.join(\"\");\n};\n\n// allows embedded javascript string template\nconst stringify = (rawString) =>\n  rawString\n    .replace(/[\\\\]/g, \"\\\\\\\\\")\n    .replace(/[`]/g, \"\\\\`\")\n    .replace(/\\${/g, \"\\\\${\");\n\nmodule.exports = {\n  encode,\n  dynamicEncode,\n  decode,\n  stringify,\n};\n","/* Copyright 2022 Ethan Halsall\n    \n    This file is part of synaudio.\n    \n    synaudio is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    synaudio is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with this program.  If not, see <https://www.gnu.org/licenses/>\n*/\n\nimport { decode } from \"simple-yenc\";\nimport Worker from \"@eshaz/web-worker\";\n\n// prettier-ignore\nconst simd=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]))\n\nconst wasmModule = new WeakMap();\n\n/* WASM strings are embeded during the build */\nconst simdWasm = String.raw`dynEncode0065eÆØÒfeeefsfÅoääääääääääegtfhÊÓÛkÒÊÒÔ×Þgeghgfekmfäe¦åíiplgnÈÔ××ÊÑÆÙÊeepÄÄÍÊÆÕÄÇÆØÊheo\u0016f\u0013ivälànâiá©eeeeeeeeg¥g¥g¦g­reg¦fÐ|f¦v³i¥f¦uÐz¦efÐ}ef¦gÙxÏ~e¦¥Ðuth¥ffwÑvÏ{tpuo¦eqh¥eqg¦gÙÏqqbeeeegvÏ¦gÙÏbeeebIfbpeeeg¦i×q¦gÙÏrrbeeeeqvÏ¦gÙÏbeeebIfbpeeeg¦m×q¦gÙÏrrbeeeeqvÏ¦gÙÏbeeebIfbpeeeg¦q×q¦gÙÏrrbeeeeqvÏ¦gÙÏbeeebIfbpeepr¦¥Ðpos¦¥Ðog¦uÏqz­repg¥fq±reg¥fqÐo¦i®reeqvÏ¦gÙÏ~®iäeq¦gÙÏe{¦gÙÏ®j¦epreo¦áÖ{¦iÐp¦gÛ¦fÏ¦fÖg¥pªi¥¦egqfpzgÐ¦áÖ¦iÐ¦gÛ¦fÏ¦cdddlÖp¦egh¥srbegesbegebIfbpgesrbegusbegubIfbpgur¦Ïrs¦Ïsg¦mÏgp¦gÐpreppi¥egqÏg¦gÙÏpegvÏ¦gÙÏbegepbegebIfbpgepo{«rffq{ÏqÐopq¦äØgo¦fÖiäeq¦gÙÏoeqvÏ¦gÙÏgeoge÷geq¦fÏjqpqg}«refqÐpyq¦gÙoÏregh¥goÏqgrÏsgeqge÷geqsgiqgi÷gig¦mÏgp¦gÐpreppxyÏytxÏtw¦fÏw|¬repqfpf¦e±re¦efÐtf¦fÖuef¦gÙvÏwf¦i®yf¦áÖo¦q«zh¥frÑs¦egg¥g¥yreeefsÏ¦gÙÏ®wes¦gÙÏq°ÖreeqbegeebegebIfbpgeg¥o¦i«reeqbeguebegubIfbpguo¦m«reeqbegebegbIfbpgzreeqbegebegbIfbpgpfog«rfpg¦äØquiäeg¦gÙÏxegsÏ¦gÙÏgexge÷geg¦f×jgpgqt«refgÐqpg¦gÙxÏ{egh¥gxÏsg{Ï}gesge÷ges}gisgi÷gig¦mÏgq¦gÐqrepppvÏpr¦fÏr|¬reppg¥j¦g­rej¦fÐvi¦v³i¥i¦uÐ|¦ey¦eiÐ{hi¦gÙzÏ}h¦¥Ðjt¦ewh¥iiwÑuÏxtpjo¦eqh¥hqg¦gÙÏqqbeeehguÏ¦gÙÏbeeebIfbpeehg¦i×q¦gÙÏrrbeeehquÏ¦gÙÏbeeebIfbpeehg¦m×q¦gÙÏrrbeeehquÏ¦gÙÏbeeebIfbpeehg¦q×q¦gÙÏrrbeeehquÏ¦gÙÏbeeebIfbpeepr¦¥Ðpos¦¥Ðog¦uÏq|­repg¥iq±reg¥iqÐo¦i®rehquÏ¦gÙÏ}®iähq¦gÙÏhx¦gÙÏ®j¦epreo¦áÖx¦iÐp¦gÛ¦fÏ¦fÖ~g¥pªi¥¦egqfp|gÐ¦áÖ¦iÐ¦gÛ¦fÏ¦cdddlÖp¦egh¥srbegesbegebIfbpgesrbegusbegubIfbpgur¦Ïrs¦Ïsg¦mÏgp¦gÐprepp~i¥hgqÏg¦gÙÏphguÏ¦gÙÏbegepbegebIfbpgepox«rfiqxÏqÐopq¦äØgo¦fÖiähq¦gÙÏohquÏ¦gÙÏgeoge÷geq¦fÏjqpqg{«reiqÐpyq¦gÙoÏrhgh¥goÏqgrÏsgeqge÷geqsgiqgi÷gig¦mÏgp¦gÐpreppyzÏytzÏtw¦fÏwv¬repqfpi¦e±re¦ep¦eiÐsi¦fÖthi¦gÙuÏwi¦i®yi¦áÖj¦q«|¦erh¥irÑo¦egg¥g¥yrehhioÏ¦gÙÏ®who¦gÙÏq°ÖrehqbegehbegebIfbpgeg¥j¦i«rehqbeguhbegubIfbpguj¦m«rehqbeghbegbIfbpg|rehqbeghbegbIfbpgpjgi«rfpg¦äØqtiähg¦gÙÏzhgoÏ¦gÙÏgezge÷geg¦f×jgpgqs«reigÐqpg¦gÙzÏxhgh¥gzÏogxÏ{geoge÷geo{giogi÷gig¦mÏgq¦gÐqrepppuÏpr¦fÏrv¬repp¦ein¦egem¦egeg¥k¦e¯i¥k¦hÖjg¥k¦fÐi¦h®i¥¦eoqfpegk¦áÖoqh¥gge \u0005ggi \u0005ggm \u0005ggq \u0005g¦uÏgq¦iÐqreppji¥eo¦gÙÏgjqh¥gge \u0005g¦iÏgq¦fÐqreppg¥i¦h®i¥¦eoqfphgk¦áÖoqh¥gge \u0005ggi \u0005ggm \u0005ggq \u0005g¦uÏgq¦iÐqreppji¥ho¦gÙÏgh¥gge \u0005g¦iÏgj¦fÐjreppk¦uÐsk\u001c\b\u001bk¦v­i¥¦ei¦eqqgpbx¦ejhgh¥gbeeebJfbKfbIfgbeeubJfbKfbIfgbeebJfbKfbIfgbeebJfbKfbIfg¦¥Ðgj¦uÏjs­repi¦ÕÖq¦fiqfpk¦uÐsk\u001c\b\u001b¦eqpbhbgbebf÷÷÷g¥kq±req¦äØkÏpk¦hÖoiähq¦gÙÏgojh¥ggeøù÷g¦iÏgj¦fÐjrepoq×jqpqp¦h®rekqÐjhq¦gÙÏgh¥ggqøùggmøùggiøùggeøù÷÷÷÷g¦uÏgj¦iÐjrepp¦ejii¥bxhgh¥ggbeeebJfbpeeggbeeubJfbpeuggbeebJfbpeggbeebJfbpeg¦¥Ðgj¦uÏjs­reppk\u0017¨eeå$÷úfkÐtg¥jk³rekkjÐf¦h°iäf¦áÖr¦iÐg¦gÛ¦fÏo¦hÖqbx¦epg¦q´i¥o¦adddlÖohj¦gÙÏgh¥ggbegebJfbpgeggbegubJfbpguggbegbJfbpgggbegbJfbpgg¦¥Ðgp¦uÏpo¦iÐoreppqi¥hjpÏ¦gÙÏgh¥ggbegebJfbpgeg¦uÏgq¦fÐqreppfr«rfjrÏjjpjÐqhj¦gÙÏgh¥gggeøgeg¦iÏgq¦fÐqreppöt¦e¯i¥l¦gÙu¦er¦ekÐvk¦fÖwk¦fÐ¦ÕÖq eoh¥er¦gÙÏygeekrÏ¦gÙÏ|\b\u001bgäiªi¥bqeeeeeeeeeeeeeeeebqeeeeeeeeeeeeeeee¦eqfpbx¦eg¦epbqeeeeeeeeeeeeeeeebqeeeeeeeeeeeeeeeeh¥goÏfbeeebJfghÏjbeeebKfbIffbeeubJfjbeeubKfbIffbeebJfjbeebKfbIffbeebJfjbeebKfbIfbKfbIfbKfbIfbKfbIfbKfbIfg¦¥Ðgp¦uÏps­repqpf|gebhbgbebf÷÷÷bhbgbebf÷÷÷g¥fk³ref¦äØgwiäyf¦gÙjÏgeøhjÏgeù÷ù÷f¦f×jfpfgv«ref¦gÙgkfÐjh¥goÏfgiøghÏpgiùfgeøpgeù÷÷ùù÷÷g¦mÏgj¦gÐjreppú ú \u0004\u0007\b\u001bmgeÃi¥nrgemgep \u0006 \u0005ouÏolrÏrt­reppg¥l¦f±rengefllÑgÏjtjt­t¦epfgÐf¦ef¦e¯rg¥k¦e±i¥qfpk¦hÖjg¥k¦fÐ¦h®i¥qfper¦gÙÏgk¦áÖpqh¥gge \u0005ggi \u0005ggm \u0005ggq \u0005g¦uÏgq¦iÐqreppjªreeprÏ¦gÙÏgh¥gge \u0005g¦iÏgj¦fÐjrepprt³re¦ekÐpk¦fÖuer¦gÙÏok¦fÐ¦ÕÖl h¥er¦gÙÏvgeekrÏ¦gÙÏw\b\u001bgäiªi¥bqeeeeeeeeeeeeeeeebqeeeeeeeeeeeeeeee¦eqfpbx¦eqoghjbqeeeeeeeeeeeeeeeebqeeeeeeeeeeeeeeeeh¥gbeeebJfjbeeebKfbIfgbeeubJfjbeeubKfbIfgbeebJfjbeebKfbIfgbeebJfjbeebKfbIfbKfbIfbKfbIfbKfbIfbKfbIfg¦¥Ðgj¦¥Ðjq¦uÏqs­replpfwgebhbgbebf÷÷÷bhbgbebf÷÷÷g¥fk³ref¦äØguiävf¦gÙjÏgeøhjÏgeù÷ù÷f¦f×jfpfgp«ref¦gÙgkfÐjh¥goÏfgiøghÏqgiùfgeøqgeù÷÷ùù÷÷g¦mÏgj¦gÐjreppú ú \u0004\u0007\b\u001bmgeÃi¥nrgemgep \u0006 \u0005o¦iÏor¦fÏrt¬reppppetÙÆ×ÌÊÙÄËÊÆÙÚ×ÊØflØÎÒÉ`;\nconst scalarWasm = String.raw`dynEncode000e\u000eo{\u000f\u000e\u000e\u000e\u000f+\u0011n\u0011\u000en\u0013\u000fn\u0018\u000e\u0010\u001d\u000f\u0011s|\u0014{s{}\u0010\u000e\u0010\u0011\u0012\u0011\u000e\u000f\u0010\u0014\u0016\u000f\u000eO\u0012\u0019\u0015)\u0010\u0017q}szos\u000e\u0010\u0019mmvso~mpos\u0011\u000e\u0018  \u0011Ú\u0011\u0010\u0019\u000f\u0010N.\u0010O\u0010V\u001b\u000e.\u0010O\u000fy/\u0014.\u000fO\u0013\\\u0012N.\u000fO\u0012y/\u0015.\u000fO\u0010/\u0016.\u000fO\u000f/\u0017\u0011N.\u000e/\u0010O\u000f/\u0012\u0011N.\u0010.\u0010.\u0013x0\u00118\u0010\u000e.\u00108\u0010\u000e F\u0010\u000e.\u0010.\u00118\u0010\u0012.\u00108\u0010\u0012 F\u0010\u0012.\u0010.\u00118\u0010\u0016.\u00108\u0010\u0016 F\u0010\u0016.\u0010.\u00118\u0010\u001a.\u00108\u0010\u001a F\u0010\u001a.\u0010O\u001ex/\u0010.\u0012O\u0011x/\u0011.\u0012O\u0012x/\u0012.\u0011.\u0015V\u001b\u000e\u0019\u0010N.\u000f.\u0012O\u000fy0\u0011Z\u001b\u000e.\u0017\u0012.\u0010.\u0010.\u0013x8\u0010\u000e.\u00108\u0010\u000e F\u0010\u000e.\u0012\u0013.\u0011\u0019/\u0010.\u000f.\u0012T\u001b\u000e.\u000f.\u0010y/\u0012.\u0013.\u0010O\u00100\u0018x/\u0019.\u000e/\u0010\u0011N.\u0010.\u0018x0\u0011.\u0010.\u0019x0\u001a8\u0010\u000e.\u00118\u0010\u000e F\u0010\u000e.\u0011.\u001a8\u0010\u0012.\u00118\u0010\u0012 F\u0010\u0012.\u0010O\u0016x/\u0010.\u0012O\u0010y0\u0012\u001b\u000e\u0019\u0019.\u0013.\u0016x/\u0013.\u0014.\u001bO\u000fx0\u001bU\u001b\u000e\u0019\u001a\u000f\u0019.\u000fO\u000eZ\u001b\u000e.\u000fO\u0010/\u0012.\u000e8\u0010\u000e/\u001c.\u000fO\u000fT/\u0011.\u000fO\u0011T/\u0013.\u000e/\u0010\u0011N.\u000e.\u00108\u0010\u000e.\u001c 0\u001cF\u0010\u000e\u0010N.\u0011\u001b\u000e.\u000e.\u00108\u0010\u0012.\u000e8\u0010\u0012 F\u0010\u0012.\u000fO\u0010T\u001b\u000e.\u000e.\u00108\u0010\u0016.\u000e8\u0010\u0016 F\u0010\u0016.\u0013\u001b\u000e.\u000e.\u00108\u0010\u001a.\u000e8\u0010\u001a F\u0010\u001a\u0019.\u0010.\u0012x/\u0010.\u0014O\u000fy0\u0014\u001b\u000e\u0019\u0019\u0019\u0011\u0010\u0013\u0014\u0010N.\u00120\u0013O\u0013V\u0012O\u000e\u0013.\u0013O\u0012y/\u0017\u0011N.\u000e.\u0014x0\u00128\u0010\u001a.\u0010¡0\u0018.\u000f.\u0014x0\u00168\u0010\u001a¢.\u00128\u0010\u0016.\u0010¡0\u001b.\u00168\u0010\u0016¢.\u00128\u0010\u0012.\u0010¡0\u001c.\u00168\u0010\u0012¢.\u00128\u0010\u000e.\u0010¡0\u001d.\u00168\u0010\u000e¢.\u0019    /\u0019.\u0018.\u0018¢.\u001b.\u001b¢.\u001c.\u001c¢.\u001d.\u001d¢.\u001a    /\u001a.\u0014O\u001ex/\u0014.\u0015O\u0012x0\u0015.\u0017V\u001b\u000e\u0019.\u0013O\u000fyO\u00190\u0012.\u0013\\\u001b\u000e.\u0012O/\u0014.\u0013O\u000f\u0012.\u000e.\u0012O\u00100\u0015x8\u0010\u000e.\u0010¡0\u0018.\u000f.\u0015x8\u0010\u000e¢.\u0019 /\u0019.\u0018.\u0018¢.\u001a /\u001a.\u0012O\u000f\u0013.\u0012\u0019/\u0012O\u000e.\u0013y.\u0014T\u001b\u000e.\u0013.\u0012y/\u0015.\u000e.\u0012O\u00100\u000ex/\u0014.\u000e.\u000fx/\u000e\u0011N.\u00148\u0010\u0012.\u0010¡0\u0018.\u0018¢.\u00148\u0010\u000e.\u0010¡0\u001b.\u001b¢.\u001a  /\u001a.\u0018.\u000e8\u0010\u0012¢.\u001b.\u000e8\u0010\u000e¢.\u0019  /\u0019.\u0014O\u0016x/\u0014.\u000eO\u0016x/\u000e.\u0015O\u0010y0\u0015\u001b\u000e\u0019\u0019.\u0019.\u0013ÀQ\u000e\u000eÍ 0\u0010£É.\u001a.\u0010£É­.\u0011É°±Ä\u0019Ê\u0019\u0011\u0012\u0012\u0013R\u000e\u000e\u000e\u000e\u000e\u000e\u000e\u000e/$\u0010N.\u000e.\u000f.\u0010\u001e\u000e.\u0011.\u0012.\u0013\u001e\u000e.\u0017O\u000eD\u0010\u000e.\u0016O\u000eD\u0010\u000e\u0010N.\u0014O\u000eX\u0012N.\u0014O\u0011/\u0013.\u0014O\u000fy0\u0018O\u0011]\u0012N.\u000e/\u0012.\u0014O0\u001a/\u0010\u0011N. .\u00128\u0010\u000eÉ®.\u00128\u0010\u0012É®.\u00128\u0010\u0016É®.\u00128\u0010\u001aÉ®/ .\u0012O\u001ex/\u0012.\u0010O\u0012y0\u0010\u001b\u000e\u0019\u0019.\u0013\u0012N.\u001aO\u0010.\u000ex/\u0012.\u0013/\u0010\u0011N. .\u00128\u0010\u000eÉ®/ .\u0012O\u0012x/\u0012.\u0010O\u000fy0\u0010\u001b\u000e\u0019\u0019\u0010N.\u0018O\u0011W\u0012NO\u000e/\u001a\u001a\u000f\u0019.\u0011/\u0012.\u0014O0\u001a/\u0010\u0011N.!.\u00128\u0010\u000eÉ®.\u00128\u0010\u0012É®.\u00128\u0010\u0016É®.\u00128\u0010\u001aÉ®/!.\u0012O\u001ex/\u0012.\u0010O\u0012y0\u0010\u001b\u000e\u0019\u0019.\u0013\u0012N.\u001aO\u0010.\u0011x/\u0012\u0011N.!.\u00128\u0010\u000eÉ®/!.\u0012O\u0012x/\u0012.\u0013O\u000fy0\u0013\u001b\u000e\u0019\u0019.\u0014O\u0012y/\u001a.\u0014À/\u001f.\u0014O\u0013V\u0012NO\u000e/\u0018O\u000e/\u0010\u001a\u0010\u0019.!Ä.\u001f£/\u001cO\u000e/\u0013.\u0011/\u0012\u0011N.\u00128\u0010\u001a.\u001c¡0\u001d.\u001d¢.\u00128\u0010\u0016.\u001c¡0\u001d.\u001d¢.\u00128\u0010\u0012.\u001c¡0\u001d.\u001d¢.\u00128\u0010\u000e.\u001c¡0\u001d.\u001d¢.\u001e    /\u001e.\u0012O\u001ex/\u0012.\u0013O\u0012x0\u0013.\u001aV\u001b\u000e\u0019.\u0018O/\u0010O\u000f/\u0018\u001a\u000f\u0019.\u0014O\u0012y/\u001a.\u0014À/\u001fO\u000e/\u0010\u0019.!.\u0014Å0!±Ä/\u001c\u0010N.\u0010.\u0014\\\u001b\u000e.\u0014.\u0010Ox/\u001b.\u0014O\u00110\u0019\u0012.\u0010O\u0010.\u0011x/\u0012.\u0019/\u0013\u0011N.\u00128\u0010\u000e.\u001c¡0\u001d.\u001d¢.\u001e /\u001e.\u0012O\u0012x/\u0012.\u0013O\u000fy0\u0013\u001b\u000e\u0019.\u0010.\u0019\u0013.\u0010\u0019/\u0010.\u001bO\u0011W\u001b\u000e.\u0014.\u0010y/\u0013.\u0010O\u0010.\u0011x/\u0012\u0011N.\u00128\u0010\u001a.\u001c¡0\u001d.\u001d¢.\u00128\u0010\u0016.\u001c¡0\u001d.\u001d¢.\u00128\u0010\u0012.\u001c¡0\u001d.\u001d¢.\u00128\u0010\u000e.\u001c¡0\u001d.\u001d¢.\u001e    /\u001e.\u0012O\u001ex/\u0012.\u0013O\u0012y0\u0013\u001b\u000e\u0019\u0019O\u000e/\u0013.\u0018\u0012N.\u0011/\u0012\u0011N.\u0012.\u00128\u0010\u000e.\u001c¡F\u0010\u000e.\u0012.\u00128\u0010\u0012.\u001c¡F\u0010\u0012.\u0012.\u00128\u0010\u0016.\u001c¡F\u0010\u0016.\u0012.\u00128\u0010\u001a.\u001c¡F\u0010\u001a.\u0012O\u001ex/\u0012.\u0013O\u0012x0\u0013.\u001aV\u001b\u000e\u0019\u0019.\u001e.\u001fQ\u000e\u000eÍ £/\u001e.\u000f.\u0014y/\u0010\u0010N.\u0013.\u0014\\\u001b\u000e.\u0014.\u0013Ox/\u000f.\u0014.\u0013yO\u00110\u001a\u0012N.\u0013O\u0010.\u0011x/\u0012\u0011N.\u0012.\u00128\u0010\u000e.\u001c¡F\u0010\u000e.\u0012O\u0012x/\u0012.\u0013O\u000fx/\u0013.\u001aO\u000fy0\u001a\u001b\u000e\u0019\u0019.\u000fO\u0011W\u001b\u000e.\u0014.\u0013y/\u001a.\u0013O\u0010.\u0011x/\u0012\u0011N.\u0012.\u00128\u0010\u000e.\u001c¡F\u0010\u000e.\u0012.\u00128\u0010\u0012.\u001c¡F\u0010\u0012.\u0012.\u00128\u0010\u0016.\u001c¡F\u0010\u0016.\u0012.\u00128\u0010\u001a.\u001c¡F\u0010\u001a.\u0012O\u001ex/\u0012.\u001aO\u0012y0\u001a\u001b\u000e\u0019\u0019.\u001e/\u001c\u0010N.\u0010O\u000eZ\u0012NO\u000e/\u0018\u001a\u000f\u0019.\u0015O\u0010/\u0019.\u0014O\u0010/\u001aO\u000e/\u0018.\u000e/\u0012O\u000e/\u0013\u0011N. .\u00128\u0010\u000eÉ¯/\".\u0012.\u001ax8\u0010\u000eÉ/#.\u00168\u0010\u000e/\u001e.\u0012.\u0011. .!±Ä.\u001c.\u0014\u001e\u000f0\u001f.\u001el\u0012.\u0017.\u0013D\u0010\u000e.\u0016.\u001fF\u0010\u000e.\u0013\u0013.\u0018\u0019/\u0018.\".#®/ .\u0012.\u0019x/\u0012.\u0013.\u0015x0\u0013.\u0010V\u001b\u000e\u0019\u0019\u0010N.\u0015O\u000fZ\u001b\u000e.\u0018.\u0015.\u0015z0\u0012x0\u000f.\u0010.\u000f.\u0010V)/\u0015O\u000e/\u000f.\u0018.\u0012y0\u0010O\u000e.\u0010O\u000eX)/\u0010\u0010N.\u0014O\u000eZ\u0012N.$/ \u001a\u000f\u0019.\u0014O\u0011/\u0013\u0010N.\u0014O\u000fyO\u0011W\u0012N.$/ \u001a\u000f\u0019.\u0010O\u0010.\u000ex/\u0012.$/ .\u0014O0\u000f/\u001a\u0011N. .\u00128\u0010\u000eÉ®.\u00128\u0010\u0012É®.\u00128\u0010\u0016É®.\u00128\u0010\u001aÉ®/ .\u0012O\u001ex/\u0012.\u001aO\u0012y0\u001a\u001b\u000e\u0019\u0019.\u0013S\u001b\u000e.\u000f.\u0010xO\u0010.\u000ex/\u0012\u0011N. .\u00128\u0010\u000eÉ®/ .\u0012O\u0012x/\u0012.\u0013O\u000fy0\u0013\u001b\u000e\u0019\u0019.\u0010.\u0015\\\u001b\u000e.\u0010O\u0010.\u000ex/\u0012.\u0010.\u0014xO\u0010.\u000ex/\u0013\u0011N. .\u00128\u0010\u000eÉ¯/\".\u00138\u0010\u000eÉ/#.\u00168\u0010\u000e/\u001e.\u0012.\u0011. .!±Ä.\u001c.\u0014\u001e\u000f0\u001f.\u001el\u0012N.\u0017.\u0010D\u0010\u000e.\u0016.\u001fF\u0010\u000e\u0019.\".#®/ .\u0012O\u0012x/\u0012.\u0013O\u0012x/\u0013.\u0010O\u000fx0\u0010.\u0015U\u001b\u000e\u0019\u0019\u0019\u0019`;\n\nexport default class SynAudio {\n  constructor(options = {}) {\n    this._correlationSampleSize =\n      options.correlationSampleSize > 0 ? options.correlationSampleSize : 11025;\n    this._initialGranularity =\n      options.initialGranularity > 0 ? options.initialGranularity : 16;\n    this._correlationThreshold =\n      options.correlationThreshold >= 0 ? options.correlationThreshold : 0.5;\n\n    this._module = wasmModule.get(SynAudio);\n\n    if (!this._module) {\n      this._module = simd().then((simdSupported) =>\n        simdSupported\n          ? WebAssembly.compile(decode(simdWasm))\n          : WebAssembly.compile(decode(scalarWasm))\n      );\n      wasmModule.set(this._module);\n    }\n\n    this.SynAudioWorker = function SynAudioWorker(\n      module,\n      correlationSampleSize,\n      initialGranularity\n    ) {\n      this._sourceCache = new Map();\n\n      // correlation sample size must not exceed the size of each audio clip\n      this._getCorrelationSampleSize = (a, b) =>\n        Math.min(\n          a.samplesDecoded,\n          b.samplesDecoded,\n          this._correlationSampleSize\n        );\n\n      // initial granularity must not exceed the size of each audio clip\n      this._getInitialGranularity = (a, b) =>\n        Math.min(a.samplesDecoded, b.samplesDecoded, this._initialGranularity);\n\n      this._setAudioDataOnHeap = (input, output, heapPos) => {\n        const bytesPerElement = output.BYTES_PER_ELEMENT;\n\n        let floatPos = heapPos / bytesPerElement;\n\n        for (let i = 0; i < input.length; i++) {\n          heapPos += input[i].length * bytesPerElement;\n          output.set(input[i], floatPos);\n          floatPos += input[i].length;\n        }\n\n        return heapPos;\n      };\n\n      this._executeAsWorker = (functionName, params) => {\n        let source = this._sourceCache.get(functionName);\n\n        if (!source) {\n          const webworkerSourceCode =\n            \"'use strict';\" +\n            `(${((\n              SynAudioWorker,\n              functionName,\n              correlationSampleSize,\n              initialGranularity\n            ) => {\n              self.onmessage = (msg) => {\n                const worker = new SynAudioWorker(\n                  Promise.resolve(msg.data.module),\n                  correlationSampleSize,\n                  initialGranularity\n                );\n\n                worker._workerMethods\n                  .get(functionName)\n                  .apply(null, msg.data.params)\n                  .then((results) => {\n                    self.postMessage(results);\n                  });\n              };\n            }).toString()})(${SynAudioWorker.toString()}, \"${functionName}\", ${\n              this._correlationSampleSize\n            }, ${this._initialGranularity})`;\n\n          const type = \"text/javascript\";\n\n          try {\n            // browser\n            source = URL.createObjectURL(\n              new Blob([webworkerSourceCode], { type })\n            );\n          } catch {\n            // nodejs\n            source = `data:${type};base64,${Buffer.from(\n              webworkerSourceCode\n            ).toString(\"base64\")}`;\n          }\n\n          this._sourceCache.set(functionName, source);\n        }\n\n        const worker = new (globalThis.Worker || Worker)(source, {\n          name: \"SynAudio\",\n        });\n\n        const result = new Promise((resolve) => {\n          worker.onmessage = (message) => {\n            worker.terminate();\n            resolve(message.data);\n          };\n        });\n\n        this._module.then((module) => {\n          worker.postMessage({\n            module,\n            params,\n          });\n        });\n\n        return result;\n      };\n\n      this._sync = (a, b) => {\n        const pageSize = 64 * 1024;\n        const floatByteLength = Float32Array.BYTES_PER_ELEMENT;\n\n        const correlationSampleSize = this._getCorrelationSampleSize(a, b);\n        const initialGranularity = this._getInitialGranularity(a, b);\n\n        const memory = new WebAssembly.Memory({\n          initial:\n            ((a.samplesDecoded * a.channelData.length +\n              b.samplesDecoded * b.channelData.length) *\n              floatByteLength) /\n              pageSize +\n            4,\n        });\n\n        return this._module\n          .then((module) =>\n            WebAssembly.instantiate(module, {\n              env: { memory },\n            })\n          )\n          .then(({ exports }) => {\n            const instanceExports = new Map(Object.entries(exports));\n\n            const correlate = instanceExports.get(\"correlate\");\n            const dataArray = new Float32Array(memory.buffer);\n            const heapView = new DataView(memory.buffer);\n\n            const aPtr = instanceExports.get(\"__heap_base\").value;\n            const bPtr = this._setAudioDataOnHeap(\n              a.channelData,\n              dataArray,\n              aPtr\n            );\n            const bestCorrelationPtr = this._setAudioDataOnHeap(\n              b.channelData,\n              dataArray,\n              bPtr\n            );\n            const bestSampleOffsetPtr = bestCorrelationPtr + floatByteLength;\n\n            correlate(\n              aPtr,\n              a.samplesDecoded,\n              a.channelData.length,\n              bPtr,\n              b.samplesDecoded,\n              b.channelData.length,\n              correlationSampleSize,\n              initialGranularity,\n              bestCorrelationPtr,\n              bestSampleOffsetPtr\n            );\n\n            const bestCorrelation = heapView.getFloat32(\n              bestCorrelationPtr,\n              true\n            );\n            const bestSampleOffset = heapView.getInt32(\n              bestSampleOffsetPtr,\n              true\n            );\n\n            return {\n              correlation: bestCorrelation,\n              sampleOffset: bestSampleOffset,\n            };\n          });\n      };\n\n      this._syncWorkerConcurrent = (a, b, threads) => {\n        const promises = [];\n        const lengths = [0];\n\n        // |-----------|       |-----------|     \"end\"\n        // \"start\"   |-|---------|       |-----------|\n        //           | |\n        //           | |correlationSampleSize\n\n        // split a buffer into equal chunks for threads\n        // overlap at the start of the buffer by correlation sample size\n        // overlap at the end of the buffer by correlation sample size\n\n        // initial granularity  low -> high, more -> less threads\n        // correlation sample   low -> high, less -> more threads\n        // file size            low -> high, less -> more threads\n\n        const correlationSampleSize = this._getCorrelationSampleSize(a, b);\n\n        // rough estimate for a good max thread count for performance\n        const maxThreads =\n          (Math.log(a.samplesDecoded * correlationSampleSize) /\n            Math.log(this._initialGranularity + 1)) *\n          Math.log(correlationSampleSize / 10000 + 1);\n\n        threads = Math.max(\n          Math.round(\n            Math.min(\n              threads,\n              maxThreads,\n              a.samplesDecoded / correlationSampleSize / 4\n            )\n          ),\n          1\n        );\n\n        const aLength = Math.ceil(a.samplesDecoded / threads);\n\n        let offset = 0;\n        for (let t = 0; t < threads; t++) {\n          const aSplit = {\n            channelData: [],\n          };\n\n          for (let i = 0; i < a.channelData.length; i++) {\n            const cutChannel = a.channelData[i].subarray(\n              offset,\n              offset + aLength + correlationSampleSize\n            );\n            aSplit.channelData.push(cutChannel);\n            aSplit.samplesDecoded = cutChannel.length;\n          }\n\n          offset += aLength - correlationSampleSize;\n          lengths.push(offset);\n\n          promises.push(this._syncWorker(aSplit, b));\n        }\n\n        return Promise.all(promises).then((results) => {\n          // find the result with the highest correlation and calculate the offset relative to the input data\n          let bestResultIdx = 0;\n          let bestCorrelation = -1;\n          for (let i = 0; i < results.length; i++)\n            if (results[i].correlation > bestCorrelation) {\n              bestResultIdx = i;\n              bestCorrelation = results[i].correlation;\n            }\n\n          return {\n            correlation: results[bestResultIdx].correlation,\n            sampleOffset:\n              results[bestResultIdx].sampleOffset + lengths[bestResultIdx],\n          };\n        });\n      };\n\n      this._syncWorker = (a, b) => {\n        return this._executeAsWorker(\"_sync\", [a, b]);\n      };\n\n      this._syncWorkerConcurrentMain = (a, b, threads) => {\n        // can't serialize the webworker polyfill in nodejs\n        return globalThis.Worker\n          ? this._executeAsWorker(\"_syncWorkerConcurrent\", [a, b, threads])\n          : this._syncWorkerConcurrent(a, b, threads);\n      };\n\n      // constructor\n\n      // needed to serialize minified code when methods are refererenced as a string\n      // prettier-ignore\n      this._workerMethods = new Map([\n        [\"_sync\", this._sync],\n        [\"_syncWorker\", this._syncWorker],\n        [\"_syncWorkerConcurrent\", this._syncWorkerConcurrent],\n      ]);\n\n      this._module = module;\n      this._correlationSampleSize = correlationSampleSize;\n      this._initialGranularity = initialGranularity;\n    };\n\n    this._instance = new this.SynAudioWorker(\n      this._module,\n      this._correlationSampleSize,\n      this._initialGranularity\n    );\n  }\n\n  async syncWorkerConcurrent(a, b, threads) {\n    return this._instance._syncWorkerConcurrentMain(\n      a,\n      b,\n      threads >= 1 ? threads : 1\n    );\n  }\n\n  async syncWorker(a, b) {\n    return this._instance._syncWorker(a, b);\n  }\n\n  async sync(a, b) {\n    return this._instance._sync(a, b);\n  }\n\n  async syncMultiple(clips, threads) {\n    threads = threads >= 1 ? threads : 8;\n\n    const workers = [];\n    const graph = [];\n\n    let notify = () => {},\n      wait = Promise.resolve(),\n      runningThreads = 0;\n\n    const resetNotify = () => {\n      wait = new Promise((resolve) => {\n        notify = resolve;\n      });\n    };\n\n    for (let i = 0; i < clips.length; i++) graph.push({ vertex: {} });\n\n    for (let v = 0; v < clips.length; v++) {\n      const vertexClip = clips[v];\n      const vertex = graph[v].vertex;\n\n      vertex.name = vertexClip.name;\n      vertex.samplesDecoded = vertexClip.data.samplesDecoded;\n      vertex.edges = new Set();\n\n      for (let e = 0; e < clips.length; e++) {\n        if (v === e) continue;\n\n        const edgeClip = clips[e];\n        const edge = graph[e];\n\n        runningThreads++;\n        workers.push(\n          this.syncWorker(vertexClip.data, edgeClip.data).then(\n            (correlationResult) => {\n              if (correlationResult.correlation > this._correlationThreshold) {\n                vertex.edges.add({\n                  parent: vertex,\n                  vertex: edge.vertex,\n                  samplesDecoded: edgeClip.data.samplesDecoded,\n                  ...correlationResult,\n                });\n              }\n              runningThreads--;\n              notify();\n            }\n          )\n        );\n\n        if (runningThreads >= threads) {\n          resetNotify();\n          await wait;\n        }\n      }\n    }\n\n    await Promise.all(workers);\n\n    // prettier-ignore\n    const weighResults = (a, b) => {\n      if (a.parent && b.parent && a.parent.samplesDecoded !== b.parent.samplesDecoded) return a.parent.samplesDecoded > b.parent.samplesDecoded;\n      if (a.correlation !== b.correlation) return a.correlation > b.correlation;\n      if (a.sampleOffset !== b.sampleOffset) return a.sampleOffset > b.sampleOffset;\n      return a.vertex && b.vertex && a.vertex.name.localeCompare(b.vertex.name) < 0;\n    };\n\n    // detect cycles and weigh for which edge to remove\n    const path = new Map();\n    const cycles = new Set();\n\n    const detectCycle = (vertex) => {\n      for (const edge of vertex.edges.values()) {\n        if (path.has(vertex)) return path.get(vertex);\n\n        path.set(vertex, edge);\n\n        const cycleStartEdge = detectCycle(edge.vertex);\n        const cycleEndEdge = edge;\n\n        if (cycleStartEdge) {\n          let keep, remove;\n          if (weighResults(cycleStartEdge, cycleEndEdge)) {\n            keep = cycleStartEdge;\n            remove = cycleEndEdge;\n          } else {\n            keep = cycleEndEdge;\n            remove = cycleStartEdge;\n          }\n\n          if (!remove.cycleWith) {\n            remove.cycleWith = new Set();\n            cycles.add(remove);\n          }\n\n          remove.cycleWith.add(keep);\n\n          if (keep.cycleWith) {\n            keep.cycleWith.delete(remove);\n          }\n        }\n\n        path.delete(vertex);\n      }\n    };\n\n    for (const { vertex } of graph) detectCycle(vertex);\n\n    // delete any cycles\n    for (const edge of cycles)\n      if (edge.cycleWith.size) edge.parent.edges.delete(edge);\n\n    // find the root elements\n    const roots = new Set();\n    for (const v of graph) roots.add(v.vertex);\n    for (const v of graph)\n      for (const edge of v.vertex.edges) roots.delete(edge.vertex);\n\n    // build a unique sequence of matches for each root\n    const traverseRoot = (path, root, edges, sampleOffsetFromRoot = 0) => {\n      for (const edge of edges) {\n        if (\n          !(path.has(edge.vertex) && weighResults(path.get(edge.vertex), edge))\n        )\n          path.set(edge.vertex, {\n            name: edge.vertex.name,\n            correlation: edge.correlation,\n            sampleOffset: sampleOffsetFromRoot + edge.sampleOffset,\n          });\n\n        traverseRoot(\n          path,\n          root,\n          edge.vertex.edges,\n          sampleOffsetFromRoot + edge.sampleOffset\n        );\n      }\n    };\n\n    const results = [];\n\n    for (const root of roots) {\n      const path = new Map();\n      path.set(root, {\n        name: root.name,\n        sampleOffset: 0,\n      });\n      traverseRoot(path, root, root.edges);\n\n      results.push(\n        [...path.values()].sort(\n          (a, b) =>\n            a.sampleOffset - b.sampleOffset ||\n            (a.correlation || 0) - (b.correlation || 0) ||\n            b.name.localeCompare(a.name)\n        )\n      );\n    }\n\n    return results;\n  }\n}\n","import SynAudio from \"./src/SynAudio.js\";\n\nexport default SynAudio;\n"],"names":["module","exports","Worker","encode","byteArray","charArray","byte","encoded","push","String","fromCharCode","join","dynamicEncode","stringWrapper","shouldEscape","offsetLength","Infinity","offset","byte1","byte2","o","length","i","escapeCharacter","toString","padStart","pop","decode","string","htmlCodeOverrides","Map","forEach","k","v","set","output","Uint8Array","escaped","byteIndex","startIdx","substring","parseInt","offsetReverse","charCodeAt","htmlOverride","get","subarray","stringify","rawString","replace","wasmModule","WeakMap","simdWasm","raw","scalarWasm","SynAudio","constructor","options","this","_correlationSampleSize","correlationSampleSize","_initialGranularity","initialGranularity","_correlationThreshold","correlationThreshold","_module","async","WebAssembly","validate","simd","then","simdSupported","compile","SynAudioWorker","_sourceCache","_getCorrelationSampleSize","a","b","Math","min","samplesDecoded","_getInitialGranularity","_setAudioDataOnHeap","input","heapPos","bytesPerElement","BYTES_PER_ELEMENT","floatPos","_executeAsWorker","functionName","params","source","webworkerSourceCode","self","onmessage","msg","Promise","resolve","data","_workerMethods","apply","results","postMessage","type","URL","createObjectURL","Blob","Buffer","from","worker","globalThis","name","result","message","terminate","_sync","floatByteLength","Float32Array","memory","Memory","initial","channelData","instantiate","env","instanceExports","Object","entries","correlate","dataArray","buffer","heapView","DataView","aPtr","value","bPtr","bestCorrelationPtr","bestSampleOffsetPtr","correlation","getFloat32","sampleOffset","getInt32","_syncWorkerConcurrent","threads","promises","lengths","maxThreads","log","max","round","aLength","ceil","t","aSplit","cutChannel","_syncWorker","all","bestResultIdx","bestCorrelation","_syncWorkerConcurrentMain","_instance","clips","workers","graph","notify","wait","runningThreads","vertex","vertexClip","edges","Set","e","edgeClip","edge","syncWorker","correlationResult","add","parent","weighResults","localeCompare","path","cycles","detectCycle","values","has","cycleStartEdge","cycleEndEdge","keep","remove","cycleWith","delete","size","roots","traverseRoot","root","sampleOffsetFromRoot","sort"],"sourceRoot":""}
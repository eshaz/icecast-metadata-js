"use strict";(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[756],{689:(t,e,n)=>{n.r(e),n.d(e,{default:()=>tt,getWrappedMimeType:()=>$});var s=n(352);const i="webm",r="mp3",a="mp4a.40.2",c="flac",o="vorbis",h="opus",l="audio/",g=";codecs=",d=l+"mp4"+g,u=l+i+g,_="mse-audio-wrapper";class m{constructor(t){let{name:e,contents:n=[],children:s=[]}=t;this._name=e,this._contents=n,this._children=s}static stringToByteArray(t){return[...t].map((t=>t.charCodeAt(0)))}static getFloat64(t){const e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,t),e}static getUint64(t){const e=new Uint8Array(8);return new DataView(e.buffer).setBigUint64(0,BigInt(t)),e}static getUint32(t){const e=new Uint8Array(4);return new DataView(e.buffer).setUint32(0,t),e}static getUint16(t){const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t),e}static getInt16(t){const e=new Uint8Array(2);return new DataView(e.buffer).setInt16(0,t),e}static*flatten(t){for(const e of t)Array.isArray(e)?yield*m.flatten(e):yield e}get contents(){const t=new Uint8Array(this.length),e=this._buildContents();let n=0;for(const s of m.flatten(e))"object"!==typeof s?(t[n]=s,n++):(t.set(s,n),n+=s.length);return t}get length(){return this._buildLength()}_buildContents(){return[this._contents,...this._children.map((t=>t._buildContents()))]}_buildLength(){let t;return t=Array.isArray(this._contents)?this._contents.reduce(((t,e)=>t+(void 0===e.length?1:e.length)),0):void 0===this._contents.length?1:this._contents.length,t+this._children.reduce(((t,e)=>t+e.length),0)}addChild(t){this._children.push(t)}}class p extends m{constructor(t){let{contents:e,children:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super({name:t,contents:e,children:n})}_buildContents(){return[...this._lengthBytes,...m.stringToByteArray(this._name),...super._buildContents()]}_buildLength(){return this._length||(this._length=4+this._name.length+super._buildLength(),this._lengthBytes=m.getUint32(this._length)),this._length}}class w extends m{constructor(t){let{contents:e,tags:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super({name:t,contents:e,children:n})}static getLength(t){const e=m.getUint32(t);return e.every(((t,e,n)=>0===t&&(n[e]=128,!0))),e}_buildContents(){return[this._name,...this._lengthBytes,...super._buildContents()]}_buildLength(){if(!this._length){const t=super._buildLength();this._lengthBytes=w.getLength(t),this._length=1+t+this._lengthBytes.length}return this._length}addTag(t){this.addChild(t)}}class y{constructor(t){this._codec=t}getCodecBox(t){switch(this._codec){case r:return this.getMp4a(t,107);case a:return this.getMp4a(t,64);case h:return this.getOpus(t);case c:return this.getFlaC(t)}}getOpus(t){return new p("Opus",{contents:[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channels,0,t.bitDepth,0,0,0,0,p.getUint16(t.sampleRate),0,0],children:[new p("dOps",{contents:[0,t.channels,p.getUint16(t.preSkip),p.getUint32(t.inputSampleRate),p.getInt16(t.outputGain),t.channelMappingFamily,0!==t.channelMappingFamily?[t.streamCount,t.coupledStreamCount,t.channelMappingTable]:[]]})]})}getFlaC(t){return new p("fLaC",{contents:[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channels,0,t.bitDepth,0,0,0,0,p.getUint16(t.sampleRate),0,0],children:[new p("dfLa",{contents:[0,0,0,0,...t.streamInfo||[128,0,0,34,p.getUint16(t.blockSize),p.getUint16(t.blockSize),0,0,0,0,0,0,p.getUint32(t.sampleRate<<12|t.channels<<8|t.bitDepth-1<<4),0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]})]})}getMp4a(t,e){const n=new w(4,{contents:[e,21,0,0,0,0,0,0,0,0,0,0,0]});return 64===e&&n.addTag(new w(5,{contents:t.audioSpecificConfig})),new p("mp4a",{contents:[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channels,0,16,0,0,0,0,p.getUint16(t.sampleRate),0,0],children:[new p("esds",{contents:[0,0,0,0],children:[new w(3,{contents:[0,1,0],tags:[n,new w(6,{contents:2})]})]})]})}getInitializationSegment(t){let{header:e,samples:n}=t;return new m({children:[new p("ftyp",{contents:[p.stringToByteArray("iso5"),0,0,2,0,p.stringToByteArray("iso6mp41")]}),new p("moov",{children:[new p("mvhd",{contents:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,232,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2]}),new p("trak",{children:[new p("tkhd",{contents:[0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0]}),new p("mdia",{children:[new p("mdhd",{contents:[0,0,0,0,0,0,0,0,0,0,0,0,p.getUint32(e.sampleRate),0,0,0,0,85,196,0,0]}),new p("hdlr",{contents:[0,0,0,0,p.stringToByteArray("mhlr"),p.stringToByteArray("soun"),0,0,0,0,0,0,0,0,0,0,0,0,0]}),new p("minf",{children:[new p("stbl",{children:[new p("stsd",{contents:[0,0,0,0,0,0,0,1],children:[this.getCodecBox(e)]}),new p("stts",{contents:[0,0,0,0,0,0,0,0]}),new p("stsc",{contents:[0,0,0,0,0,0,0,0]}),new p("stsz",{contents:[0,0,0,0,0,0,0,0,0,0,0,0]}),new p("stco",{contents:[0,0,0,0,0,0,0,0]})]})]})]})]}),new p("mvex",{children:[new p("trex",{contents:[0,0,0,0,0,0,0,1,0,0,0,1,p.getUint32(n),0,0,0,0,0,0,0,0]})]})]})]}).contents}getSamplesPerFrame(t){return this._codec===a?t.map((t=>{let{data:e,header:n}=t;return p.getUint32(e.length-n.length)})):t.map((t=>{let{data:e}=t;return p.getUint32(e.length)}))}getFrameData(t){return this._codec===a?t.map((t=>{let{data:e,header:n}=t;return e.subarray(n.length)})):t.map((t=>{let{data:e}=t;return e}))}getMediaSegment(t){return new m({children:[new p("moof",{children:[new p("mfhd",{contents:[0,0,0,0,0,0,0,0]}),new p("traf",{children:[new p("tfhd",{contents:[0,2,0,0,0,0,0,1]}),new p("tfdt",{contents:[0,0,0,0,0,0,0,0]}),new p("trun",{contents:[0,0,2,1,p.getUint32(t.length),p.getUint32(92+4*t.length),...this.getSamplesPerFrame(t)]})]})]}),new p("mdat",{contents:this.getFrameData(t)})]}).contents}}const f=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.flatMap((t=>{const e=[];for(let n=t.length;n>=0;n-=255)e.push(n>=255?255:n);return e}))};class b extends m{constructor(t){let{contents:e,children:n,isUnknownLength:s=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super({name:t,contents:e,children:n}),this._isUnknownLength=s}static getUintVariable(t){let e;if(t<127)e=[128|t];else if(t<16383)e=m.getUint16(t),e[0]|=64;else if(t<2097151)e=m.getUint32(t).subarray(1),e[0]|=32;else if(t<268435455)e=m.getUint32(t),e[0]|=16;else if(t<34359738367)e=m.getUint64(t).subarray(3),e[0]|=8;else if(t<4398046511103)e=m.getUint64(t).subarray(2),e[0]|=4;else if(t<562949953421311)e=m.getUint64(t).subarray(1),e[0]|=2;else if(t<72057594037927940)e=m.getUint64(t),e[0]|=1;else if("number"!==typeof t||isNaN(t))throw function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];console.error(_,e.reduce(((t,e)=>t+"\n  "+e),""))}("EBML Variable integer must be a number, instead received ".concat(t)),new Error(_+": Unable to encode WEBM");return e}_buildContents(){return[...this._name,...this._lengthBytes,...super._buildContents()]}_buildLength(){return this._length||(this._contentLength=super._buildLength(),this._lengthBytes=this._isUnknownLength?[1,255,255,255,255,255,255,255]:b.getUintVariable(this._contentLength),this._length=this._name.length+this._lengthBytes.length+this._contentLength),this._length}}const S=[225],U=[98,100],M=[159],A=[31,67,182,117],C=[86,170],E=[134],T=[99,162],R=[66,130],F=[66,133],L=[66,135],B=[26,69,223,163],I=[66,242],v=[66,243],P=[66,247],k=[66,134],N=[156],D=[21,73,169,102],V=[77,128],O=[181],x=[86,187],G=[24,83,128,103],z=[163],X=[231],H=[42,215,177],W=[174],j=[215],Z=[22,84,174,107],q=[131],J=[115,197],K=[87,65];class Q{constructor(t){switch(t){case h:this._codecId="A_OPUS",this._getCodecSpecificTrack=t=>[new b(C,{contents:b.getUint32(Math.round(t.preSkip*this._timestampScale))}),new b(x,{contents:b.getUint32(Math.round(3840*this._timestampScale))}),new b(T,{contents:t.data})];break;case o:this._codecId="A_VORBIS",this._getCodecSpecificTrack=t=>[new b(T,{contents:[2,f(t.data,t.vorbisComments),t.data,t.vorbisComments,t.vorbisSetup]})]}}getInitializationSegment(t){let{header:e}=t;return this._timestampScale=1e9/e.sampleRate,new m({children:[new b(B,{children:[new b(k,{contents:1}),new b(P,{contents:1}),new b(I,{contents:4}),new b(v,{contents:8}),new b(R,{contents:b.stringToByteArray(i)}),new b(L,{contents:4}),new b(F,{contents:2})]}),new b(G,{isUnknownLength:!0,children:[new b(D,{children:[new b(H,{contents:b.getUint32(Math.floor(this._timestampScale))}),new b(V,{contents:b.stringToByteArray(_)}),new b(K,{contents:b.stringToByteArray(_)})]}),new b(Z,{children:[new b(W,{children:[new b(j,{contents:1}),new b(J,{contents:1}),new b(N,{contents:0}),new b(E,{contents:b.stringToByteArray(this._codecId)}),new b(q,{contents:2}),new b(S,{children:[new b(M,{contents:e.channels}),new b(O,{contents:b.getFloat64(e.sampleRate)}),new b(U,{contents:e.bitDepth})]}),...this._getCodecSpecificTrack(e)]})]})]})]}).contents}getMediaSegment(t){const e=t[0].totalSamples;return new b(A,{children:[new b(X,{contents:b.getUintVariable(e)}),...t.map((t=>{let{data:n,totalSamples:s}=t;return new b(z,{contents:[129,b.getInt16(s-e),128,n]})}))]}).contents}}const Y=()=>{},$=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i;switch(t){case"mpeg":return"".concat(d,'"').concat(r,'"');case"aac":return"".concat(d,'"').concat(a,'"');case"flac":return"".concat(d,'"').concat(c,'"');case"vorbis":return"".concat(u,'"').concat(o,'"');case"opus":return e===i?"".concat(u,'"').concat(h,'"'):"".concat(d,'"').concat(h,'"')}};class tt{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._inputMimeType=t,this.PREFERRED_CONTAINER=e.preferredContainer||i,this.MIN_FRAMES=e.minFramesPerSegment||4,this.MAX_FRAMES=e.maxFramesPerSegment||50,this.MIN_FRAMES_LENGTH=e.minBytesPerSegment||1022,this.MAX_SAMPLES_PER_SEGMENT=1/0,this._onMimeType=e.onMimeType||Y,e.codec&&(this._container=this._getContainer(e.codec),this._onMimeType(this._mimeType)),this._frames=[],this._codecParser=new s.ZP(t,{onCodec:t=>{this._container=this._getContainer(t),this._onMimeType(this._mimeType)},onCodecUpdate:e.onCodecUpdate,enableLogging:e.enableLogging,enableFrameCRC32:!1})}get mimeType(){return this._mimeType}get inputMimeType(){return this._inputMimeType}*iterator(t){t.constructor===Uint8Array?yield*this._processFrames([...this._codecParser.parseChunk(t)].flatMap((t=>t.codecFrames||t))):Array.isArray(t)&&(yield*this._processFrames(t))}*_processFrames(t){if(this._frames.push(...t),this._frames.length){const t=this._groupFrames();if(t.length){this._sentInitialSegment||(this._sentInitialSegment=!0,yield this._container.getInitializationSegment(t[0][0]));for(const e of t)yield this._container.getMediaSegment(e)}}}_groupFrames(){const t=[[]];let e=t[0],n=0;for(const s of this._frames)(e.length===this.MAX_FRAMES||n>=this.MAX_SAMPLES_PER_SEGMENT)&&(n=0,t.push(e=[])),e.push(s),n+=s.samples;return this._frames=e.length<this.MIN_FRAMES||e.reduce(((t,e)=>t+e.data.length),0)<this.MIN_FRAMES_LENGTH?t.pop():[],t}_getContainer(t){switch(this._mimeType=$(t,this.PREFERRED_CONTAINER),t){case"mpeg":return new y(r);case"aac":return new y(a);case"flac":return new y(c);case"vorbis":return this.MAX_SAMPLES_PER_SEGMENT=32767,new Q(o);case"opus":return this.PREFERRED_CONTAINER===i?(this.MAX_SAMPLES_PER_SEGMENT=32767,new Q(h)):new y(h)}}}}}]);
//# sourceMappingURL=mediasource.658aff5f.chunk.js.map